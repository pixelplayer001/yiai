import{d as D,o as p,c as w,a as o,u as le,g as ie,b as ue,r as n,e as W,f as ce,w as O,h as V,i as de,n as M,F as pe,j as ve,k as f,l as v,T as fe,t as he,m as R,p as j,q as i,_ as B,N as z,s as P,v as me,x as ge,y as we,z as xe,A as _e}from"./index-768c9aff.js";import{t as ye}from"./throttle-5584dbda.js";import{c as ke}from"./index-c94da121.js";const be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},$e=o("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Le=[$e],Ce=D({name:"FlashOutline",render:function(h,x){return p(),w("svg",be,Le)}}),Ie={class:"min-h-full overflow-hidden flex flex-col"},Me={class:"flex-1 min-h-full p-4 relative"},Pe=["id"],We=["id","src","onLoad","onError","onClick"],Ne={class:"menu p-2 text-[#cbd5e1]"},Re={class:"prompt"},je={class:"flex justify-end items-end space-x-2"},Be=["onClick"],ze={class:"text-sm dark:text-slate-400"},De=["onClick"],Ee={class:"text-sm dark:text-slate-400"},He=["onClick"],Se={class:"text-sm dark:text-slate-400"},Ae=D({__name:"index",props:{dataList:{},scaleWidth:{},isDrawLike:{type:Boolean},usePropmpt:{type:Boolean},copyPropmpt:{type:Boolean},gap:{default:5}},emits:["loadMore","usePropmptDraw"],setup(N,{emit:h}){var S;const x=le(),a=N,m=h,_=(S=ie())==null?void 0:S.appContext.config.globalProperties.$viewerApi,$=ue(),y=n({}),L=n(0),u=n(160),c=n(0),k=n([]),d=n(null),r=n(0),b=W(()=>x.isLogin),E=W(()=>a.scaleWidth?Number(a.scaleWidth)*2+a.gap+150:150),q=ce();function G(){K(),Q();const t=c.value,e=u.value,s=[];a.dataList.forEach((g,l)=>{const A=g.drawRatio.split("x"),oe=parseInt(A[0],10),ne=parseInt(A[1],10),ae=e/oe,T=ne*ae+a.gap+L.value,I=y.value[g.id];if(s.length<t)I.style.top="0px",I.style.left=`${(e+a.gap)*l}px`,s.push(T);else{const U=Math.min.apply(null,s),F=s.findIndex(re=>re===U);I.style.top=`${U+0}px`,I.style.left=`${F*(u.value+a.gap)}px`,s[F]+=T}}),r.value=Math.max(...s)+100}function J(t,e){t&&e&&(y.value[e.id]=t)}function K(){const{showName:t=0,showOther:e=0}={};L.value=[t,e].filter(s=>s).length*15}O(()=>a.scaleWidth,t=>{C()}),O(()=>a.dataList,t=>{t&&me(()=>{C()})},{immediate:!0});function Q(){if(!d.value)return;const t=d.value.clientWidth;c.value=Math.floor(t/E.value);const e=t-c.value*E.value,s=(c.value-1)*a.gap;e-s<0&&(c.value-=1),u.value=Math.floor((t-s)/c.value)}function X(t,e){k.value.push(e.id)}function Y(t,e){console.error("Image failed to load:",e),k.value.push(e.id)}function Z(t){if(!b.value)return x.setLoginDialog(!0);const{prompt:e}=t;ke({text:e}),$.success("复制prompt成功")}function ee(t){q.push(`/midjourney?mjId=${t.id}`)}function te(t){const{fullPrompt:e}=t;m("usePropmptDraw",e)}function se(t){const{drawUrl:e}=t;_({options:{},images:[e]})}const H=W(()=>t=>{const e=t.drawRatio.split("x"),s=Number(e[0]);return Number(e[1])/(s/u.value)}),C=ye(function(){G()},200);return V(async()=>{window.addEventListener("resize",C);const t=document.getElementById("footer");new IntersectionObserver((s,g)=>{s.forEach(l=>{l.isIntersecting&&m("loadMore")})}).observe(t)}),de(()=>{window.removeEventListener("resize",C)}),(t,e)=>(p(),w("div",Ie,[o("div",Me,[o("div",{id:"wapper",ref_key:"wapperRef",ref:d,class:"wapper",style:M({height:`${r.value}px`})},[(p(!0),w(pe,null,ve(t.dataList,(s,g)=>(p(),w("div",{id:s.id.toString(),key:g,ref_for:!0,ref:l=>J(l,s),class:"wapper-item",style:M({width:`${u.value}px`})},[f(fe,{name:"img",css:!0},{default:v(()=>[o("img",{id:s.id.toString(),class:"item-file rounded-sm",style:M({width:`${u.value}px`,height:`${H.value(s)}px`}),src:s.drawUrl,loading:"lazy",onLoad:l=>X(l,s),onError:l=>Y(l,s),onClick:l=>se(s)},null,44,We)]),_:2},1024),o("div",Ne,[o("div",Re,he(s.fullPrompt),1),o("div",je,[t.isDrawLike?(p(),R(i(z),{key:0,trigger:"hover"},{trigger:v(()=>[o("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:j(l=>ee(s),["stop"])},[o("span",ze,[f(i(B),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,Be)]),default:v(()=>[e[0]||(e[0]=o("span",null,"画同款",-1))]),_:2},1024)):P("",!0),t.usePropmpt?(p(),R(i(z),{key:1,trigger:"hover"},{trigger:v(()=>[o("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:j(l=>te(s),["stop"])},[o("span",Ee,[f(i(B),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,De)]),default:v(()=>[e[1]||(e[1]=o("span",null,"使用当前画同款",-1))]),_:2},1024)):P("",!0),t.copyPropmpt?(p(),R(i(z),{key:2,trigger:"hover"},{trigger:v(()=>[o("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:j(l=>Z(s),["stop"])},[o("span",Se,[f(i(B),{icon:"tabler:copy",class:"text-sm"})])],8,He)]),default:v(()=>[e[2]||(e[2]=o("span",null,"复制提示词",-1))]),_:2},1024)):P("",!0)])]),k.value.includes(s.id)?P("",!0):(p(),w("div",{key:0,class:"item-loading",style:M({width:`${u.value}px`,height:`${H.value(s)}px`})},null,4))],12,Pe))),128)),e[3]||(e[3]=o("div",{id:"footer",class:"w-full absolute bottom-[350px]"},null,-1))],4)])]))}});const Te={class:"bg-[#fff] h-[100vh] overflow-hidden p-4 pr-0 dark:bg-[#18181c] flex flex-col"},Ue={class:"p-4 flex pr-6 justify-between items-center"},Fe={class:"w-[200px] sm:w-[300px] flex justify-between"},Oe={class:"flex-1 ml-5"},Ve={class:"px-4 mb-1 pr-5"},qe={class:"market overflow-y-scroll flex-1 min-h-screen p-4 dark:bg-[#18181c] relative"},Xe=D({__name:"index",setup(N){const h=n([]),x=n(null),a=n(50),m=n(""),_=n(1),$=n(20),y=n(!1),L=n(!0),u=W(()=>m.value?h.value.filter(d=>{const{prompt:r}=d;return r.includes(m.value)}):h.value);async function c(){y.value=!0;const d=await ge({page:_.value,size:$.value,rec:1});y.value=!1,L.value=$.value===d.data.rows.length,h.value=[...h.value,...d.data.rows]}V(async()=>{await c()});function k(){_.value=_.value+1,c()}return(d,r)=>(p(),w("div",Te,[o("div",Ue,[r[3]||(r[3]=o("div",{class:"font-bold text-xl"},"AI绘画广场",-1)),o("div",Fe,[r[2]||(r[2]=o("span",{class:"hidden sm:block"},"尺寸调整",-1)),o("div",Oe,[f(i(we),{value:a.value,"onUpdate:value":r[0]||(r[0]=b=>a.value=b),step:10},null,8,["value"])])])]),o("div",Ve,[f(i(_e),{value:m.value,"onUpdate:value":r[1]||(r[1]=b=>m.value=b),placeholder:"prompt关键词搜索"},{prefix:v(()=>[f(i(xe),{component:i(Ce)},null,8,["component"])]),_:1},8,["value"])]),o("div",qe,[o("div",{id:"wapper",ref_key:"wapperRef",ref:x,class:"wapper"},[f(Ae,{onLoadMore:k,copyPropmpt:"",isDrawLike:"",dataList:u.value,scaleWidth:a.value},null,8,["dataList","scaleWidth"])],512)])]))}});export{Xe as default};
