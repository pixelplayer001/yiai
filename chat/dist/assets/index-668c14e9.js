import{d as S,D as E,u as z,C as V,b as G,e as I,r as w,o as C,c as B,a as e,t as l,k as n,q as s,A as D,l as i,I as _,H as g,E as H,_ as y,F as R,j as q,bN as Y,aa as N,h as K,m as L,cT as Q,M as W,J as T,al as X}from"./index-768c9aff.js";import{N as Z}from"./Popconfirm-7a68a3e7.js";import{N as ee}from"./Select-fc7266b8.js";function se(){const m=new Date,c=m.getDate(),d=m.getMonth()+1;return`${m.getFullYear()}-${d}-${c}`}const te={class:"p-4 space-y-5 min-h-[200px]"},ae={class:"space-y-6"},ne={class:"flex items-center space-x-4"},oe={class:"flex-shrink-0 w-[100px]"},le={class:"flex-1"},ie={class:"flex items-center space-x-4"},re={class:"flex-shrink-0 w-[100px]"},ce={class:"w-[200px]"},ue={class:"flex-shrink-0 w-[100px]"},de={class:"flex flex-wrap items-center gap-4"},pe={class:"flex items-center space-x-4"},fe={class:"flex-shrink-0 w-[100px]"},me={class:"flex flex-wrap items-center gap-4"},ve={class:"flex items-center space-x-4"},he={class:"flex-shrink-0 w-[100px]"},xe={class:"flex flex-wrap items-center gap-4"},_e=S({__name:"General",setup(m){const c=E(),d=z(),{isMobile:p}=V(),u=G(),h=I(()=>c.theme),f=I(()=>d.userInfo),a=w(f.value.avatar??""),v=w(f.value.username??""),k=w(!1),M=I({get(){return c.language},set(t){c.setLanguage(t)}}),O=[{label:"Auto",key:"auto",icon:"ri:contrast-line"},{label:"Light",key:"light",icon:"ri:sun-foggy-line"},{label:"Dark",key:"dark",icon:"ri:moon-foggy-line"}],A=[{label:"简体中文",key:"zh-CN",value:"zh-CN"}];async function U(t){try{k.value=!0;const o=await Y(t);if(k.value=!1,!o.success)return u.error(o.message);u.success(N("common.updateUserSuccess")),d.getUserInfo()}catch{k.value=!1}}function F(){const t=se(),o=localStorage.getItem("chatStorage")||"{}",r=JSON.stringify(JSON.parse(o),null,2),x=new Blob([r],{type:"application/json"}),b=URL.createObjectURL(x),$=document.createElement("a");$.href=b,$.download=`chat-store_${t}.json`,document.body.appendChild($),$.click(),document.body.removeChild($)}function J(t){const o=t.target;if(!o||!o.files)return;const r=o.files[0];if(!r)return;const x=new FileReader;x.onload=()=>{try{const b=JSON.parse(x.result);localStorage.setItem("chatStorage",JSON.stringify(b)),u.success(N("common.success")),location.reload()}catch{u.error(N("common.invalidFileFormat"))}},x.readAsText(r)}function j(){localStorage.removeItem("chatStorage"),location.reload()}function P(){const t=document.getElementById("fileInput");t&&t.click()}return(t,o)=>(C(),B("div",te,[e("div",ae,[e("div",ne,[e("span",oe,l(t.$t("setting.avatarLink")),1),e("div",le,[n(s(D),{value:a.value,"onUpdate:value":o[0]||(o[0]=r=>a.value=r),placeholder:"请填写头像地址"},null,8,["value"])]),n(s(g),{size:"tiny",disabled:k.value,text:"",type:"primary",onClick:o[1]||(o[1]=r=>U({avatar:a.value}))},{default:i(()=>[_(l(t.$t("common.update")),1)]),_:1},8,["disabled"])]),e("div",ie,[e("span",re,l(t.$t("setting.name")),1),e("div",ce,[n(s(D),{value:v.value,"onUpdate:value":o[2]||(o[2]=r=>v.value=r),placeholder:"请填写用户名"},null,8,["value"])]),n(s(g),{size:"tiny",disabled:k.value,text:"",type:"primary",onClick:o[3]||(o[3]=r=>U({username:v.value}))},{default:i(()=>[_(l(t.$t("common.update")),1)]),_:1},8,["disabled"])]),e("div",{class:H(["flex items-center space-x-4",s(p)&&"items-start"])},[e("span",ue,l(t.$t("setting.chatHistory")),1),e("div",de,[n(s(g),{size:"small",onClick:F},{icon:i(()=>[n(s(y),{icon:"ri:download-2-fill"})]),default:i(()=>[_(" "+l(t.$t("common.export")),1)]),_:1}),e("input",{id:"fileInput",type:"file",style:{display:"none"},onChange:J},null,32),n(s(g),{size:"small",onClick:P},{icon:i(()=>[n(s(y),{icon:"ri:upload-2-fill"})]),default:i(()=>[_(" "+l(t.$t("common.import")),1)]),_:1}),n(s(Z),{placement:"bottom",onPositiveClick:j},{trigger:i(()=>[n(s(g),{size:"small"},{icon:i(()=>[n(s(y),{icon:"ri:close-circle-line"})]),default:i(()=>[_(" "+l(t.$t("common.clear")),1)]),_:1})]),default:i(()=>[_(" "+l(t.$t("chat.clearHistoryConfirm")),1)]),_:1})])],2),e("div",pe,[e("span",fe,l(t.$t("setting.theme")),1),e("div",me,[(C(),B(R,null,q(O,r=>n(s(g),{key:r.key,size:"small",type:r.key===h.value?"primary":void 0,onClick:x=>s(c).setTheme(r.key)},{icon:i(()=>[n(s(y),{icon:r.icon},null,8,["icon"])]),_:2},1032,["type","onClick"])),64))])]),e("div",ve,[e("span",he,l(t.$t("setting.language")),1),e("div",xe,[n(s(ee),{style:{width:"140px"},value:M.value,options:A,onUpdateValue:o[4]||(o[4]=r=>s(c).setLanguage(r))},null,8,["value"])])])])]))}}),ge={class:"p-4 space-y-5 min-h-[200px]"},ye={class:"flex items-center space-x-4"},ke={class:"w-[200px]"},$e={class:"flex items-center space-x-4"},we={class:"w-[200px]"},be={class:"flex items-center space-x-4"},Ie={class:"w-[200px]"},Ce={class:"flex items-center space-x-4"},Ne={class:"w-[200px]"},Se={class:"flex items-center space-x-4"},Ue={class:"w-[200px]"},Be={class:"flex items-center space-x-4"},De={class:"w-[200px]"},Te=S({__name:"Personal",setup(m){const c=z(),{userInfo:d,userBalance:p}=c,u=w(!1);K(async()=>{h()});async function h(){try{u.value=!0,await c.getUserInfo(),u.value=!1}catch{u.value=!1}}return(f,a)=>(C(),L(s(Q),{show:u.value},{default:i(()=>[e("div",ge,[e("div",ye,[a[0]||(a[0]=e("span",{class:"flex-shrink-0 w-[100px]"},"用户邮箱",-1)),e("div",ke,l(s(d).email||"--"),1)]),e("div",$e,[a[1]||(a[1]=e("span",{class:"flex-shrink-0 w-[100px]"},"用户姓名",-1)),e("div",we,l(s(d).username||"--"),1)]),e("div",be,[a[2]||(a[2]=e("span",{class:"flex-shrink-0 w-[100px]"},"问答余额",-1)),e("div",Ie,l(s(p).usesLeft||"0")+" 积分 ",1)]),e("div",Ce,[a[3]||(a[3]=e("span",{class:"flex-shrink-0 w-[100px]"},"绘画余额",-1)),e("div",Ne,l(s(p).paintCount||"0")+" 积分 ",1)]),e("div",Se,[a[4]||(a[4]=e("span",{class:"flex-shrink-0 w-[100px]"},"MJToken",-1)),e("div",Ue,l(s(p).balance||"0")+" Token ",1)]),e("div",Be,[a[5]||(a[5]=e("span",{class:"flex-shrink-0 w-[100px]"},"使用金额",-1)),e("div",De,l(s(p).useTokens||"0")+" Token ",1)])])]),_:1},8,["show"]))}}),ze={class:"ml-2"},Le={class:"ml-2"},Me={class:"min-h-[100px]"},Je=S({__name:"index",props:{visible:{type:Boolean}},emits:["update:visible"],setup(m,{emit:c}){const d=m,p=c,u=w("personalInfo"),h=I({get(){return d.visible},set(f){p("update:visible",f)}});return(f,a)=>(C(),L(s(X),{show:h.value,"onUpdate:show":a[1]||(a[1]=v=>h.value=v),title:"个人中心","auto-focus":!1,preset:"card",style:{width:"95%","max-width":"640px"}},{default:i(()=>[e("div",null,[n(s(W),{value:u.value,"onUpdate:value":a[0]||(a[0]=v=>u.value=v),type:"line",animated:""},{default:i(()=>[n(s(T),{name:"personalInfo",tab:"personalInfo"},{tab:i(()=>[n(s(y),{class:"text-lg",icon:"ri:file-user-line"}),e("span",ze,l(f.$t("setting.personalInfo")),1)]),default:i(()=>[n(Te)]),_:1}),n(s(T),{name:"General",tab:"General"},{tab:i(()=>[n(s(y),{class:"text-lg",icon:"ri:list-settings-line"}),e("span",Le,l(f.$t("setting.general")),1)]),default:i(()=>[e("div",Me,[n(_e)])]),_:1})]),_:1},8,["value"])])]),_:1},8,["show"]))}});export{Je as default};
