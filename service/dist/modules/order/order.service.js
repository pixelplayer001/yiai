'use strict';const _0x4fd2df=_0x24eb;(function(_0x4e7a22,_0x177800){const _0x25e7fa=_0x24eb,_0xb09687=_0x4e7a22();while(!![]){try{const _0xeb1d62=-parseInt(_0x25e7fa(0x9e))/0x1+-parseInt(_0x25e7fa(0x80))/0x2*(-parseInt(_0x25e7fa(0xb5))/0x3)+parseInt(_0x25e7fa(0x8e))/0x4+-parseInt(_0x25e7fa(0xac))/0x5*(-parseInt(_0x25e7fa(0x91))/0x6)+-parseInt(_0x25e7fa(0x8b))/0x7+parseInt(_0x25e7fa(0x88))/0x8*(-parseInt(_0x25e7fa(0xae))/0x9)+parseInt(_0x25e7fa(0x74))/0xa;if(_0xeb1d62===_0x177800)break;else _0xb09687['push'](_0xb09687['shift']());}catch(_0x24850d){_0xb09687['push'](_0xb09687['shift']());}}}(_0x5f3f,0x56fcb));var __decorate=this&&this[_0x4fd2df(0x8d)]||function(_0x4ee558,_0x264f12,_0x251e94,_0x1001cf){const _0x206662=_0x4fd2df;var _0x3c49c2=arguments['length'],_0x5e8d2a=_0x3c49c2<0x3?_0x264f12:_0x1001cf===null?_0x1001cf=Object[_0x206662(0xc2)](_0x264f12,_0x251e94):_0x1001cf,_0x804846;if(typeof Reflect===_0x206662(0xa7)&&typeof Reflect[_0x206662(0xb7)]===_0x206662(0x81))_0x5e8d2a=Reflect[_0x206662(0xb7)](_0x4ee558,_0x264f12,_0x251e94,_0x1001cf);else{for(var _0x3ff292=_0x4ee558[_0x206662(0xb8)]-0x1;_0x3ff292>=0x0;_0x3ff292--)if(_0x804846=_0x4ee558[_0x3ff292])_0x5e8d2a=(_0x3c49c2<0x3?_0x804846(_0x5e8d2a):_0x3c49c2>0x3?_0x804846(_0x264f12,_0x251e94,_0x5e8d2a):_0x804846(_0x264f12,_0x251e94))||_0x5e8d2a;}return _0x3c49c2>0x3&&_0x5e8d2a&&Object[_0x206662(0x9d)](_0x264f12,_0x251e94,_0x5e8d2a),_0x5e8d2a;},__metadata=this&&this['__metadata']||function(_0x347590,_0x5c9f15){const _0x2cfc0d=_0x4fd2df;if(typeof Reflect===_0x2cfc0d(0xa7)&&typeof Reflect[_0x2cfc0d(0xbb)]==='function')return Reflect['metadata'](_0x347590,_0x5c9f15);},__param=this&&this[_0x4fd2df(0xb0)]||function(_0x164399,_0x2a0fd5){return function(_0x27abfe,_0x4b8422){_0x2a0fd5(_0x27abfe,_0x4b8422,_0x164399);};};Object[_0x4fd2df(0x9d)](exports,_0x4fd2df(0x7e),{'value':!![]}),exports[_0x4fd2df(0xa8)]=void 0x0;const user_entity_1=require(_0x4fd2df(0x7d)),typeorm_1=require(_0x4fd2df(0xb4)),common_1=require(_0x4fd2df(0x90)),typeorm_2=require(_0x4fd2df(0xc7)),order_entity_1=require(_0x4fd2df(0x84)),cramiPackage_entity_1=require('../crami/cramiPackage.entity'),utils_1=require('../../common/utils'),pay_service_1=require(_0x4fd2df(0xa5)),globalConfig_service_1=require(_0x4fd2df(0xbf));function _0x5f3f(){const _0x367ea5=['@nestjs/common','2124JRdldd','购买失败!','orderEntity','design:paramtypes','UNAUTHORIZED','deleteOrder','query','userId','findAndCount','total_price','createOrderId','count','defineProperty','470427SHsteb','total','name','deleteNotPay','payPlatform','order','queryByOrderId','../pay/pay.service','save','object','OrderService','where','create','queryAllOrder','505iveHri','InjectRepository','91314HONuEt','queryPayType','__param','orderId','payService','goodsInfo','@nestjs/typeorm','21zJMmAe','channel','decorate','length','buy','status','metadata','userInfo','assign','getRawOne','../globalConfig/globalConfig.service','globalConfigService','OrderEntity','getOwnPropertyDescriptor','message','PayService','goodsId','email','typeorm','username','GlobalConfigService','map','cramiPackageEntity','CramiPackageEntity','16973600pSkVqL','HttpStatus','HttpException','pay','delete','userEntity','order:\x20','find','Repository','../user/user.entity','__esModule','UserEntity','1466EjOtcz','function','Injectable','coverImg','./order.entity','DESC','createQueryBuilder','findOne','456OVZIYH','BAD_REQUEST','price','4625425POMfBC','forEach','__decorate','1310312turbzG','订单不存在!'];_0x5f3f=function(){return _0x367ea5;};return _0x5f3f();}function _0x24eb(_0x7b7868,_0x53d304){const _0x5f3f03=_0x5f3f();return _0x24eb=function(_0x24ebb6,_0x20efae){_0x24ebb6=_0x24ebb6-0x74;let _0x582cd0=_0x5f3f03[_0x24ebb6];return _0x582cd0;},_0x24eb(_0x7b7868,_0x53d304);}let OrderService=class OrderService{constructor(_0x3406ca,_0x3a25ab,_0x187eb8,_0x4c81ca,_0x46188f){const _0x4a6bf7=_0x4fd2df;this['orderEntity']=_0x3406ca,this[_0x4a6bf7(0xcb)]=_0x3a25ab,this[_0x4a6bf7(0x79)]=_0x187eb8,this[_0x4a6bf7(0xb2)]=_0x4c81ca,this[_0x4a6bf7(0xc0)]=_0x46188f;}async[_0x4fd2df(0xb9)](_0x3c931d,_0xe8fb04){const _0x399bf7=_0x4fd2df;try{const {goodsId:_0x58f995,count:count=0x1,payType:_0x3cb9c6}=_0x3c931d,{id:_0x1fa029}=_0xe8fb04['user'];if(_0x1fa029>0xf4240)throw new common_1[(_0x399bf7(0x76))]('请先注册账号后购买商品！',common_1[_0x399bf7(0x75)][_0x399bf7(0x95)]);const _0x2e0008=await this[_0x399bf7(0xaa)](_0x1fa029,_0x58f995,count,_0x3cb9c6),_0x2d8154=await this[_0x399bf7(0xb2)][_0x399bf7(0x77)](_0x1fa029,_0x2e0008[_0x399bf7(0xb1)],_0x3cb9c6);return Object[_0x399bf7(0xbd)](Object[_0x399bf7(0xbd)]({},_0x2d8154),{'orderId':_0x2e0008[_0x399bf7(0xb1)],'platform':_0x2e0008[_0x399bf7(0xa2)],'total':_0x2e0008[_0x399bf7(0x9f)]});}catch(_0x113990){if(_0x113990['status']===0x191)throw new common_1[(_0x399bf7(0x76))](_0x113990[_0x399bf7(0xc3)],common_1[_0x399bf7(0x75)][_0x399bf7(0x95)]);throw new common_1[(_0x399bf7(0x76))](_0x113990[_0x399bf7(0xc3)]||_0x399bf7(0x92),common_1[_0x399bf7(0x75)][_0x399bf7(0x89)]);}}async[_0x4fd2df(0xa4)](_0x464403,_0x5b8dcf){const _0xbacec6=_0x4fd2df,{id:_0x220520}=_0x464403['user'],{orderId:_0xd897c4}=_0x5b8dcf,_0x2524a2=await this[_0xbacec6(0x93)]['findOne']({'where':{'userId':_0x220520,'orderId':_0xd897c4}});if(!_0x2524a2)throw new common_1[(_0xbacec6(0x76))](_0xbacec6(0x8f),common_1[_0xbacec6(0x75)][_0xbacec6(0x89)]);return _0x2524a2;}async[_0x4fd2df(0xaa)](_0xb1d00d,_0x5bb8b3,_0x5b7239,_0x174a8d){const _0x4b6673=_0x4fd2df,_0x13220f=await this[_0x4b6673(0xc0)][_0x4b6673(0xaf)](),_0xfb5f5a=await this[_0x4b6673(0xcb)][_0x4b6673(0x87)]({'where':{'id':_0x5bb8b3}});if(!_0xfb5f5a)throw new common_1[(_0x4b6673(0x76))]('套餐不存在!',common_1[_0x4b6673(0x75)]['BAD_REQUEST']);const _0x25bc91={};_0x25bc91[_0x4b6673(0xb1)]=(0x0,utils_1[_0x4b6673(0x9b)])(),_0x25bc91['userId']=_0xb1d00d,_0x25bc91[_0x4b6673(0xc5)]=_0x5bb8b3,_0x25bc91[_0x4b6673(0x8a)]=Number(_0xfb5f5a[_0x4b6673(0x8a)]),_0x25bc91[_0x4b6673(0x9c)]=_0x5b7239,_0x25bc91[_0x4b6673(0x9f)]=Number(_0xfb5f5a[_0x4b6673(0x8a)])*_0x5b7239,_0x25bc91['payPlatform']=_0x13220f,_0x25bc91[_0x4b6673(0xb6)]=_0x174a8d;const _0x5011bf=await this[_0x4b6673(0x93)][_0x4b6673(0xa6)](_0x25bc91);return console['log'](_0x4b6673(0x7a),_0x5011bf),_0x5011bf;}async[_0x4fd2df(0x97)](_0x42ec56,_0x38eee1,_0x32bdd9){const _0x3f8e32=_0x4fd2df;return await this[_0x3f8e32(0x93)][_0x3f8e32(0x99)]({'where':{'userId':_0x42ec56},'order':{'id':_0x3f8e32(0x85)},'skip':(_0x38eee1-0x1)*_0x32bdd9,'take':_0x32bdd9});}async[_0x4fd2df(0xab)](_0x5a50a7){const _0x35e6f0=_0x4fd2df,{page:_0x4aa5a6,size:_0x264722,userId:_0x2b0e4b,platform:_0x1909a4,status:_0x2bf81a}=_0x5a50a7,_0x6eae79={};if(_0x2b0e4b)_0x6eae79[_0x35e6f0(0x98)]=_0x2b0e4b;if(_0x1909a4)_0x6eae79[_0x35e6f0(0xa2)]=_0x1909a4;if(_0x2bf81a)_0x6eae79[_0x35e6f0(0xba)]=_0x2bf81a;const [_0x1996d6,_0x4cfa05]=await this['orderEntity'][_0x35e6f0(0x99)]({'order':{'id':_0x35e6f0(0x85)},'where':_0x6eae79,'skip':(_0x4aa5a6-0x1)*_0x264722,'take':_0x264722}),_0x32cf08=_0x1996d6[_0x35e6f0(0xca)](_0xf009b0=>_0xf009b0['userId']),_0xb7ee53=_0x1996d6['map'](_0x3507fd=>_0x3507fd[_0x35e6f0(0xc5)]),_0x39fc39=await this[_0x35e6f0(0x79)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x32cf08)},'select':['id',_0x35e6f0(0xc8),_0x35e6f0(0xc6)]}),_0xa49b2c=await this[_0x35e6f0(0xcb)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0xb7ee53)},'select':['id',_0x35e6f0(0xa0),_0x35e6f0(0x83),'des']});_0x1996d6[_0x35e6f0(0x8c)](_0x2ff0e9=>{const _0x41db1d=_0x35e6f0;_0x2ff0e9[_0x41db1d(0xbc)]=_0x39fc39[_0x41db1d(0x7b)](_0x8e2040=>_0x8e2040['id']===_0x2ff0e9['userId']),_0x2ff0e9[_0x41db1d(0xb3)]=_0xa49b2c[_0x41db1d(0x7b)](_0x43d60b=>_0x43d60b['id']===_0x2ff0e9[_0x41db1d(0xc5)]);});const _0x4de35a=await this['orderEntity'][_0x35e6f0(0x86)](_0x35e6f0(0xa3))[_0x35e6f0(0xa9)]('order.status\x20=\x20:status',{'status':0x1})['select']('SUM(order.price)',_0x35e6f0(0x9a))[_0x35e6f0(0xbe)]();return Object['assign']({'rows':_0x1996d6,'count':_0x4cfa05},_0x4de35a);}async[_0x4fd2df(0x96)](_0xf9704f){const _0x31b3d9=_0x4fd2df,{orderId:_0x3c2b86}=_0xf9704f,_0x16f30d=await this[_0x31b3d9(0x93)]['findOne']({'where':{'orderId':_0x3c2b86}});if(!_0x16f30d)throw new common_1[(_0x31b3d9(0x76))]('订单不存在!',common_1[_0x31b3d9(0x75)][_0x31b3d9(0x89)]);return await this[_0x31b3d9(0x93)][_0x31b3d9(0x78)]({'orderId':_0x3c2b86});}async[_0x4fd2df(0xa1)](){const _0x47bd5c=_0x4fd2df;return await this[_0x47bd5c(0x93)][_0x47bd5c(0x78)]({'status':0x0});}};OrderService=__decorate([(0x0,common_1[_0x4fd2df(0x82)])(),__param(0x0,(0x0,typeorm_1[_0x4fd2df(0xad)])(order_entity_1[_0x4fd2df(0xc1)])),__param(0x1,(0x0,typeorm_1[_0x4fd2df(0xad)])(cramiPackage_entity_1[_0x4fd2df(0xcc)])),__param(0x2,(0x0,typeorm_1[_0x4fd2df(0xad)])(user_entity_1[_0x4fd2df(0x7f)])),__metadata(_0x4fd2df(0x94),[typeorm_2[_0x4fd2df(0x7c)],typeorm_2[_0x4fd2df(0x7c)],typeorm_2['Repository'],pay_service_1[_0x4fd2df(0xc4)],globalConfig_service_1[_0x4fd2df(0xc9)]])],OrderService),exports['OrderService']=OrderService;