'use strict';const _0xf902e2=_0x2fff;(function(_0x3057c4,_0x951d71){const _0x57e1da=_0x2fff,_0x3891d9=_0x3057c4();while(!![]){try{const _0x194eb0=-parseInt(_0x57e1da(0x192))/0x1+-parseInt(_0x57e1da(0x189))/0x2*(-parseInt(_0x57e1da(0x1a4))/0x3)+parseInt(_0x57e1da(0x186))/0x4+parseInt(_0x57e1da(0x1c9))/0x5*(parseInt(_0x57e1da(0x1b6))/0x6)+-parseInt(_0x57e1da(0x1be))/0x7*(-parseInt(_0x57e1da(0x19f))/0x8)+-parseInt(_0x57e1da(0x1a6))/0x9*(parseInt(_0x57e1da(0x1c1))/0xa)+-parseInt(_0x57e1da(0x1b0))/0xb;if(_0x194eb0===_0x951d71)break;else _0x3891d9['push'](_0x3891d9['shift']());}catch(_0x715c25){_0x3891d9['push'](_0x3891d9['shift']());}}}(_0x3ba7,0x586a2));var __decorate=this&&this[_0xf902e2(0x1c5)]||function(_0x26dc8a,_0x126c7b,_0x19a606,_0x14b0fe){const _0x5d8e44=_0xf902e2;var _0x2ef962=arguments[_0x5d8e44(0x1bf)],_0x145e89=_0x2ef962<0x3?_0x126c7b:_0x14b0fe===null?_0x14b0fe=Object[_0x5d8e44(0x1ae)](_0x126c7b,_0x19a606):_0x14b0fe,_0x30239e;if(typeof Reflect===_0x5d8e44(0x1ac)&&typeof Reflect['decorate']===_0x5d8e44(0x193))_0x145e89=Reflect['decorate'](_0x26dc8a,_0x126c7b,_0x19a606,_0x14b0fe);else{for(var _0x2dcb96=_0x26dc8a[_0x5d8e44(0x1bf)]-0x1;_0x2dcb96>=0x0;_0x2dcb96--)if(_0x30239e=_0x26dc8a[_0x2dcb96])_0x145e89=(_0x2ef962<0x3?_0x30239e(_0x145e89):_0x2ef962>0x3?_0x30239e(_0x126c7b,_0x19a606,_0x145e89):_0x30239e(_0x126c7b,_0x19a606))||_0x145e89;}return _0x2ef962>0x3&&_0x145e89&&Object[_0x5d8e44(0x191)](_0x126c7b,_0x19a606,_0x145e89),_0x145e89;},__metadata=this&&this['__metadata']||function(_0x4c4757,_0x5f50c4){const _0x3a98de=_0xf902e2;if(typeof Reflect===_0x3a98de(0x1ac)&&typeof Reflect[_0x3a98de(0x1b4)]===_0x3a98de(0x193))return Reflect[_0x3a98de(0x1b4)](_0x4c4757,_0x5f50c4);},__param=this&&this[_0xf902e2(0x194)]||function(_0x4acdd3,_0x2e0ba2){return function(_0x3d8fec,_0x3227be){_0x2e0ba2(_0x3d8fec,_0x3227be,_0x4acdd3);};};Object[_0xf902e2(0x191)](exports,'__esModule',{'value':!![]}),exports[_0xf902e2(0x1c2)]=void 0x0;const common_1=require(_0xf902e2(0x1a8)),chatGroup_entity_1=require(_0xf902e2(0x1bd)),typeorm_1=require(_0xf902e2(0x1c8)),typeorm_2=require(_0xf902e2(0x18b)),app_entity_1=require(_0xf902e2(0x198)),models_service_1=require('../models/models.service');let ChatGroupService=class ChatGroupService{constructor(_0xd13475,_0x42a24c,_0x5a5244){const _0x27070c=_0xf902e2;this[_0x27070c(0x1a9)]=_0xd13475,this[_0x27070c(0x1a3)]=_0x42a24c,this[_0x27070c(0x185)]=_0x5a5244;}async[_0xf902e2(0x18d)](_0x1f70d7,_0x17b23e){const _0x57b455=_0xf902e2,{id:_0x2b6f7f}=_0x17b23e[_0x57b455(0x187)],{appId:_0x143190}=_0x1f70d7,_0x1ac837={'title':_0x57b455(0x188),'userId':_0x2b6f7f};if(_0x143190){const _0x145e44=await this[_0x57b455(0x1a3)][_0x57b455(0x1b7)]({'where':{'id':_0x143190}});if(!_0x145e44)throw new common_1[(_0x57b455(0x1ad))]('非法操作、您在使用一个不存在的应用！',common_1['HttpStatus'][_0x57b455(0x1ba)]);else{const {status:_0x24ee46,name:_0x2c5020}=_0x145e44,_0x2f610f=await this[_0x57b455(0x1a9)][_0x57b455(0x1b5)]({'where':{'userId':_0x2b6f7f,'appId':_0x143190,'isDelete':![]}});if(_0x2f610f>0x0)throw new common_1[(_0x57b455(0x1ad))](_0x57b455(0x1a5),common_1[_0x57b455(0x1b1)][_0x57b455(0x1ba)]);if(![0x1,0x3,0x4,0x5][_0x57b455(0x1aa)](_0x24ee46))throw new common_1[(_0x57b455(0x1ad))](_0x57b455(0x18a),common_1[_0x57b455(0x1b1)][_0x57b455(0x1ba)]);_0x2c5020&&(_0x1ac837[_0x57b455(0x18f)]=_0x2c5020),_0x143190&&(_0x1ac837[_0x57b455(0x1af)]=_0x143190);}}const _0x372314=await this[_0x57b455(0x185)][_0x57b455(0x1a0)](_0x143190);_0x143190&&(_0x372314[_0x57b455(0x1af)]=_0x143190);if(!_0x372314)throw new common_1['HttpException'](_0x57b455(0x1b2),common_1[_0x57b455(0x1b1)]['BAD_REQUEST']);return await this[_0x57b455(0x1a9)]['save'](Object[_0x57b455(0x184)](Object[_0x57b455(0x184)]({},_0x1ac837),{'config':JSON[_0x57b455(0x1a7)](_0x372314)}));}async[_0xf902e2(0x190)](_0x13bbae){const _0x8e3ce2=_0xf902e2;try{const {id:_0x26321d}=_0x13bbae[_0x8e3ce2(0x187)],_0x5755e0={'userId':_0x26321d,'isDelete':![]},_0x7a1226=await this[_0x8e3ce2(0x1a9)][_0x8e3ce2(0x18e)]({'where':_0x5755e0,'order':{'isSticky':_0x8e3ce2(0x197),'id':_0x8e3ce2(0x197)}}),_0x36eddc=_0x7a1226[_0x8e3ce2(0x1ca)](_0xca2950=>_0xca2950['appId'])['map'](_0x1be5e8=>_0x1be5e8[_0x8e3ce2(0x1af)]),_0x317829=await this['appEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x36eddc)}});return _0x7a1226[_0x8e3ce2(0x1c4)](_0x42b7ef=>{const _0xa66d4a=_0x8e3ce2;var _0x388c06;return _0x42b7ef[_0xa66d4a(0x1ab)]=(_0x388c06=_0x317829[_0xa66d4a(0x18e)](_0x116d6e=>_0x116d6e['id']===_0x42b7ef['appId']))===null||_0x388c06===void 0x0?void 0x0:_0x388c06['coverImg'],_0x42b7ef;});}catch(_0x6765b2){console[_0x8e3ce2(0x199)](_0x8e3ce2(0x19a),_0x6765b2);}}async[_0xf902e2(0x19e)](_0x190d05,_0x32a549){const _0x3d83a9=_0xf902e2,{title:_0x432e18,isSticky:_0x47da0b,groupId:_0x53aa2b,config:_0xb1e156}=_0x190d05,{id:_0x35fa1b}=_0x32a549[_0x3d83a9(0x187)],_0x3ac39a=await this[_0x3d83a9(0x1a9)]['findOne']({'where':{'id':_0x53aa2b,'userId':_0x35fa1b}});if(!_0x3ac39a)throw new common_1['HttpException'](_0x3d83a9(0x1a2),common_1[_0x3d83a9(0x1b1)][_0x3d83a9(0x1ba)]);const {appId:_0x457af8}=_0x3ac39a;if(_0x457af8&&!_0x432e18)try{const _0x1b9eb4=JSON[_0x3d83a9(0x1bb)](_0xb1e156);if(Number(_0x1b9eb4[_0x3d83a9(0x1bc)])!==0x1)throw new common_1['HttpException'](_0x3d83a9(0x1c6),common_1[_0x3d83a9(0x1b1)][_0x3d83a9(0x1ba)]);}catch(_0xe2e956){}const _0x2a1a85={};_0x432e18&&(_0x2a1a85['title']=_0x432e18),typeof _0x47da0b!==_0x3d83a9(0x19c)&&(_0x2a1a85['isSticky']=_0x47da0b),_0xb1e156&&(_0x2a1a85[_0x3d83a9(0x1b3)]=_0xb1e156);const _0x373609=await this['chatGroupEntity']['update']({'id':_0x53aa2b},_0x2a1a85);if(_0x373609[_0x3d83a9(0x19b)])return!![];else throw new common_1[(_0x3d83a9(0x1ad))]('更新对话失败！',common_1[_0x3d83a9(0x1b1)]['BAD_REQUEST']);}async[_0xf902e2(0x1c3)](_0x1f13ab,_0x2431d1){const _0x5bbaa0=_0xf902e2,{groupId:_0x38de9c}=_0x1f13ab,{id:_0x1e28f0}=_0x2431d1[_0x5bbaa0(0x187)],_0x14c215=await this['chatGroupEntity'][_0x5bbaa0(0x1b7)]({'where':{'id':_0x38de9c,'userId':_0x1e28f0}});if(!_0x14c215)throw new common_1['HttpException'](_0x5bbaa0(0x19d),common_1[_0x5bbaa0(0x1b1)][_0x5bbaa0(0x1ba)]);const _0x1634ec=await this[_0x5bbaa0(0x1a9)][_0x5bbaa0(0x19e)]({'id':_0x38de9c},{'isDelete':!![]});if(_0x1634ec['affected'])return'删除成功';else throw new common_1[(_0x5bbaa0(0x1ad))](_0x5bbaa0(0x195),common_1[_0x5bbaa0(0x1b1)][_0x5bbaa0(0x1ba)]);}async[_0xf902e2(0x1a1)](_0x283c2c){const _0x42f7b9=_0xf902e2,{id:_0x2a5d5c}=_0x283c2c[_0x42f7b9(0x187)],_0x503b3d=await this[_0x42f7b9(0x1a9)][_0x42f7b9(0x19e)]({'userId':_0x2a5d5c,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x503b3d[_0x42f7b9(0x19b)])return'删除成功';else throw new common_1['HttpException'](_0x42f7b9(0x195),common_1[_0x42f7b9(0x1b1)][_0x42f7b9(0x1ba)]);}async['getGroupInfoFromId'](_0x5d290f){const _0x1ee0aa=_0xf902e2;if(!_0x5d290f)return;return await this[_0x1ee0aa(0x1a9)][_0x1ee0aa(0x1b7)]({'where':{'id':_0x5d290f}});}};function _0x3ba7(){const _0x497d40=['filter','assign','modelsService','1086748lQSSoU','user','新对话','10820LYyrUQ','非法操作、您在使用一个未启用的应用！','typeorm','AppEntity','create','find','title','query','defineProperty','148408SaxaoT','function','__param','删除失败！','ModelsService','DESC','../app/app.entity','log','error:\x20','affected','undefined','非法操作、您在删除一个非法资源！','update','8ojnxgF','getBaseConfig','delAll','请先选择一个对话或者新加一个对话再操作！','appEntity','177XRyvBD','当前应用已经开启了一个对话无需新建了！','34704IZShTK','stringify','@nestjs/common','chatGroupEntity','includes','appLogo','object','HttpException','getOwnPropertyDescriptor','appId','6432063rNZJMG','HttpStatus','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','config','metadata','count','7950RINHmt','findOne','InjectRepository','ChatGroupEntity','BAD_REQUEST','parse','keyType','./chatGroup.entity','3579247KdPWKO','length','Repository','310cPkaHh','ChatGroupService','del','map','__decorate','应用对话名称不能修改哟！','Injectable','@nestjs/typeorm','425bzpkmX'];_0x3ba7=function(){return _0x497d40;};return _0x3ba7();}function _0x2fff(_0x5b12fd,_0x1624da){const _0x3ba71c=_0x3ba7();return _0x2fff=function(_0x2ffffb,_0x1a5a01){_0x2ffffb=_0x2ffffb-0x184;let _0x3d162=_0x3ba71c[_0x2ffffb];return _0x3d162;},_0x2fff(_0x5b12fd,_0x1624da);}ChatGroupService=__decorate([(0x0,common_1[_0xf902e2(0x1c7)])(),__param(0x0,(0x0,typeorm_1[_0xf902e2(0x1b8)])(chatGroup_entity_1[_0xf902e2(0x1b9)])),__param(0x1,(0x0,typeorm_1[_0xf902e2(0x1b8)])(app_entity_1[_0xf902e2(0x18c)])),__metadata('design:paramtypes',[typeorm_2[_0xf902e2(0x1c0)],typeorm_2[_0xf902e2(0x1c0)],models_service_1[_0xf902e2(0x196)]])],ChatGroupService),exports['ChatGroupService']=ChatGroupService;