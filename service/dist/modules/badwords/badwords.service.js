'use strict';function _0x3ef5(_0x582862,_0x325ac1){const _0x54ff58=_0x54ff();return _0x3ef5=function(_0x3ef586,_0x589f7d){_0x3ef586=_0x3ef586-0x19f;let _0x2d63e3=_0x54ff58[_0x3ef586];return _0x2d63e3;},_0x3ef5(_0x582862,_0x325ac1);}const _0x1decd7=_0x3ef5;(function(_0x57ba12,_0x239d72){const _0x3fa38b=_0x3ef5,_0xd809df=_0x57ba12();while(!![]){try{const _0x401aef=parseInt(_0x3fa38b(0x1ea))/0x1*(parseInt(_0x3fa38b(0x1b7))/0x2)+-parseInt(_0x3fa38b(0x1f9))/0x3*(-parseInt(_0x3fa38b(0x1ef))/0x4)+parseInt(_0x3fa38b(0x203))/0x5+parseInt(_0x3fa38b(0x1bb))/0x6+parseInt(_0x3fa38b(0x1cd))/0x7+parseInt(_0x3fa38b(0x1ec))/0x8*(parseInt(_0x3fa38b(0x1f0))/0x9)+parseInt(_0x3fa38b(0x1fc))/0xa*(-parseInt(_0x3fa38b(0x1e9))/0xb);if(_0x401aef===_0x239d72)break;else _0xd809df['push'](_0xd809df['shift']());}catch(_0x55adfb){_0xd809df['push'](_0xd809df['shift']());}}}(_0x54ff,0x33be2));var __decorate=this&&this[_0x1decd7(0x1bd)]||function(_0xa4c7d1,_0xfb1748,_0x27b6c4,_0x4d2ba8){const _0x9ddf54=_0x1decd7;var _0x3d33cb=arguments[_0x9ddf54(0x207)],_0x1fb94d=_0x3d33cb<0x3?_0xfb1748:_0x4d2ba8===null?_0x4d2ba8=Object[_0x9ddf54(0x1fa)](_0xfb1748,_0x27b6c4):_0x4d2ba8,_0x501664;if(typeof Reflect===_0x9ddf54(0x1e4)&&typeof Reflect[_0x9ddf54(0x1b2)]===_0x9ddf54(0x1bc))_0x1fb94d=Reflect[_0x9ddf54(0x1b2)](_0xa4c7d1,_0xfb1748,_0x27b6c4,_0x4d2ba8);else{for(var _0x2730aa=_0xa4c7d1[_0x9ddf54(0x207)]-0x1;_0x2730aa>=0x0;_0x2730aa--)if(_0x501664=_0xa4c7d1[_0x2730aa])_0x1fb94d=(_0x3d33cb<0x3?_0x501664(_0x1fb94d):_0x3d33cb>0x3?_0x501664(_0xfb1748,_0x27b6c4,_0x1fb94d):_0x501664(_0xfb1748,_0x27b6c4))||_0x1fb94d;}return _0x3d33cb>0x3&&_0x1fb94d&&Object[_0x9ddf54(0x1d4)](_0xfb1748,_0x27b6c4,_0x1fb94d),_0x1fb94d;},__metadata=this&&this['__metadata']||function(_0x59a2bf,_0x152020){const _0x39ca65=_0x1decd7;if(typeof Reflect===_0x39ca65(0x1e4)&&typeof Reflect[_0x39ca65(0x1f8)]===_0x39ca65(0x1bc))return Reflect[_0x39ca65(0x1f8)](_0x59a2bf,_0x152020);},__param=this&&this[_0x1decd7(0x1b9)]||function(_0x43890d,_0x229708){return function(_0x327e30,_0x2d3616){_0x229708(_0x327e30,_0x2d3616,_0x43890d);};};Object[_0x1decd7(0x1d4)](exports,_0x1decd7(0x1c0),{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require('../globalConfig/globalConfig.service'),common_1=require(_0x1decd7(0x1c8)),badwords_entity_1=require('./badwords.entity'),typeorm_1=require(_0x1decd7(0x1b3)),typeorm_2=require('@nestjs/typeorm'),axios_1=require(_0x1decd7(0x1b0)),violationLog_entity_1=require('./violationLog.entity'),user_entity_1=require(_0x1decd7(0x1f5)),utils_1=require(_0x1decd7(0x204));let BadwordsService=class BadwordsService{constructor(_0xa694c1,_0x333604,_0x496c28,_0x4f2bbc){const _0x5627f1=_0x1decd7;this[_0x5627f1(0x1a6)]=_0xa694c1,this[_0x5627f1(0x1f6)]=_0x333604,this[_0x5627f1(0x1fb)]=_0x496c28,this['globalConfigService']=_0x4f2bbc,this[_0x5627f1(0x1a0)]=[];}async[_0x1decd7(0x1ae)](){this['loadBadWords']();}async['customSensitiveWords'](_0x522a08,_0x12bdce){const _0x4bbb0f=_0x1decd7,_0x502c01=[];for(let _0x449171=0x0;_0x449171<this[_0x4bbb0f(0x1a0)][_0x4bbb0f(0x207)];_0x449171++){const _0x36041a=this[_0x4bbb0f(0x1a0)][_0x449171];_0x522a08['includes'](_0x36041a)&&_0x502c01['push'](_0x36041a);}if(_0x502c01['length']){await this[_0x4bbb0f(0x1ab)](_0x12bdce,_0x522a08,_0x502c01,[_0x4bbb0f(0x1d0)],_0x4bbb0f(0x1d2));const _0x3f0068=_0x4bbb0f(0x200);throw new common_1[(_0x4bbb0f(0x1c5))](_0x3f0068,common_1[_0x4bbb0f(0x1dd)][_0x4bbb0f(0x1cb)]);}}async[_0x1decd7(0x1d6)](_0x1e4b1d,_0x3847a1){const _0x2e80e3=_0x1decd7,_0x35f1b2=await this[_0x2e80e3(0x1a7)][_0x2e80e3(0x1d7)]();_0x35f1b2&&await this['checkBadWordsByConfig'](_0x1e4b1d,_0x35f1b2,_0x3847a1),await this[_0x2e80e3(0x209)](_0x1e4b1d,_0x3847a1);}async[_0x1decd7(0x1b5)](_0x51f93b,_0x3c134c,_0x4534a0){const _0x49fbf5=_0x1decd7,{useType:_0x42c657}=_0x3c134c;_0x42c657===_0x49fbf5(0x1d5)&&await this[_0x49fbf5(0x1b4)](_0x51f93b,_0x3c134c[_0x49fbf5(0x1e0)],_0x4534a0),_0x42c657===_0x49fbf5(0x1a5)&&await this[_0x49fbf5(0x1f2)](_0x51f93b,_0x3c134c,_0x4534a0);}[_0x1decd7(0x1b8)](_0x59a7ed){const _0x65e7c3=_0x1decd7,_0x2a6254=/存在(.*?)不合规/,_0xe1bdaa=_0x59a7ed[_0x65e7c3(0x1fd)](_0x2a6254);return _0xe1bdaa?_0xe1bdaa[0x1]:'';}async[_0x1decd7(0x1b4)](_0x5b884e,_0x1a0632,_0x5daae2){const _0x1cc898=_0x1decd7;if(!_0x1a0632)return;const _0x2512e6='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x1a0632+'}',_0x55c262={'Content-Type':_0x1cc898(0x1e8),'Accept':'application/json'},_0x1a84d0=await axios_1[_0x1cc898(0x1bf)][_0x1cc898(0x1a8)](_0x2512e6,{'text':_0x5b884e},{'headers':_0x55c262}),{conclusion:_0x21fa88,error_code:_0x2e0f8f,error_msg:_0x2c158a,conclusionType:_0x49b442,data:_0x36dce9}=_0x1a84d0[_0x1cc898(0x1f1)];_0x2e0f8f&&console['log'](_0x1cc898(0x1d9),_0x2c158a);if(_0x49b442!==0x1){const _0x2ea277=[...new Set(_0x36dce9['map'](_0xb46138=>this[_0x1cc898(0x1b8)](_0xb46138['msg'])))];await this[_0x1cc898(0x1ab)](_0x5daae2,_0x5b884e,[_0x1cc898(0x1e5)],_0x2ea277,_0x1cc898(0x205));const _0x7413d2=_0x1cc898(0x1de)+_0x2ea277[_0x1cc898(0x1c2)](',')+_0x1cc898(0x1e6);throw new common_1[(_0x1cc898(0x1c5))](_0x7413d2,common_1[_0x1cc898(0x1dd)][_0x1cc898(0x1cb)]);}}async['nineaiCheckBadWords'](_0x873404,_0x4fa9ee,_0x26f2e2){const _0x2ec55b=_0x1decd7;var _0x7e20ab;const {nineaiBuiltInSensitiveApiBase:_0x394d94,nineaiBuiltInSensitiveAuthKey:_0x56ad1c}=_0x4fa9ee;if(!_0x394d94||!_0x56ad1c)return;const _0x15528c=await axios_1['default'][_0x2ec55b(0x1a8)](_0x394d94,{'content':_0x873404},{'headers':{'Content-Type':_0x2ec55b(0x1c1),'Authorization':_0x56ad1c}});if(!_0x15528c['data'])return;if(_0x15528c[_0x2ec55b(0x1f1)]['code']!=='0'){const {msg:msg=_0x2ec55b(0x1a1)}=_0x15528c[_0x2ec55b(0x1f1)];throw new common_1['HttpException'](_0x2ec55b(0x1e2)+msg,common_1[_0x2ec55b(0x1dd)]['BAD_REQUEST']);}if(_0x15528c[_0x2ec55b(0x1f1)][_0x2ec55b(0x1e7)]&&((_0x7e20ab=_0x15528c['data']['word_list'])===null||_0x7e20ab===void 0x0?void 0x0:_0x7e20ab['length'])){const _0x445caa=[...new Set(_0x15528c['data'][_0x2ec55b(0x1e7)][_0x2ec55b(0x1b1)](_0x4b8db3=>_0x4b8db3[_0x2ec55b(0x1ce)]))],_0x57fdd8=[...new Set(_0x15528c[_0x2ec55b(0x1f1)][_0x2ec55b(0x1e7)]['map'](_0x2bd52a=>_0x2bd52a[_0x2ec55b(0x1cf)]))];await this[_0x2ec55b(0x1ab)](_0x26f2e2,_0x873404,_0x445caa,_0x57fdd8,'NineAi检测');const _0xf80ca5=this['formarTips'](_0x15528c[_0x2ec55b(0x1f1)][_0x2ec55b(0x1e7)]);throw new common_1[(_0x2ec55b(0x1c5))](_0xf80ca5,common_1[_0x2ec55b(0x1dd)][_0x2ec55b(0x1cb)]);}}[_0x1decd7(0x1f7)](_0x350c99){const _0x1f14c6=_0x1decd7,_0x5457a2=_0x350c99[_0x1f14c6(0x1b1)](_0x200d66=>_0x200d66[_0x1f14c6(0x1cf)]),_0x270c10=[...new Set(_0x5457a2)];return _0x1f14c6(0x1c3)+_0x270c10[_0x1f14c6(0x1c2)](',')+_0x1f14c6(0x206);}async[_0x1decd7(0x1e1)](){const _0x1fadc5=_0x1decd7,_0x105aeb=await this[_0x1fadc5(0x1a6)][_0x1fadc5(0x20a)]({'where':{'status':0x1},'select':[_0x1fadc5(0x1a9)]});this[_0x1fadc5(0x1a0)]=_0x105aeb[_0x1fadc5(0x1b1)](_0x13566c=>_0x13566c['word']);}async[_0x1decd7(0x201)](_0x43c86c){const _0x4c68de=_0x1decd7,{page:page=0x1,size:size=0x1f4,word:_0xc0bff9,status:_0x3ca821}=_0x43c86c,_0x39199b={};[0x0,0x1,'0','1']['includes'](_0x3ca821)&&(_0x39199b[_0x4c68de(0x1f3)]=_0x3ca821),_0xc0bff9&&(_0x39199b['word']=(0x0,typeorm_1['Like'])('%'+_0xc0bff9+'%'));const [_0x560f3e,_0x45627a]=await this[_0x4c68de(0x1a6)][_0x4c68de(0x20b)]({'where':_0x39199b,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4c68de(0x1ba)}});return{'rows':_0x560f3e,'count':_0x45627a};}async[_0x1decd7(0x1c6)](_0x4c2cd8){const _0x1716bb=_0x1decd7,_0x24dd81=await this[_0x1716bb(0x1a6)]['findOne']({'where':{'id':_0x4c2cd8['id']}});if(!_0x24dd81)throw new common_1[(_0x1716bb(0x1c5))](_0x1716bb(0x1ad),common_1[_0x1716bb(0x1dd)][_0x1716bb(0x1cb)]);const _0x2e6b19=await this['badWordsEntity'][_0x1716bb(0x1da)]({'id':_0x4c2cd8['id']});if(_0x2e6b19['affected']>0x0)return await this[_0x1716bb(0x1e1)](),_0x1716bb(0x1d1);else throw new common_1[(_0x1716bb(0x1c5))]('删除敏感词失败',common_1['HttpStatus'][_0x1716bb(0x1cb)]);}async[_0x1decd7(0x1f4)](_0x4369da){const _0x4682d5=_0x1decd7,{id:_0x3af58e,word:_0x390897,status:_0x6d7fc8}=_0x4369da,_0x2278f8=await this[_0x4682d5(0x1a6)]['findOne']({'where':{'word':_0x390897}});if(_0x2278f8)throw new common_1[(_0x4682d5(0x1c5))](_0x4682d5(0x20c),common_1[_0x4682d5(0x1dd)][_0x4682d5(0x1cb)]);const _0x4f3776=await this['badWordsEntity'][_0x4682d5(0x1c9)]({'id':_0x3af58e},{'word':_0x390897,'status':_0x6d7fc8});if(_0x4f3776[_0x4682d5(0x1d3)]>0x0)return await this[_0x4682d5(0x1e1)](),_0x4682d5(0x1ee);else throw new common_1[(_0x4682d5(0x1c5))](_0x4682d5(0x1ca),common_1[_0x4682d5(0x1dd)]['BAD_REQUEST']);}async[_0x1decd7(0x1b6)](_0x472c28){const _0xfa99c7=_0x1decd7,{word:_0x5601b6}=_0x472c28,_0x5b76d6=await this[_0xfa99c7(0x1a6)][_0xfa99c7(0x1ed)]({'where':{'word':_0x5601b6}});if(_0x5b76d6)throw new common_1[(_0xfa99c7(0x1c5))]('敏感词已存在,请检查您的提交信息',common_1[_0xfa99c7(0x1dd)][_0xfa99c7(0x1cb)]);return await this['badWordsEntity'][_0xfa99c7(0x1d8)]({'word':_0x5601b6}),await this['loadBadWords'](),'添加敏感词成功';}async['recordUserBadWords'](_0x49442b,_0x450707,_0x1087ac,_0x51ce61,_0x186c09){const _0x4fb190=_0x1decd7,_0x1ae9ac={'userId':_0x49442b,'content':_0x450707,'words':JSON[_0x4fb190(0x1a4)](_0x1087ac),'typeCn':JSON[_0x4fb190(0x1a4)](_0x51ce61),'typeOriginCn':_0x186c09};try{await this[_0x4fb190(0x1fb)][_0x4fb190(0x1df)]()[_0x4fb190(0x1c9)](user_entity_1[_0x4fb190(0x1ff)])[_0x4fb190(0x19f)]({'violationCount':()=>_0x4fb190(0x1c7)})[_0x4fb190(0x1ac)](_0x4fb190(0x1aa),{'userId':_0x49442b})['execute'](),await this[_0x4fb190(0x1f6)][_0x4fb190(0x1d8)](_0x1ae9ac);}catch(_0x13fb3a){console[_0x4fb190(0x1c4)](_0x4fb190(0x1e3),_0x13fb3a);}}async['violation'](_0x53d296,_0x2d4444){const _0x47558b=_0x1decd7,{role:_0x22ee6f}=_0x53d296[_0x47558b(0x1dc)],{page:page=0x1,size:size=0xa,userId:_0x14d70f,typeOriginCn:_0x286538}=_0x2d4444,_0x49cc64={};_0x14d70f&&(_0x49cc64[_0x47558b(0x1db)]=_0x14d70f),_0x286538&&(_0x49cc64[_0x47558b(0x210)]=_0x286538);const [_0x3d0f4a,_0x1e09be]=await this[_0x47558b(0x1f6)][_0x47558b(0x20b)]({'where':_0x49cc64,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x47558b(0x1cc)}}),_0x4efb1a=[...new Set(_0x3d0f4a[_0x47558b(0x1b1)](_0x237d5c=>_0x237d5c['userId']))],_0x46e29b=await this[_0x47558b(0x1fb)][_0x47558b(0x20a)]({'where':{'id':(0x0,typeorm_1['In'])(_0x4efb1a)},'select':['id','avatar','username',_0x47558b(0x1eb),_0x47558b(0x202),'status']});return _0x3d0f4a[_0x47558b(0x1a2)](_0x43ce4e=>{const _0x10c473=_0x47558b,_0x21de5a=_0x46e29b[_0x10c473(0x20a)](_0x190763=>_0x190763['id']===_0x43ce4e['userId']);_0x22ee6f!=='super'&&(_0x21de5a[_0x10c473(0x1eb)]=(0x0,utils_1[_0x10c473(0x20d)])(_0x21de5a[_0x10c473(0x1eb)])),_0x43ce4e[_0x10c473(0x211)]=_0x21de5a;}),{'rows':_0x3d0f4a,'count':_0x1e09be};}};function _0x54ff(){const _0x2fbd0e=['的信息、我们已对您账号进行标记、请合规使用！','length','Repository','customSensitiveWords','find','findAndCount','敏感词已经存在了、请勿重复添加','hideString','design:paramtypes','GlobalConfigService','typeOriginCn','userInfo','set','badWords','检测失败','forEach','BadwordsService','stringify','nineai','badWordsEntity','globalConfigService','post','word','id\x20=\x20:userId','recordUserBadWords','where','敏感词不存在,请检查您的提交信息','onModuleInit','InjectRepository','axios','map','decorate','typeorm','baiduCheckBadWords','checkBadWordsByConfig','addBadWord','137776AuBMeo','extractContent','__param','ASC','2359980htnrIN','function','__decorate','ViolationLogEntity','default','__esModule','application/json','join','您提交的内容中包含','log','HttpException','delBadWords','violationCount\x20+\x201','@nestjs/common','update','更新敏感词失败','BAD_REQUEST','DESC','1885695YzCvlW','keyword','category','自定义','删除敏感词成功','自定义检测','affected','defineProperty','baidu','checkBadWords','getSensitiveConfig','save','百度文本检测出现错误、请查看配置信息:\x20','delete','userId','user','HttpStatus','您提交的信息中包含','createQueryBuilder','baiduTextAccessToken','loadBadWords','敏感词检测\x20|\x20','error:\x20','object','***','的内容、我们已对您的账户进行标记、请合规使用！','word_list','application/x-www-form-urlencoded','10241GjIZSJ','2FLZyxX','email','2456vdHASI','findOne','更新敏感词成功','28OUZeIB','8757IbesUF','data','nineaiCheckBadWords','status','updateBadWords','../user/user.entity','violationLogEntity','formarTips','metadata','34047oOZjVE','getOwnPropertyDescriptor','userEntity','10920PPglkQ','match','BadWordsEntity','UserEntity','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','queryBadWords','violationCount','249725OjXUzw','../../common/utils','百度云检测'];_0x54ff=function(){return _0x2fbd0e;};return _0x54ff();}BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1[_0x1decd7(0x1fe)])),__param(0x1,(0x0,typeorm_2[_0x1decd7(0x1af)])(violationLog_entity_1[_0x1decd7(0x1be)])),__param(0x2,(0x0,typeorm_2[_0x1decd7(0x1af)])(user_entity_1[_0x1decd7(0x1ff)])),__metadata(_0x1decd7(0x20e),[typeorm_1[_0x1decd7(0x208)],typeorm_1[_0x1decd7(0x208)],typeorm_1[_0x1decd7(0x208)],globalConfig_service_1[_0x1decd7(0x20f)]])],BadwordsService),exports[_0x1decd7(0x1a3)]=BadwordsService;