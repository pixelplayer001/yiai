'use strict';const _0x41165d=_0x567d;(function(_0x21021d,_0x4b39dd){const _0x62bd63=_0x567d,_0x31db6d=_0x21021d();while(!![]){try{const _0x26d04d=parseInt(_0x62bd63(0x143))/0x1+parseInt(_0x62bd63(0x11d))/0x2*(-parseInt(_0x62bd63(0x156))/0x3)+-parseInt(_0x62bd63(0x153))/0x4+parseInt(_0x62bd63(0x177))/0x5+parseInt(_0x62bd63(0x164))/0x6*(parseInt(_0x62bd63(0x12a))/0x7)+parseInt(_0x62bd63(0x141))/0x8*(parseInt(_0x62bd63(0x15e))/0x9)+-parseInt(_0x62bd63(0x13d))/0xa*(-parseInt(_0x62bd63(0x122))/0xb);if(_0x26d04d===_0x4b39dd)break;else _0x31db6d['push'](_0x31db6d['shift']());}catch(_0x2c1285){_0x31db6d['push'](_0x31db6d['shift']());}}}(_0x146b,0xcc857));var __decorate=this&&this['__decorate']||function(_0x57cd75,_0x5e3def,_0x2207db,_0x48ad4f){const _0x147478=_0x567d;var _0x127a26=arguments[_0x147478(0x17f)],_0x462f0c=_0x127a26<0x3?_0x5e3def:_0x48ad4f===null?_0x48ad4f=Object[_0x147478(0x176)](_0x5e3def,_0x2207db):_0x48ad4f,_0x448614;if(typeof Reflect===_0x147478(0x15d)&&typeof Reflect[_0x147478(0x168)]===_0x147478(0x12b))_0x462f0c=Reflect[_0x147478(0x168)](_0x57cd75,_0x5e3def,_0x2207db,_0x48ad4f);else{for(var _0x4c7d54=_0x57cd75[_0x147478(0x17f)]-0x1;_0x4c7d54>=0x0;_0x4c7d54--)if(_0x448614=_0x57cd75[_0x4c7d54])_0x462f0c=(_0x127a26<0x3?_0x448614(_0x462f0c):_0x127a26>0x3?_0x448614(_0x5e3def,_0x2207db,_0x462f0c):_0x448614(_0x5e3def,_0x2207db))||_0x462f0c;}return _0x127a26>0x3&&_0x462f0c&&Object['defineProperty'](_0x5e3def,_0x2207db,_0x462f0c),_0x462f0c;},__metadata=this&&this[_0x41165d(0x167)]||function(_0x5415e2,_0xe23da9){const _0x252107=_0x41165d;if(typeof Reflect===_0x252107(0x15d)&&typeof Reflect[_0x252107(0x14a)]===_0x252107(0x12b))return Reflect['metadata'](_0x5415e2,_0xe23da9);},__param=this&&this[_0x41165d(0x154)]||function(_0x301808,_0x518c1b){return function(_0x109880,_0x500ec1){_0x518c1b(_0x109880,_0x500ec1,_0x301808);};};Object[_0x41165d(0x16a)](exports,'__esModule',{'value':!![]}),exports[_0x41165d(0x15b)]=void 0x0;const globalConfig_service_1=require(_0x41165d(0x115)),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x41165d(0x128)),typeorm_1=require(_0x41165d(0x13f)),typeorm_2=require(_0x41165d(0x131)),axios_1=require(_0x41165d(0x162)),violationLog_entity_1=require(_0x41165d(0x174)),user_entity_1=require(_0x41165d(0x136)),utils_1=require('../../common/utils');function _0x146b(){const _0x3c8f16=['680aHaLvV','match','842988xNZdEi','application/json','stringify','userEntity','violationCount','findOne','Repository','metadata','baiduCheckBadWords','join','violationCount\x20+\x201','avatar','where','email','checkBadWordsByConfig','extractContent','5210272UuiUCX','__param','loadBadWords','811542JeAVFk','userId','id\x20=\x20:userId','forEach','delBadWords','BadwordsService','添加敏感词成功','object','52839MAjJoZ','HttpStatus','InjectRepository','badWordsEntity','axios','敏感词已存在,请检查您的提交信息','12EMMgvI','includes','globalConfigService','__metadata','decorate','affected','defineProperty','onModuleInit','createQueryBuilder','word_list','Injectable','update','nineai','的内容、我们已对您的账户进行标记、请合规使用！','checkBadWords','您提交的内容中包含','./violationLog.entity','敏感词不存在,请检查您的提交信息','getOwnPropertyDescriptor','2911165rZrSxp','getSensitiveConfig','recordUserBadWords','GlobalConfigService','log','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','formarTips','badWords','length','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','map','status','post','BAD_REQUEST','username','category','save','自定义检测','敏感词检测\x20|\x20','更新敏感词成功','nineaiCheckBadWords','删除敏感词失败','UserEntity','../globalConfig/globalConfig.service','的信息、我们已对您账号进行标记、请合规使用！','word','msg','自定义','data','baidu','您提交的信息中包含','10kBrSym','queryBadWords','DESC','百度云检测','hideString','6193jRVDiO','set','find','userInfo','百度文本检测出现错误、请查看配置信息:\x20','violationLogEntity','./badwords.entity','敏感词已经存在了、请勿重复添加','4163957NdVoZC','function','typeOriginCn','updateBadWords','addBadWord','delete','customSensitiveWords','@nestjs/typeorm','删除敏感词成功','Like','keyword','push','../user/user.entity','findAndCount','default','BadWordsEntity','super','ViolationLogEntity','更新敏感词失败','6730MEXLsv','HttpException','typeorm','code'];_0x146b=function(){return _0x3c8f16;};return _0x146b();}function _0x567d(_0x472063,_0xdbeeea){const _0x146b14=_0x146b();return _0x567d=function(_0x567d11,_0x35332b){_0x567d11=_0x567d11-0x10a;let _0x21dc25=_0x146b14[_0x567d11];return _0x21dc25;},_0x567d(_0x472063,_0xdbeeea);}let BadwordsService=class BadwordsService{constructor(_0x1cb8c9,_0xb7f816,_0x2e8b13,_0x10912d){const _0x5e9fd9=_0x41165d;this[_0x5e9fd9(0x161)]=_0x1cb8c9,this[_0x5e9fd9(0x127)]=_0xb7f816,this[_0x5e9fd9(0x146)]=_0x2e8b13,this[_0x5e9fd9(0x166)]=_0x10912d,this[_0x5e9fd9(0x17e)]=[];}async[_0x41165d(0x16b)](){const _0x447d54=_0x41165d;this[_0x447d54(0x155)]();}async['customSensitiveWords'](_0x45f6dd,_0x440fa9){const _0x21c69c=_0x41165d,_0x3e49a0=[];for(let _0x360734=0x0;_0x360734<this[_0x21c69c(0x17e)][_0x21c69c(0x17f)];_0x360734++){const _0x3f2431=this['badWords'][_0x360734];_0x45f6dd['includes'](_0x3f2431)&&_0x3e49a0[_0x21c69c(0x135)](_0x3f2431);}if(_0x3e49a0[_0x21c69c(0x17f)]){await this[_0x21c69c(0x179)](_0x440fa9,_0x45f6dd,_0x3e49a0,[_0x21c69c(0x119)],_0x21c69c(0x10f));const _0x3bbe18=_0x21c69c(0x180);throw new common_1['HttpException'](_0x3bbe18,common_1[_0x21c69c(0x15f)][_0x21c69c(0x10b)]);}}async[_0x41165d(0x172)](_0x52145c,_0x4c156d){const _0x1e44ff=_0x41165d,_0xa37fc6=await this['globalConfigService'][_0x1e44ff(0x178)]();_0xa37fc6&&await this[_0x1e44ff(0x151)](_0x52145c,_0xa37fc6,_0x4c156d),await this[_0x1e44ff(0x130)](_0x52145c,_0x4c156d);}async['checkBadWordsByConfig'](_0x1e57b8,_0x378f60,_0x3f5321){const _0x43239b=_0x41165d,{useType:_0xc59a33}=_0x378f60;_0xc59a33===_0x43239b(0x11b)&&await this['baiduCheckBadWords'](_0x1e57b8,_0x378f60['baiduTextAccessToken'],_0x3f5321),_0xc59a33===_0x43239b(0x170)&&await this[_0x43239b(0x112)](_0x1e57b8,_0x378f60,_0x3f5321);}[_0x41165d(0x152)](_0x345167){const _0x3d3876=_0x41165d,_0x3c6dba=/存在(.*?)不合规/,_0x21460a=_0x345167[_0x3d3876(0x142)](_0x3c6dba);return _0x21460a?_0x21460a[0x1]:'';}async[_0x41165d(0x14b)](_0x529f61,_0x4b325a,_0x5902d3){const _0x444b2c=_0x41165d;if(!_0x4b325a)return;const _0x43fea6=_0x444b2c(0x17c)+_0x4b325a+'}',_0x32c8ec={'Content-Type':'application/x-www-form-urlencoded','Accept':'application/json'},_0x4ca44d=await axios_1['default'][_0x444b2c(0x10a)](_0x43fea6,{'text':_0x529f61},{'headers':_0x32c8ec}),{conclusion:_0x450591,error_code:_0x5009f5,error_msg:_0x5be723,conclusionType:_0x1b092d,data:_0x5434d3}=_0x4ca44d[_0x444b2c(0x11a)];_0x5009f5&&console['log'](_0x444b2c(0x126),_0x5be723);if(_0x1b092d!==0x1){const _0x2d9fbb=[...new Set(_0x5434d3['map'](_0x1a89dd=>this[_0x444b2c(0x152)](_0x1a89dd[_0x444b2c(0x118)])))];await this['recordUserBadWords'](_0x5902d3,_0x529f61,['***'],_0x2d9fbb,_0x444b2c(0x120));const _0x376ab7=_0x444b2c(0x11c)+_0x2d9fbb['join'](',')+_0x444b2c(0x171);throw new common_1[(_0x444b2c(0x13e))](_0x376ab7,common_1['HttpStatus'][_0x444b2c(0x10b)]);}}async[_0x41165d(0x112)](_0xa500ad,_0xb6f49a,_0x844d5b){const _0x4249bb=_0x41165d;var _0x196084;const {nineaiBuiltInSensitiveApiBase:_0x1b7ce9,nineaiBuiltInSensitiveAuthKey:_0x3bb80c}=_0xb6f49a;if(!_0x1b7ce9||!_0x3bb80c)return;const _0xbe8be=await axios_1[_0x4249bb(0x138)]['post'](_0x1b7ce9,{'content':_0xa500ad},{'headers':{'Content-Type':_0x4249bb(0x144),'Authorization':_0x3bb80c}});if(!_0xbe8be[_0x4249bb(0x11a)])return;if(_0xbe8be[_0x4249bb(0x11a)][_0x4249bb(0x140)]!=='0'){const {msg:msg='检测失败'}=_0xbe8be['data'];throw new common_1['HttpException'](_0x4249bb(0x110)+msg,common_1[_0x4249bb(0x15f)]['BAD_REQUEST']);}if(_0xbe8be[_0x4249bb(0x11a)][_0x4249bb(0x16d)]&&((_0x196084=_0xbe8be['data'][_0x4249bb(0x16d)])===null||_0x196084===void 0x0?void 0x0:_0x196084[_0x4249bb(0x17f)])){const _0x2fd204=[...new Set(_0xbe8be['data']['word_list'][_0x4249bb(0x181)](_0xf25589=>_0xf25589[_0x4249bb(0x134)]))],_0x5ccb68=[...new Set(_0xbe8be[_0x4249bb(0x11a)][_0x4249bb(0x16d)]['map'](_0x468f6a=>_0x468f6a[_0x4249bb(0x10d)]))];await this[_0x4249bb(0x179)](_0x844d5b,_0xa500ad,_0x2fd204,_0x5ccb68,'NineAi检测');const _0x468f77=this[_0x4249bb(0x17d)](_0xbe8be[_0x4249bb(0x11a)]['word_list']);throw new common_1[(_0x4249bb(0x13e))](_0x468f77,common_1['HttpStatus']['BAD_REQUEST']);}}[_0x41165d(0x17d)](_0x4444d4){const _0x2e56c1=_0x41165d,_0x4a5594=_0x4444d4[_0x2e56c1(0x181)](_0x3e246a=>_0x3e246a[_0x2e56c1(0x10d)]),_0x34bd1e=[...new Set(_0x4a5594)];return _0x2e56c1(0x173)+_0x34bd1e[_0x2e56c1(0x14c)](',')+_0x2e56c1(0x116);}async['loadBadWords'](){const _0x3be478=_0x41165d,_0x371fab=await this[_0x3be478(0x161)][_0x3be478(0x124)]({'where':{'status':0x1},'select':[_0x3be478(0x117)]});this[_0x3be478(0x17e)]=_0x371fab[_0x3be478(0x181)](_0x5459b5=>_0x5459b5['word']);}async[_0x41165d(0x11e)](_0x47b94a){const _0x1f38b0=_0x41165d,{page:page=0x1,size:size=0x1f4,word:_0x2e8c99,status:_0x5cc2da}=_0x47b94a,_0x15e0a2={};[0x0,0x1,'0','1'][_0x1f38b0(0x165)](_0x5cc2da)&&(_0x15e0a2[_0x1f38b0(0x182)]=_0x5cc2da),_0x2e8c99&&(_0x15e0a2[_0x1f38b0(0x117)]=(0x0,typeorm_1[_0x1f38b0(0x133)])('%'+_0x2e8c99+'%'));const [_0x466577,_0xa2918b]=await this['badWordsEntity'][_0x1f38b0(0x137)]({'where':_0x15e0a2,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x466577,'count':_0xa2918b};}async[_0x41165d(0x15a)](_0x51a8e8){const _0x25fc6d=_0x41165d,_0x5c7d69=await this[_0x25fc6d(0x161)][_0x25fc6d(0x148)]({'where':{'id':_0x51a8e8['id']}});if(!_0x5c7d69)throw new common_1[(_0x25fc6d(0x13e))](_0x25fc6d(0x175),common_1[_0x25fc6d(0x15f)][_0x25fc6d(0x10b)]);const _0x253309=await this[_0x25fc6d(0x161)][_0x25fc6d(0x12f)]({'id':_0x51a8e8['id']});if(_0x253309[_0x25fc6d(0x169)]>0x0)return await this['loadBadWords'](),_0x25fc6d(0x132);else throw new common_1[(_0x25fc6d(0x13e))](_0x25fc6d(0x113),common_1[_0x25fc6d(0x15f)][_0x25fc6d(0x10b)]);}async[_0x41165d(0x12d)](_0x2b55c7){const _0x3e8435=_0x41165d,{id:_0x525e1e,word:_0x25f283,status:_0x187cc8}=_0x2b55c7,_0x3bb1df=await this[_0x3e8435(0x161)]['findOne']({'where':{'word':_0x25f283}});if(_0x3bb1df)throw new common_1[(_0x3e8435(0x13e))](_0x3e8435(0x129),common_1[_0x3e8435(0x15f)]['BAD_REQUEST']);const _0x3f508d=await this[_0x3e8435(0x161)][_0x3e8435(0x16f)]({'id':_0x525e1e},{'word':_0x25f283,'status':_0x187cc8});if(_0x3f508d[_0x3e8435(0x169)]>0x0)return await this[_0x3e8435(0x155)](),_0x3e8435(0x111);else throw new common_1[(_0x3e8435(0x13e))](_0x3e8435(0x13c),common_1[_0x3e8435(0x15f)][_0x3e8435(0x10b)]);}async[_0x41165d(0x12e)](_0x122785){const _0x1628d8=_0x41165d,{word:_0x3860ac}=_0x122785,_0x471858=await this['badWordsEntity'][_0x1628d8(0x148)]({'where':{'word':_0x3860ac}});if(_0x471858)throw new common_1[(_0x1628d8(0x13e))](_0x1628d8(0x163),common_1[_0x1628d8(0x15f)][_0x1628d8(0x10b)]);return await this[_0x1628d8(0x161)][_0x1628d8(0x10e)]({'word':_0x3860ac}),await this[_0x1628d8(0x155)](),_0x1628d8(0x15c);}async['recordUserBadWords'](_0x12e44b,_0x2141af,_0x59dbda,_0x120042,_0x515a68){const _0x4f40e5=_0x41165d,_0x5ab6ba={'userId':_0x12e44b,'content':_0x2141af,'words':JSON[_0x4f40e5(0x145)](_0x59dbda),'typeCn':JSON['stringify'](_0x120042),'typeOriginCn':_0x515a68};try{await this[_0x4f40e5(0x146)][_0x4f40e5(0x16c)]()[_0x4f40e5(0x16f)](user_entity_1[_0x4f40e5(0x114)])[_0x4f40e5(0x123)]({'violationCount':()=>_0x4f40e5(0x14d)})[_0x4f40e5(0x14f)](_0x4f40e5(0x158),{'userId':_0x12e44b})['execute'](),await this[_0x4f40e5(0x127)][_0x4f40e5(0x10e)](_0x5ab6ba);}catch(_0x453ee3){console[_0x4f40e5(0x17b)]('error:\x20',_0x453ee3);}}async['violation'](_0x458f87,_0x4d75c1){const _0x1d17ce=_0x41165d,{role:_0x54594a}=_0x458f87['user'],{page:page=0x1,size:size=0xa,userId:_0x615d1b,typeOriginCn:_0x2fe51a}=_0x4d75c1,_0x53071f={};_0x615d1b&&(_0x53071f[_0x1d17ce(0x157)]=_0x615d1b),_0x2fe51a&&(_0x53071f[_0x1d17ce(0x12c)]=_0x2fe51a);const [_0x503115,_0x5b82bf]=await this[_0x1d17ce(0x127)][_0x1d17ce(0x137)]({'where':_0x53071f,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x1d17ce(0x11f)}}),_0x4386a0=[...new Set(_0x503115[_0x1d17ce(0x181)](_0x55a457=>_0x55a457['userId']))],_0xaf3b91=await this[_0x1d17ce(0x146)][_0x1d17ce(0x124)]({'where':{'id':(0x0,typeorm_1['In'])(_0x4386a0)},'select':['id',_0x1d17ce(0x14e),_0x1d17ce(0x10c),'email',_0x1d17ce(0x147),_0x1d17ce(0x182)]});return _0x503115[_0x1d17ce(0x159)](_0x219fa3=>{const _0x1ed8cf=_0x1d17ce,_0x183df3=_0xaf3b91[_0x1ed8cf(0x124)](_0x5c490c=>_0x5c490c['id']===_0x219fa3['userId']);_0x54594a!==_0x1ed8cf(0x13a)&&(_0x183df3[_0x1ed8cf(0x150)]=(0x0,utils_1[_0x1ed8cf(0x121)])(_0x183df3[_0x1ed8cf(0x150)])),_0x219fa3[_0x1ed8cf(0x125)]=_0x183df3;}),{'rows':_0x503115,'count':_0x5b82bf};}};BadwordsService=__decorate([(0x0,common_1[_0x41165d(0x16e)])(),__param(0x0,(0x0,typeorm_2[_0x41165d(0x160)])(badwords_entity_1[_0x41165d(0x139)])),__param(0x1,(0x0,typeorm_2[_0x41165d(0x160)])(violationLog_entity_1[_0x41165d(0x13b)])),__param(0x2,(0x0,typeorm_2[_0x41165d(0x160)])(user_entity_1[_0x41165d(0x114)])),__metadata('design:paramtypes',[typeorm_1[_0x41165d(0x149)],typeorm_1[_0x41165d(0x149)],typeorm_1[_0x41165d(0x149)],globalConfig_service_1[_0x41165d(0x17a)]])],BadwordsService),exports[_0x41165d(0x15b)]=BadwordsService;