'use strict';const _0x831e64=_0x168f;function _0x168f(_0x517088,_0x35b7ed){const _0x1f60f3=_0x1f60();return _0x168f=function(_0x168f5d,_0x50677a){_0x168f5d=_0x168f5d-0x7c;let _0x59a984=_0x1f60f3[_0x168f5d];return _0x59a984;},_0x168f(_0x517088,_0x35b7ed);}(function(_0x496182,_0x2fbb67){const _0x231d12=_0x168f,_0x397773=_0x496182();while(!![]){try{const _0x395e28=parseInt(_0x231d12(0xac))/0x1+-parseInt(_0x231d12(0xb0))/0x2+-parseInt(_0x231d12(0x8c))/0x3*(parseInt(_0x231d12(0x8d))/0x4)+parseInt(_0x231d12(0xa3))/0x5*(-parseInt(_0x231d12(0x89))/0x6)+-parseInt(_0x231d12(0x7f))/0x7*(-parseInt(_0x231d12(0xb2))/0x8)+-parseInt(_0x231d12(0x9a))/0x9*(parseInt(_0x231d12(0xae))/0xa)+parseInt(_0x231d12(0x9c))/0xb*(parseInt(_0x231d12(0x80))/0xc);if(_0x395e28===_0x2fbb67)break;else _0x397773['push'](_0x397773['shift']());}catch(_0xbb2fd5){_0x397773['push'](_0x397773['shift']());}}}(_0x1f60,0x35213));var __decorate=this&&this[_0x831e64(0x85)]||function(_0x3a2ddb,_0x3e8ac7,_0x5828b0,_0x2ee71c){const _0x34a781=_0x831e64;var _0x3d3480=arguments[_0x34a781(0x9f)],_0x5e42b4=_0x3d3480<0x3?_0x3e8ac7:_0x2ee71c===null?_0x2ee71c=Object[_0x34a781(0x82)](_0x3e8ac7,_0x5828b0):_0x2ee71c,_0x51ace7;if(typeof Reflect===_0x34a781(0x7e)&&typeof Reflect[_0x34a781(0x7c)]===_0x34a781(0xaa))_0x5e42b4=Reflect['decorate'](_0x3a2ddb,_0x3e8ac7,_0x5828b0,_0x2ee71c);else{for(var _0x167f5a=_0x3a2ddb[_0x34a781(0x9f)]-0x1;_0x167f5a>=0x0;_0x167f5a--)if(_0x51ace7=_0x3a2ddb[_0x167f5a])_0x5e42b4=(_0x3d3480<0x3?_0x51ace7(_0x5e42b4):_0x3d3480>0x3?_0x51ace7(_0x3e8ac7,_0x5828b0,_0x5e42b4):_0x51ace7(_0x3e8ac7,_0x5828b0))||_0x5e42b4;}return _0x3d3480>0x3&&_0x5e42b4&&Object[_0x34a781(0xab)](_0x3e8ac7,_0x5828b0,_0x5e42b4),_0x5e42b4;},__metadata=this&&this['__metadata']||function(_0x281b25,_0xeda693){const _0x82776=_0x831e64;if(typeof Reflect===_0x82776(0x7e)&&typeof Reflect['metadata']==='function')return Reflect[_0x82776(0x97)](_0x281b25,_0xeda693);},__param=this&&this[_0x831e64(0x94)]||function(_0x3579c7,_0x3814e6){return function(_0x47977b,_0x23446d){_0x3814e6(_0x47977b,_0x23446d,_0x3579c7);};};Object[_0x831e64(0xab)](exports,_0x831e64(0xa4),{'value':!![]}),exports[_0x831e64(0x95)]=void 0x0;const common_1=require('@nestjs/common'),bull_1=require(_0x831e64(0x9b)),utils_1=require(_0x831e64(0xb3)),midjourney_service_1=require('../midjourney/midjourney.service'),userBalance_service_1=require(_0x831e64(0xad)),globalConfig_service_1=require('../globalConfig/globalConfig.service');let QueueService=class QueueService{constructor(_0x30cfe9,_0x4b771d,_0x23f3da,_0x407baf){const _0xab9a3b=_0x831e64;this[_0xab9a3b(0xa2)]=_0x30cfe9,this[_0xab9a3b(0xa0)]=_0x4b771d,this[_0xab9a3b(0x99)]=_0x23f3da,this['globalConfigService']=_0x407baf,this['jobIds']=[];}async[_0x831e64(0x84)](){const _0x1ff0dc=_0x831e64;await this['mjDrawQueue'][_0x1ff0dc(0x8b)](0x0,_0x1ff0dc(0x96)),await this['midjourneyService'][_0x1ff0dc(0xa7)]();}async[_0x831e64(0x98)](_0x514dc1,_0x13f22e){const _0x403e0e=_0x831e64,{imgUrl:_0x1b17ab,orderId:_0x3c42af,action:_0x4eb184,drawId:_0xee9f8f}=_0x514dc1;await this[_0x403e0e(0xa0)][_0x403e0e(0xa8)](_0x13f22e),await this[_0x403e0e(0x99)][_0x403e0e(0x86)](_0x13f22e,_0x403e0e(0x9d),_0x4eb184===_0x403e0e(0x8e)?0x1:0x4);if(_0x4eb184==='IMAGINE'){const _0x4a8e78=''+(0x0,utils_1[_0x403e0e(0xa9)])(),_0x31e5af=Object[_0x403e0e(0xaf)](Object[_0x403e0e(0xaf)]({},_0x514dc1),{'userId':_0x13f22e[_0x403e0e(0x93)]['id'],'randomDrawId':_0x4a8e78}),_0x5cec57=await this[_0x403e0e(0xa0)][_0x403e0e(0x7d)](_0x31e5af),_0x76038=await this[_0x403e0e(0x91)][_0x403e0e(0xb1)]([_0x403e0e(0xa5)])||0x30d40,_0x1e71dc=await this[_0x403e0e(0xa2)]['add']('mjDraw',{'id':_0x5cec57['id'],'action':_0x4eb184,'userId':_0x13f22e[_0x403e0e(0x93)]['id']},{'delay':0x3e8,'timeout':+_0x76038});return this['jobIds'][_0x403e0e(0x92)](_0x1e71dc['id']),!![];}else{const {orderId:_0x5a4491,action:_0x410636,drawId:_0x3529f4}=_0x514dc1,_0x3ce9c2=await this['midjourneyService'][_0x403e0e(0x9e)](_0x410636,_0x3529f4,_0x5a4491),_0x525b59=Object['assign'](Object[_0x403e0e(0xaf)](Object['assign']({},_0x514dc1),{'userId':_0x13f22e[_0x403e0e(0x93)]['id']}),_0x3ce9c2),_0x11f4bf=await this[_0x403e0e(0xa0)][_0x403e0e(0x7d)](_0x525b59),_0x3f8ca3=await this[_0x403e0e(0x91)]['getConfigs']([_0x403e0e(0xa5)])||0x30d40,_0x39c414=await this[_0x403e0e(0xa2)][_0x403e0e(0xa6)](_0x403e0e(0x9d),{'id':_0x11f4bf['id'],'action':_0x410636,'userId':_0x13f22e[_0x403e0e(0x93)]['id']},{'delay':0x3e8,'timeout':+_0x3f8ca3});this['jobIds'][_0x403e0e(0x92)](_0x39c414['id']);return;}if(!_0xee9f8f||!_0x3c42af)throw new common_1['HttpException'](_0x403e0e(0xa1),common_1['HttpStatus'][_0x403e0e(0x88)]);}async[_0x831e64(0x81)](){const _0x39ef38=_0x831e64;return{'jobIds':this[_0x39ef38(0x8f)]};}};QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x831e64(0x83)])(_0x831e64(0x8a))),__metadata('design:paramtypes',[Object,midjourney_service_1[_0x831e64(0x90)],userBalance_service_1['UserBalanceService'],globalConfig_service_1[_0x831e64(0x87)]])],QueueService),exports[_0x831e64(0x95)]=QueueService;function _0x1f60(){const _0x6cf610=['1192695PNSioD','__esModule','mjTimeoutMs','add','cleanQueue','checkLimit','createRandomUid','function','defineProperty','185266AnGJai','../userBalance/userBalance.service','30XArCvp','assign','203652mGekFU','getConfigs','64BUdZGv','../../common/utils','decorate','addDrawQueue','object','110159WpvAkV','24nBgNKh','getQueue','getOwnPropertyDescriptor','InjectQueue','onApplicationBootstrap','__decorate','validateBalance','GlobalConfigService','BAD_REQUEST','6zlwYlv','MJDRAW','clean','168891PsEslZ','12rpRRkX','UPSCALE','jobIds','MidjourneyService','globalConfigService','push','user','__param','QueueService','active','metadata','addMjDrawQueue','userBalanceService','535203WtWNOn','@nestjs/bull','3267627vKYZKa','mjDraw','getDrawActionDetail','length','midjourneyService','缺少必要参数！','mjDrawQueue'];_0x1f60=function(){return _0x6cf610;};return _0x1f60();}