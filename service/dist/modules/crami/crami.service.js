'use strict';const _0x4abf3b=_0x375f;function _0x375f(_0x287452,_0x1e3832){const _0x58d85a=_0x58d8();return _0x375f=function(_0x375f31,_0x52d7be){_0x375f31=_0x375f31-0x13e;let _0xd5857b=_0x58d85a[_0x375f31];return _0xd5857b;},_0x375f(_0x287452,_0x1e3832);}(function(_0x4af75b,_0x3ddb8f){const _0x271c14=_0x375f,_0x3a240a=_0x4af75b();while(!![]){try{const _0x36c693=parseInt(_0x271c14(0x157))/0x1*(-parseInt(_0x271c14(0x13e))/0x2)+-parseInt(_0x271c14(0x14b))/0x3+-parseInt(_0x271c14(0x179))/0x4+parseInt(_0x271c14(0x140))/0x5*(parseInt(_0x271c14(0x192))/0x6)+-parseInt(_0x271c14(0x19a))/0x7+-parseInt(_0x271c14(0x173))/0x8*(-parseInt(_0x271c14(0x150))/0x9)+-parseInt(_0x271c14(0x195))/0xa*(-parseInt(_0x271c14(0x152))/0xb);if(_0x36c693===_0x3ddb8f)break;else _0x3a240a['push'](_0x3a240a['shift']());}catch(_0x45418c){_0x3a240a['push'](_0x3a240a['shift']());}}}(_0x58d8,0x380b2));var __decorate=this&&this[_0x4abf3b(0x189)]||function(_0x130aa0,_0x462c95,_0x1e646b,_0x36ae06){const _0x5cee5b=_0x4abf3b;var _0x37882a=arguments[_0x5cee5b(0x17c)],_0x10fa32=_0x37882a<0x3?_0x462c95:_0x36ae06===null?_0x36ae06=Object[_0x5cee5b(0x160)](_0x462c95,_0x1e646b):_0x36ae06,_0x5c634d;if(typeof Reflect==='object'&&typeof Reflect[_0x5cee5b(0x166)]===_0x5cee5b(0x141))_0x10fa32=Reflect[_0x5cee5b(0x166)](_0x130aa0,_0x462c95,_0x1e646b,_0x36ae06);else{for(var _0x3ad763=_0x130aa0[_0x5cee5b(0x17c)]-0x1;_0x3ad763>=0x0;_0x3ad763--)if(_0x5c634d=_0x130aa0[_0x3ad763])_0x10fa32=(_0x37882a<0x3?_0x5c634d(_0x10fa32):_0x37882a>0x3?_0x5c634d(_0x462c95,_0x1e646b,_0x10fa32):_0x5c634d(_0x462c95,_0x1e646b))||_0x10fa32;}return _0x37882a>0x3&&_0x10fa32&&Object[_0x5cee5b(0x16c)](_0x462c95,_0x1e646b,_0x10fa32),_0x10fa32;},__metadata=this&&this[_0x4abf3b(0x171)]||function(_0x4ac4f9,_0x574c91){const _0x3b1491=_0x4abf3b;if(typeof Reflect===_0x3b1491(0x17f)&&typeof Reflect[_0x3b1491(0x18c)]===_0x3b1491(0x141))return Reflect[_0x3b1491(0x18c)](_0x4ac4f9,_0x574c91);},__param=this&&this[_0x4abf3b(0x180)]||function(_0x51806c,_0x427962){return function(_0x2ca54b,_0x313a32){_0x427962(_0x2ca54b,_0x313a32,_0x51806c);};};Object['defineProperty'](exports,_0x4abf3b(0x154),{'value':!![]}),exports['CramiService']=void 0x0;const common_1=require(_0x4abf3b(0x194)),crami_entity_1=require('./crami.entity'),typeorm_1=require(_0x4abf3b(0x185)),typeorm_2=require(_0x4abf3b(0x165)),cramiPackage_entity_1=require(_0x4abf3b(0x142)),utils_1=require('../../common/utils'),user_entity_1=require(_0x4abf3b(0x145)),userBalance_service_1=require(_0x4abf3b(0x18f)),balance_constant_1=require('../../common/constants/balance.constant');let CramiService=class CramiService{constructor(_0x1177f5,_0x41fea2,_0x19c173,_0xf3f7b8){const _0x46e47e=_0x4abf3b;this[_0x46e47e(0x159)]=_0x1177f5,this[_0x46e47e(0x18a)]=_0x41fea2,this[_0x46e47e(0x190)]=_0x19c173,this[_0x46e47e(0x169)]=_0xf3f7b8;}async['queryOnePackage'](_0x14026c){const _0x21eb38=_0x4abf3b;return await this[_0x21eb38(0x18a)]['findOne']({'where':{'id':_0x14026c}});}async[_0x4abf3b(0x163)](_0x3ee058){const _0x56376d=_0x4abf3b;try{const {page:page=0x1,size:size=0xa,name:_0x579ed0,status:_0x16e47b,type:_0x1a6401}=_0x3ee058,_0x1ed3f9={};_0x579ed0&&Object['assign'](_0x1ed3f9,{'name':(0x0,typeorm_2[_0x56376d(0x18d)])('%'+_0x579ed0+'%')}),_0x16e47b&&Object[_0x56376d(0x16d)](_0x1ed3f9,{'status':_0x16e47b});_0x1a6401&&(_0x1a6401>0x0?Object[_0x56376d(0x16d)](_0x1ed3f9,{'days':(0x0,typeorm_2['MoreThan'])(0x0)}):Object[_0x56376d(0x16d)](_0x1ed3f9,{'days':(0x0,typeorm_2[_0x56376d(0x16b)])(0x0)}));const [_0x5b664d,_0xa699a5]=await this[_0x56376d(0x18a)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'where':_0x1ed3f9,'order':{'order':_0x56376d(0x187)}});return{'rows':_0x5b664d,'count':_0xa699a5};}catch(_0x5a4fe0){console[_0x56376d(0x191)](_0x56376d(0x15c),_0x5a4fe0);}}async[_0x4abf3b(0x18b)](_0x3d4743){const _0x4f6e25=_0x4abf3b,{name:_0x55c0c3,weight:_0x5431e6}=_0x3d4743,_0x2bd735=await this[_0x4f6e25(0x18a)][_0x4f6e25(0x15f)]({'where':[{'name':_0x55c0c3},{'weight':_0x5431e6}]});if(_0x2bd735)throw new common_1[(_0x4f6e25(0x17d))]('套餐名称或套餐等级重复、请检查！',common_1[_0x4f6e25(0x16e)][_0x4f6e25(0x146)]);try{return await this[_0x4f6e25(0x18a)][_0x4f6e25(0x14d)](_0x3d4743);}catch(_0x411a16){console['log'](_0x4f6e25(0x15c),_0x411a16);throw new common_1[(_0x4f6e25(0x17d))](_0x411a16,common_1[_0x4f6e25(0x16e)][_0x4f6e25(0x146)]);}}async[_0x4abf3b(0x176)](_0x59cb29){const _0x24e2bb=_0x4abf3b,{id:_0xa44f19,name:_0x4fe387,weight:_0x594299}=_0x59cb29,_0x4441ce=await this['cramiPackageEntity'][_0x24e2bb(0x15f)]({'where':{'id':_0xa44f19}});if(!_0x4441ce)throw new common_1[(_0x24e2bb(0x17d))]('当前套餐不存在、请检查你的输入参数！',common_1[_0x24e2bb(0x16e)][_0x24e2bb(0x146)]);const _0x9559b3=await this[_0x24e2bb(0x18a)][_0x24e2bb(0x175)]({'where':[{'name':_0x4fe387,'id':(0x0,typeorm_2[_0x24e2bb(0x170)])(_0xa44f19)},{'weight':_0x594299,'id':(0x0,typeorm_2[_0x24e2bb(0x170)])(_0xa44f19)}]});if(_0x9559b3)throw new common_1['HttpException'](_0x24e2bb(0x196),common_1['HttpStatus'][_0x24e2bb(0x146)]);const _0x5894a5=await this[_0x24e2bb(0x18a)][_0x24e2bb(0x167)]({'id':_0xa44f19},_0x59cb29);if(_0x5894a5[_0x24e2bb(0x148)]>0x0)return _0x24e2bb(0x186);else throw new common_1[(_0x24e2bb(0x17d))](_0x24e2bb(0x19b),common_1[_0x24e2bb(0x16e)][_0x24e2bb(0x146)]);}async[_0x4abf3b(0x14f)](_0x1cc327){const _0x12144d=_0x4abf3b,{id:_0x5f475a}=_0x1cc327,_0x1758b4=await this['cramiEntity'][_0x12144d(0x175)]({'where':{'packageId':_0x5f475a}});if(_0x1758b4)throw new common_1[(_0x12144d(0x17d))](_0x12144d(0x193),common_1[_0x12144d(0x16e)][_0x12144d(0x146)]);return await this['cramiPackageEntity']['delete']({'id':_0x5f475a});}async[_0x4abf3b(0x164)](_0x5d5fce){const _0x176175=_0x4abf3b,{packageId:_0x2b2cf7,count:count=0x1}=_0x5d5fce;if(_0x2b2cf7){const _0x3de039=await this['cramiPackageEntity'][_0x176175(0x15f)]({'where':{'id':_0x2b2cf7}});if(!_0x3de039)throw new common_1['HttpException'](_0x176175(0x172),common_1[_0x176175(0x16e)][_0x176175(0x146)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x3de039,_0x2ebf46={'packageId':_0x2b2cf7,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x176175(0x158)](_0x2ebf46,count);}if(!_0x2b2cf7){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x5d5fce;if([model3Count,model4Count,drawMjCount][_0x176175(0x153)](_0x56a28d=>!_0x56a28d))throw new common_1['HttpException'](_0x176175(0x199),common_1[_0x176175(0x16e)][_0x176175(0x146)]);const _0x12f045={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x176175(0x158)](_0x12f045,count);}}async['generateCrami'](_0x867574,_0x40b6eb){const _0x556a9b=_0x4abf3b,_0x287f88=[];for(let _0x5139bc=0x0;_0x5139bc<_0x40b6eb;_0x5139bc++){const _0x26c5fa=(0x0,utils_1[_0x556a9b(0x168)])(),_0x2c893b=this[_0x556a9b(0x159)]['create'](Object[_0x556a9b(0x16d)](Object[_0x556a9b(0x16d)]({},_0x867574),{'code':_0x26c5fa}));_0x287f88['push'](_0x2c893b);}return await this[_0x556a9b(0x159)][_0x556a9b(0x14d)](_0x287f88);}async[_0x4abf3b(0x17b)](_0x3ce5d7,_0x2db397){const _0x2df2c9=_0x4abf3b,{id:_0x7c989}=_0x3ce5d7[_0x2df2c9(0x161)],_0x537942=await this[_0x2df2c9(0x159)][_0x2df2c9(0x15f)]({'where':{'code':_0x2db397[_0x2df2c9(0x17a)]}});if(!_0x537942)throw new common_1['HttpException'](_0x2df2c9(0x197),common_1['HttpStatus'][_0x2df2c9(0x146)]);const {status:_0xb5f224,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x5d7aea}=_0x537942;if(_0xb5f224===0x1)throw new common_1[(_0x2df2c9(0x17d))](_0x2df2c9(0x183),common_1[_0x2df2c9(0x16e)][_0x2df2c9(0x146)]);const _0x2b1d12={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x5d7aea};return await this[_0x2df2c9(0x169)][_0x2df2c9(0x15d)](_0x7c989,Object['assign']({},_0x2b1d12),days),await this[_0x2df2c9(0x169)]['saveRecordRechargeLog']({'userId':_0x7c989,'rechargeType':balance_constant_1[_0x2df2c9(0x184)][_0x2df2c9(0x15a)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this['cramiEntity'][_0x2df2c9(0x167)]({'code':_0x2db397[_0x2df2c9(0x17a)]},{'useId':_0x7c989,'status':0x1}),_0x2df2c9(0x143);}async['queryAllCrami'](_0xd3ba44,_0x148c15){const _0xfc5407=_0x4abf3b,{page:page=0x1,size:size=0xa,status:_0x570e54,useId:_0x5348b7}=_0xd3ba44,_0x326f41={};_0x570e54&&Object[_0xfc5407(0x16d)](_0x326f41,{'status':_0x570e54}),_0x5348b7&&Object['assign'](_0x326f41,{'useId':_0x5348b7});const [_0x1b53ec,_0x5c192a]=await this[_0xfc5407(0x159)][_0xfc5407(0x13f)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':'DESC'},'where':_0x326f41}),_0x2cf3e6=_0x1b53ec[_0xfc5407(0x15b)](_0x2e58dc=>_0x2e58dc['useId']),_0x591585=_0x1b53ec[_0xfc5407(0x15b)](_0x856f9a=>_0x856f9a[_0xfc5407(0x162)]),_0x5d447d=await this[_0xfc5407(0x190)][_0xfc5407(0x177)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2cf3e6)}}),_0x34d86d=await this[_0xfc5407(0x18a)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x591585)}});return _0x1b53ec[_0xfc5407(0x15e)](_0xd22d9d=>{const _0x1fdabf=_0xfc5407;var _0x3b0471,_0x2ea18a,_0xf6f392;_0xd22d9d[_0x1fdabf(0x149)]=(_0x3b0471=_0x5d447d[_0x1fdabf(0x177)](_0x12cf8c=>_0x12cf8c['id']===_0xd22d9d['useId']))===null||_0x3b0471===void 0x0?void 0x0:_0x3b0471[_0x1fdabf(0x149)],_0xd22d9d[_0x1fdabf(0x19e)]=(_0x2ea18a=_0x5d447d[_0x1fdabf(0x177)](_0x4a2314=>_0x4a2314['id']===_0xd22d9d[_0x1fdabf(0x181)]))===null||_0x2ea18a===void 0x0?void 0x0:_0x2ea18a[_0x1fdabf(0x19e)],_0xd22d9d['packageName']=(_0xf6f392=_0x34d86d['find'](_0x822efc=>_0x822efc['id']===_0xd22d9d['packageId']))===null||_0xf6f392===void 0x0?void 0x0:_0xf6f392['name'];}),_0x148c15[_0xfc5407(0x161)][_0xfc5407(0x16a)]!==_0xfc5407(0x147)&&_0x1b53ec['forEach'](_0xaae04b=>_0xaae04b[_0xfc5407(0x19e)]=(0x0,utils_1[_0xfc5407(0x182)])(_0xaae04b['email'])),_0x148c15[_0xfc5407(0x161)][_0xfc5407(0x16a)]!==_0xfc5407(0x147)&&_0x1b53ec[_0xfc5407(0x15e)](_0x4c14f4=>_0x4c14f4[_0xfc5407(0x17a)]=(0x0,utils_1['maskCrami'])(_0x4c14f4['code'])),{'rows':_0x1b53ec,'count':_0x5c192a};}async[_0x4abf3b(0x174)](_0x1d8cf4){const _0x33e50d=_0x4abf3b,_0x222481=await this[_0x33e50d(0x159)][_0x33e50d(0x15f)]({'where':{'id':_0x1d8cf4}});if(!_0x222481)throw new common_1['HttpException'](_0x33e50d(0x198),common_1[_0x33e50d(0x16e)][_0x33e50d(0x146)]);if(_0x222481[_0x33e50d(0x18e)]===0x1)throw new common_1['HttpException'](_0x33e50d(0x178),common_1[_0x33e50d(0x16e)][_0x33e50d(0x146)]);return await this[_0x33e50d(0x159)][_0x33e50d(0x14c)]({'id':_0x1d8cf4});}async[_0x4abf3b(0x19c)](_0x48d438){const _0x21be6d=_0x4abf3b,{ids:_0x53b953}=_0x48d438,_0x5ec7b3=await this[_0x21be6d(0x159)][_0x21be6d(0x14c)](_0x53b953);if(_0x5ec7b3['affected']>0x0)return'删除卡密成功！';else throw new common_1['HttpException'](_0x21be6d(0x144),common_1[_0x21be6d(0x16e)][_0x21be6d(0x146)]);}};CramiService=__decorate([(0x0,common_1[_0x4abf3b(0x188)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(crami_entity_1[_0x4abf3b(0x17e)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1[_0x4abf3b(0x14a)])),__param(0x2,(0x0,typeorm_1[_0x4abf3b(0x19d)])(user_entity_1[_0x4abf3b(0x155)])),__metadata(_0x4abf3b(0x16f),[typeorm_2[_0x4abf3b(0x151)],typeorm_2['Repository'],typeorm_2[_0x4abf3b(0x151)],userBalance_service_1[_0x4abf3b(0x14e)]])],CramiService),exports[_0x4abf3b(0x156)]=CramiService;function _0x58d8(){const _0x5ae881=['920AuWrgC','delCrami','count','updatePackage','find','当前卡密已被使用、已使用的卡密禁止删除！','1712472DbOgqt','code','useCrami','length','HttpException','CramiEntity','object','__param','useId','maskEmail','当前卡密已被使用、请确认您输入的卡密是否正确！','RechargeType','@nestjs/typeorm','更新套餐成功！','DESC','Injectable','__decorate','cramiPackageEntity','createPackage','metadata','Like','status','../userBalance/userBalance.service','userEntity','log','4548nAPvqb','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','@nestjs/common','18250UMUwYE','套餐名称或套餐等级重复、请检查！','当前卡密不存在、请确认您输入的卡密是否正确！','当前卡密不存在、请确认您要删除的卡密是否存在！','自定义卡密必须至少一项余额不为0️零！','1283422FifQCM','更新套餐失败、请重试！','batchDelCrami','InjectRepository','email','6042PXGHfC','findAndCount','2330PKwiZn','function','./cramiPackage.entity','使用卡密成功','删除卡密失败、请重试！','../user/user.entity','BAD_REQUEST','super','affected','username','CramiPackageEntity','667101mLVdSq','delete','save','UserBalanceService','delPackage','16785MkzdGP','Repository','4499XYIadq','every','__esModule','UserEntity','CramiService','83qcKuNM','generateCrami','cramiEntity','PACKAGE_GIFT','map','error:\x20','addBalanceToUser','forEach','findOne','getOwnPropertyDescriptor','user','packageId','queryAllPackage','createCrami','typeorm','decorate','update','generateCramiCode','userBalanceService','role','LessThanOrEqual','defineProperty','assign','HttpStatus','design:paramtypes','Not','__metadata','当前套餐不存在、请确认您选择的套餐是否存在！'];_0x58d8=function(){return _0x5ae881;};return _0x58d8();}