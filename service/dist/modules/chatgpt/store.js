'use strict';const _0xbef14d=_0x3529;(function(_0x110e34,_0x526d9c){const _0x2988d4=_0x3529,_0x55c66b=_0x110e34();while(!![]){try{const _0x4ab3fd=parseInt(_0x2988d4(0x101))/0x1+parseInt(_0x2988d4(0x127))/0x2+-parseInt(_0x2988d4(0x109))/0x3+-parseInt(_0x2988d4(0x125))/0x4*(-parseInt(_0x2988d4(0x10f))/0x5)+-parseInt(_0x2988d4(0x11f))/0x6+parseInt(_0x2988d4(0x129))/0x7*(parseInt(_0x2988d4(0x11a))/0x8)+parseInt(_0x2988d4(0x122))/0x9;if(_0x4ab3fd===_0x526d9c)break;else _0x55c66b['push'](_0x55c66b['shift']());}catch(_0x5e298d){_0x55c66b['push'](_0x55c66b['shift']());}}}(_0x1a1e,0xdfc08));function _0x3529(_0x506d5d,_0x92ca45){const _0x1a1ebe=_0x1a1e();return _0x3529=function(_0x3529f1,_0x35994c){_0x3529f1=_0x3529f1-0xf8;let _0xaa7d1e=_0x1a1ebe[_0x3529f1];return _0xaa7d1e;},_0x3529(_0x506d5d,_0x92ca45);}Object[_0xbef14d(0x12e)](exports,'__esModule',{'value':!![]}),exports['NineStore']=void 0x0;const uuid_1=require(_0xbef14d(0x10c)),tiktoken_1=require('@dqbd/tiktoken'),tokenizer=(0x0,tiktoken_1[_0xbef14d(0x112)])(_0xbef14d(0xff));function _0x1a1e(){const _0x376716=['872893ZurEOz','chat','reduce','_recursivePruning','buildMessageFromParentMessageId','defineProperty','filter','claude-3-5-sonnet-20240620','gpt-4o','get','parentMessageId','image_url','NineStore','includes','type','cl100k_base','formatOptions','1582696CJWrop','getData','text','map','push','some','user','getUuid','3127884lHXFhj','本次携带上下文的长度','expires','uuid','isArray','log','3965lqPyxt','ERNIE','max','get_encoding','gpt-4-vision-preview','system','assistant','concat','gpt-4-all','length','join','16sMDJTU','slice','namespace','splice','replace','8228946qhrkDX','_getTokenCount','min','8234865nHrYsO','store','setData','1244HXIigW','hunyuan','673810hPuBQq','content'];_0x1a1e=function(){return _0x376716;};return _0x1a1e();}class NineStore{constructor(_0x18c0d9){const _0x28f728=_0xbef14d,{store:_0x1aa64d,namespace:_0x40a10d,expires:_0x26f473}=this[_0x28f728(0x100)](_0x18c0d9);this[_0x28f728(0x123)]=_0x1aa64d,this[_0x28f728(0x11c)]=_0x40a10d,this[_0x28f728(0x10b)]=_0x26f473;}[_0xbef14d(0x100)](_0x4fb159){const _0x1e17e8=_0xbef14d,{store:_0x55d7be,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x1e17e8(0x12a)}=_0x4fb159;return{'store':_0x55d7be,'namespace':namespace,'expires':expires};}['generateKey'](_0x34a234){const _0x3cb3d8=_0xbef14d;return this[_0x3cb3d8(0x11c)]?this[_0x3cb3d8(0x11c)]+'-'+_0x34a234:_0x34a234;}async[_0xbef14d(0x102)](_0xb5152c){const _0x1e4760=_0xbef14d,_0x3a179a=await this[_0x1e4760(0x123)][_0x1e4760(0xf9)](_0xb5152c);return _0x3a179a;}async[_0xbef14d(0x124)](_0x38fe11,_0x3315b4=this[_0xbef14d(0x10b)]){await this['store']['set'](_0x38fe11['id'],_0x38fe11,_0x3315b4);}async[_0xbef14d(0x12d)](_0x34fbfa,_0x568d4f){const _0x2b6117=_0xbef14d;let {maxRounds:_0x550720,maxModelToken:_0x269d7b,maxResponseTokens:_0x3fa2cb,systemMessage:systemMessage='',name:_0x53d9f7,imageUrl:_0x2a81e4,model:_0x13bedf,activeModel:_0x5b7bf7}=_0x568d4f,{parentMessageId:_0x28decc}=_0x568d4f,_0x3cc192=[],_0x2f7efb=0x0;if(systemMessage){const _0x378847=['gemini-pro',_0x2b6117(0x110),_0x2b6117(0x126)],_0x2e3a14=_0x5b7bf7&&_0x378847[_0x2b6117(0x106)](_0x34baf3=>_0x5b7bf7['includes'](_0x34baf3));_0x2e3a14?(_0x3cc192[_0x2b6117(0x105)]({'role':_0x2b6117(0x107),'content':systemMessage,'name':_0x53d9f7}),_0x3cc192[_0x2b6117(0x105)]({'role':_0x2b6117(0x115),'content':'好的','name':_0x53d9f7})):_0x3cc192[_0x2b6117(0x105)]({'role':_0x2b6117(0x114),'content':systemMessage,'name':_0x53d9f7});}const _0x54f193=_0x3cc192['length'];let _0x12e083=0x0;const _0x470b96=[_0x2b6117(0x113),_0x2b6117(0xf8),_0x2b6117(0x130)];if(_0x470b96[_0x2b6117(0xfd)](_0x5b7bf7)&&_0x2a81e4){const _0xd51952=[{'type':_0x2b6117(0x103),'text':_0x34fbfa},{'type':_0x2b6117(0xfb),'image_url':{'url':_0x2a81e4}}];_0x3cc192[_0x2b6117(0x105)]({'role':_0x2b6117(0x107),'content':_0xd51952,'name':_0x53d9f7});}else{if(_0x470b96[_0x2b6117(0xfd)](_0x5b7bf7)&&!_0x2a81e4){const _0x387af4=[{'type':_0x2b6117(0x103),'text':_0x34fbfa}];_0x3cc192[_0x2b6117(0x105)]({'role':'user','content':_0x387af4,'name':_0x53d9f7});}else(_0x13bedf===_0x2b6117(0x117)||_0x13bedf==='gpt-4o-all')&&_0x2a81e4&&(_0x34fbfa=_0x2a81e4+'\x0a'+_0x34fbfa),_0x3cc192[_0x2b6117(0x105)]({'role':'user','content':_0x34fbfa,'name':_0x53d9f7});}let _0x2928f0=_0x3cc192;do{if(!_0x28decc)break;const _0x51b954=await this[_0x2b6117(0x102)](_0x28decc);if(!_0x51b954)break;const {text:_0x226ef3,name:_0xcd284c,role:_0x346787,imageUrl:_0x5f2f5c}=_0x51b954;let _0x4a54b7=_0x226ef3;if(_0x5f2f5c)_0x470b96['includes'](_0x5b7bf7)&&(_0x346787===_0x2b6117(0x115)?_0x4a54b7=[{'type':_0x2b6117(0x103),'text':_0x226ef3}]:_0x4a54b7=[{'type':_0x2b6117(0x103),'text':_0x226ef3},{'type':_0x2b6117(0xfb),'image_url':{'url':_0x5f2f5c}}]);else!_0x5f2f5c&&_0x470b96[_0x2b6117(0xfd)](_0x5b7bf7)&&(_0x4a54b7=[{'type':'text','text':_0x226ef3}]);_0x2928f0=_0x2928f0['slice'](0x0,_0x54f193)[_0x2b6117(0x116)]([{'role':_0x346787,'content':_0x4a54b7,'name':_0xcd284c},..._0x2928f0[_0x2b6117(0x11b)](_0x54f193)]),_0x12e083++;if(_0x550720&&_0x12e083>=_0x550720)break;if(_0x269d7b&&_0x3fa2cb){const _0x3aeaa5=_0x269d7b-_0x3fa2cb;_0x2f7efb=await this[_0x2b6117(0x120)](_0x2928f0);const _0x5c2303=_0x2f7efb+0xc8<=_0x3aeaa5;!_0x5c2303&&(_0x2928f0=this[_0x2b6117(0x12c)](_0x2928f0,_0x3aeaa5,systemMessage));}_0x28decc=_0x51b954[_0x2b6117(0xfa)];}while(!![]);const _0x3991e8=Math[_0x2b6117(0x111)](0x1,Math[_0x2b6117(0x121)](_0x269d7b-_0x2f7efb,_0x3fa2cb));return console[_0x2b6117(0x10e)](_0x2b6117(0x10a),_0x2928f0[_0x2b6117(0x118)],_0x2f7efb),{'context':_0x2928f0,'round':_0x2928f0[_0x2b6117(0x118)],'historyToken':_0x2f7efb};}[_0xbef14d(0x120)](_0x57f962){const _0x27cc04=_0xbef14d;let _0x3d92fd=_0x57f962[_0x27cc04(0x12b)]((_0x23f2ca,_0x4d2470)=>{const _0x274bde=_0x27cc04;if(Array[_0x274bde(0x10d)](_0x4d2470[_0x274bde(0x128)])){const _0x3ac2ab=_0x4d2470['content'][_0x274bde(0x12f)](_0x423561=>_0x423561[_0x274bde(0xfe)]===_0x274bde(0x103))[_0x274bde(0x104)](_0x29a5a8=>_0x29a5a8['text'])[_0x274bde(0x119)]('\x20');return _0x23f2ca+_0x3ac2ab;}else return _0x23f2ca+(_0x4d2470[_0x274bde(0x128)]||'');},'');return _0x3d92fd=_0x3d92fd[_0x27cc04(0x11e)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x3d92fd)[_0x27cc04(0x118)];}[_0xbef14d(0x12c)](_0x1f9c6d,_0x1f9f3a,_0x502ae5){const _0x24a08e=_0xbef14d,_0x2d5f69=this[_0x24a08e(0x120)](_0x1f9c6d);if(_0x2d5f69<=_0x1f9f3a)return _0x1f9c6d;return _0x1f9c6d[_0x24a08e(0x11d)](_0x502ae5?0x1:0x0,0x1),this[_0x24a08e(0x12c)](_0x1f9c6d,_0x1f9f3a,_0x502ae5);}[_0xbef14d(0x108)](){return(0x0,uuid_1['v4'])();}}exports[_0xbef14d(0xfc)]=NineStore;