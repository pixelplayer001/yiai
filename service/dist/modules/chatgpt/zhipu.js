'use strict';const _0x47a14a=_0x3b7c;function _0x3b7c(_0x293b81,_0x2ea86c){const _0x54e7f9=_0x54e7();return _0x3b7c=function(_0x3b7ce0,_0x1644e4){_0x3b7ce0=_0x3b7ce0-0xbe;let _0x1240c8=_0x54e7f9[_0x3b7ce0];return _0x1240c8;},_0x3b7c(_0x293b81,_0x2ea86c);}function _0x54e7(){const _0x3cc0f1=['8ffbAjN','https://open.bigmodel.cn/api/paas/v3/model-api/','usage','event:','POST','HS256','split','now','end','/sse-invoke','sendMessageFromZhipu','1030XoBIhF','60394GeWnOB','round','sign','2465905nQsXGM','length','compilerMetaJsonStr','250puxSql','12xnhigA','SIGN','toString','stream','__esModule','filter','411116uSTSpb','11bWjwsF','log','axios','4862851YhGvXZ','compilerStream','1673177rNNSdl','18OnpIzQ','jsonwebtoken','defineProperty','application/json','data','is_end','trim','id:','data:','105582zeQHXm','replace','19179FxxpAe','error','generateToken','meta:','then'];_0x54e7=function(){return _0x3cc0f1;};return _0x54e7();}(function(_0x3852c6,_0x1ddd9e){const _0x49df9b=_0x3b7c,_0x15e2e9=_0x3852c6();while(!![]){try{const _0x58521f=-parseInt(_0x49df9b(0xd3))/0x1*(-parseInt(_0x49df9b(0xc5))/0x2)+parseInt(_0x49df9b(0xd9))/0x3*(-parseInt(_0x49df9b(0xd2))/0x4)+parseInt(_0x49df9b(0xcb))/0x5*(parseInt(_0x49df9b(0xe2))/0x6)+-parseInt(_0x49df9b(0xd6))/0x7*(parseInt(_0x49df9b(0xe9))/0x8)+parseInt(_0x49df9b(0xe4))/0x9*(parseInt(_0x49df9b(0xc4))/0xa)+parseInt(_0x49df9b(0xd8))/0xb*(parseInt(_0x49df9b(0xcc))/0xc)+parseInt(_0x49df9b(0xc8))/0xd;if(_0x58521f===_0x1ddd9e)break;else _0x15e2e9['push'](_0x15e2e9['shift']());}catch(_0x4fd747){_0x15e2e9['push'](_0x15e2e9['shift']());}}}(_0x54e7,0x70c6f));Object[_0x47a14a(0xdb)](exports,_0x47a14a(0xd0),{'value':!![]}),exports[_0x47a14a(0xc3)]=exports[_0x47a14a(0xd7)]=exports['compilerMetaJsonStr']=exports[_0x47a14a(0xe6)]=void 0x0;const axios=require(_0x47a14a(0xd5)),jwt=require(_0x47a14a(0xda));function generateToken(_0x5cf526,_0xa331e7=0x3e8*0x3c*0x3c*0x18*0x168){const _0x32d6c3=_0x47a14a,[_0x1b20a6,_0x5b5f04]=_0x5cf526[_0x32d6c3(0xbf)]('.'),_0x14c83d={'api_key':_0x1b20a6,'exp':Math[_0x32d6c3(0xc6)](Date['now']())+_0xa331e7*0x3e8,'timestamp':Math['round'](Date[_0x32d6c3(0xc0)]())};return jwt[_0x32d6c3(0xc7)](_0x14c83d,_0x5b5f04,{'algorithm':_0x32d6c3(0xbe),'header':{'alg':_0x32d6c3(0xbe),'sign_type':_0x32d6c3(0xcd)}});}exports[_0x47a14a(0xe6)]=generateToken;function compilerMetaJsonStr(_0x25d20a){const _0x549ad5=_0x47a14a;let _0x5800e3={};try{_0x5800e3=JSON['parse'](_0x25d20a);}catch(_0x52a831){_0x5800e3={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x549ad5(0xe5)]('json\x20parse\x20error\x20from\x20zhipu!',_0x25d20a);}return _0x5800e3;}exports[_0x47a14a(0xca)]=compilerMetaJsonStr;function compilerStream(_0x35cfe1){const _0x538f83=_0x47a14a;var _0x3e4c7f;if(_0x35cfe1[_0x538f83(0xc9)]===0x3)return{'event':_0x35cfe1[0x0][_0x538f83(0xe3)](_0x538f83(0xec),''),'id':_0x35cfe1[0x1][_0x538f83(0xe3)](_0x538f83(0xe0),''),'is_end':![],'result':_0x35cfe1[0x2][_0x538f83(0xe3)](_0x538f83(0xe1),'')[_0x538f83(0xdf)]()};if(_0x35cfe1[_0x538f83(0xc9)]===0x4)return{'event':_0x35cfe1[0x0]['replace'](_0x538f83(0xec),''),'id':_0x35cfe1[0x1]['replace'](_0x538f83(0xe0),''),'result':_0x35cfe1[0x2][_0x538f83(0xe3)](_0x538f83(0xe1),'')[_0x538f83(0xdf)](),'is_end':!![],'usage':(_0x3e4c7f=compilerMetaJsonStr(_0x35cfe1[0x3][_0x538f83(0xe3)](_0x538f83(0xe7),'')))===null||_0x3e4c7f===void 0x0?void 0x0:_0x3e4c7f[_0x538f83(0xeb)]};}exports[_0x47a14a(0xd7)]=compilerStream;async function sendMessageFromZhipu(_0x2cd3f8,{onProgress:_0x121c97,key:_0x5b497a,model:_0x55c7ce,temperature:temperature=0.95}){const _0x2cc9b5=await generateToken(_0x5b497a);return new Promise((_0x2836df,_0x5674b7)=>{const _0x4ebf0f=_0x3b7c,_0x33cc32=_0x4ebf0f(0xea)+_0x55c7ce+_0x4ebf0f(0xc2),_0x282b8d={'method':_0x4ebf0f(0xed),'url':_0x33cc32,'responseType':_0x4ebf0f(0xcf),'headers':{'Content-Type':_0x4ebf0f(0xdc),'Authorization':_0x2cc9b5},'data':{'prompt':_0x2cd3f8,'temperature':temperature}};axios(_0x282b8d)[_0x4ebf0f(0xe8)](_0x30f827=>{const _0x4ae7bd=_0x4ebf0f,_0x22ebee=_0x30f827[_0x4ae7bd(0xdd)];let _0xbd7c54,_0x1b9d16='';_0x22ebee['on']('data',_0xa76b41=>{const _0x4a195d=_0x4ae7bd,_0x3dea70=_0xa76b41[_0x4a195d(0xce)]()[_0x4a195d(0xbf)]('\x0a')[_0x4a195d(0xd1)](_0x54cb0e=>_0x54cb0e['trim']()!==''),_0x4aa521=compilerStream(_0x3dea70);if(!_0x4aa521)return;const {id:_0x4b7f0d,result:_0x378e92,is_end:_0x823c75}=_0x4aa521;_0x378e92&&(_0x1b9d16+=_0x378e92[_0x4a195d(0xdf)]()),_0x823c75&&(_0x4aa521[_0x4a195d(0xde)]=![],_0xbd7c54=_0x4aa521,_0xbd7c54['text']=_0x1b9d16),_0x121c97(_0x4aa521);}),_0x22ebee['on'](_0x4ae7bd(0xc1),()=>{_0x2836df(_0xbd7c54),_0x1b9d16='';});})['catch'](_0x54960e=>{const _0x2092a7=_0x4ebf0f;console[_0x2092a7(0xd4)]('error:\x20',_0x54960e);});});}exports[_0x47a14a(0xc3)]=sendMessageFromZhipu;