'use strict';const _0x6352cc=_0x2c92;(function(_0x11bff9,_0x4fc7e0){const _0x161196=_0x2c92,_0x1f3a62=_0x11bff9();while(!![]){try{const _0x5832c5=parseInt(_0x161196(0x1c8))/0x1*(-parseInt(_0x161196(0x1b9))/0x2)+parseInt(_0x161196(0x1ba))/0x3*(parseInt(_0x161196(0x1ab))/0x4)+-parseInt(_0x161196(0x1a9))/0x5+-parseInt(_0x161196(0x1b8))/0x6+-parseInt(_0x161196(0x1c7))/0x7+-parseInt(_0x161196(0x1cb))/0x8*(-parseInt(_0x161196(0x1ce))/0x9)+parseInt(_0x161196(0x1c6))/0xa;if(_0x5832c5===_0x4fc7e0)break;else _0x1f3a62['push'](_0x1f3a62['shift']());}catch(_0x49b93c){_0x1f3a62['push'](_0x1f3a62['shift']());}}}(_0x3ea1,0x7ab9e));function _0x3ea1(){const _0x1b2962=['sendMessageFromZhipu','jsonwebtoken','78615HOyPaW','data','error','filter','compilerMetaJsonStr','replace','748220DOyatn','generateToken','12IwMHMo','compilerStream','SIGN','end','HS256','json\x20parse\x20error\x20from\x20zhipu!','axios','stream','https://open.bigmodel.cn/api/paas/v3/model-api/','log','data:','trim','text','1647228GPskdf','1767614XindIE','89442cNDdIS','meta:','application/json','id:','round','then','event:','__esModule','parse','defineProperty','now','length','16750040fUDrId','1571892uUkaOr','1XMJbOD','usage','split','248TfBtaU'];_0x3ea1=function(){return _0x1b2962;};return _0x3ea1();}Object[_0x6352cc(0x1c3)](exports,_0x6352cc(0x1c1),{'value':!![]}),exports[_0x6352cc(0x1cc)]=exports[_0x6352cc(0x1ac)]=exports[_0x6352cc(0x1a7)]=exports[_0x6352cc(0x1aa)]=void 0x0;const axios=require(_0x6352cc(0x1b1)),jwt=require(_0x6352cc(0x1cd));function generateToken(_0x2de4ca,_0x32142d=0x3e8*0x3c*0x3c*0x18*0x168){const _0x20b519=_0x6352cc,[_0x509acd,_0x4dcbb0]=_0x2de4ca[_0x20b519(0x1ca)]('.'),_0x3b8be5={'api_key':_0x509acd,'exp':Math['round'](Date[_0x20b519(0x1c4)]())+_0x32142d*0x3e8,'timestamp':Math[_0x20b519(0x1be)](Date['now']())};return jwt['sign'](_0x3b8be5,_0x4dcbb0,{'algorithm':_0x20b519(0x1af),'header':{'alg':_0x20b519(0x1af),'sign_type':_0x20b519(0x1ad)}});}exports[_0x6352cc(0x1aa)]=generateToken;function compilerMetaJsonStr(_0x19c989){const _0x5de0f2=_0x6352cc;let _0x1486c6={};try{_0x1486c6=JSON[_0x5de0f2(0x1c2)](_0x19c989);}catch(_0x58ca2f){_0x1486c6={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x5de0f2(0x1a5)](_0x5de0f2(0x1b0),_0x19c989);}return _0x1486c6;}exports[_0x6352cc(0x1a7)]=compilerMetaJsonStr;function compilerStream(_0x42122e){const _0x60a9d9=_0x6352cc;var _0x5d8f2f;if(_0x42122e[_0x60a9d9(0x1c5)]===0x3)return{'event':_0x42122e[0x0][_0x60a9d9(0x1a8)]('event:',''),'id':_0x42122e[0x1][_0x60a9d9(0x1a8)](_0x60a9d9(0x1bd),''),'is_end':![],'result':_0x42122e[0x2][_0x60a9d9(0x1a8)](_0x60a9d9(0x1b5),'')[_0x60a9d9(0x1b6)]()};if(_0x42122e[_0x60a9d9(0x1c5)]===0x4)return{'event':_0x42122e[0x0]['replace'](_0x60a9d9(0x1c0),''),'id':_0x42122e[0x1][_0x60a9d9(0x1a8)](_0x60a9d9(0x1bd),''),'result':_0x42122e[0x2]['replace'](_0x60a9d9(0x1b5),'')[_0x60a9d9(0x1b6)](),'is_end':!![],'usage':(_0x5d8f2f=compilerMetaJsonStr(_0x42122e[0x3]['replace'](_0x60a9d9(0x1bb),'')))===null||_0x5d8f2f===void 0x0?void 0x0:_0x5d8f2f[_0x60a9d9(0x1c9)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0x1598e2,{onProgress:_0x3c51d3,key:_0x221224,model:_0x3545ff,temperature:temperature=0.95}){const _0x357bef=await generateToken(_0x221224);return new Promise((_0x5785e2,_0x30c7b9)=>{const _0x11c436=_0x2c92,_0xd66dbe=_0x11c436(0x1b3)+_0x3545ff+'/sse-invoke',_0x357d82={'method':'POST','url':_0xd66dbe,'responseType':_0x11c436(0x1b2),'headers':{'Content-Type':_0x11c436(0x1bc),'Authorization':_0x357bef},'data':{'prompt':_0x1598e2,'temperature':temperature}};axios(_0x357d82)[_0x11c436(0x1bf)](_0xba9e7f=>{const _0x4ca2ef=_0x11c436,_0x34bfbe=_0xba9e7f[_0x4ca2ef(0x1cf)];let _0x1f834f,_0x113427='';_0x34bfbe['on'](_0x4ca2ef(0x1cf),_0x53f35a=>{const _0x42b8cd=_0x4ca2ef,_0x49a521=_0x53f35a['toString']()[_0x42b8cd(0x1ca)]('\x0a')[_0x42b8cd(0x1a6)](_0xb38953=>_0xb38953[_0x42b8cd(0x1b6)]()!==''),_0xfd9d6a=compilerStream(_0x49a521);if(!_0xfd9d6a)return;const {id:_0x434c1e,result:_0xc107cf,is_end:_0x3ca9bb}=_0xfd9d6a;_0xc107cf&&(_0x113427+=_0xc107cf['trim']()),_0x3ca9bb&&(_0xfd9d6a['is_end']=![],_0x1f834f=_0xfd9d6a,_0x1f834f[_0x42b8cd(0x1b7)]=_0x113427),_0x3c51d3(_0xfd9d6a);}),_0x34bfbe['on'](_0x4ca2ef(0x1ae),()=>{_0x5785e2(_0x1f834f),_0x113427='';});})['catch'](_0x4dca49=>{const _0x313a5d=_0x11c436;console[_0x313a5d(0x1b4)]('error:\x20',_0x4dca49);});});}function _0x2c92(_0x540009,_0x25a470){const _0x3ea133=_0x3ea1();return _0x2c92=function(_0x2c92e7,_0x2dd6e7){_0x2c92e7=_0x2c92e7-0x1a5;let _0x238fd6=_0x3ea133[_0x2c92e7];return _0x238fd6;},_0x2c92(_0x540009,_0x25a470);}exports['sendMessageFromZhipu']=sendMessageFromZhipu;