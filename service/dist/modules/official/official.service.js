'use strict';const _0x41af3f=_0x2dce;function _0x2dce(_0x21b6a1,_0x5ea791){const _0x401678=_0x4016();return _0x2dce=function(_0x2dcec4,_0x1a4ad1){_0x2dcec4=_0x2dcec4-0xd4;let _0x3887f7=_0x401678[_0x2dcec4];return _0x3887f7;},_0x2dce(_0x21b6a1,_0x5ea791);}(function(_0x1d4607,_0x3887c9){const _0x559524=_0x2dce,_0x448232=_0x1d4607();while(!![]){try{const _0x7fe26c=-parseInt(_0x559524(0xd4))/0x1*(parseInt(_0x559524(0x121))/0x2)+-parseInt(_0x559524(0x10f))/0x3*(parseInt(_0x559524(0xf6))/0x4)+parseInt(_0x559524(0x111))/0x5+parseInt(_0x559524(0x12a))/0x6+parseInt(_0x559524(0xec))/0x7+parseInt(_0x559524(0xf1))/0x8*(parseInt(_0x559524(0x105))/0x9)+-parseInt(_0x559524(0x12e))/0xa;if(_0x7fe26c===_0x3887c9)break;else _0x448232['push'](_0x448232['shift']());}catch(_0xfcdfc2){_0x448232['push'](_0x448232['shift']());}}}(_0x4016,0x22268));var __decorate=this&&this['__decorate']||function(_0x4a7cb5,_0x31fb64,_0x30fa26,_0x138122){const _0xedebc2=_0x2dce;var _0x17ef21=arguments[_0xedebc2(0x12f)],_0x18c298=_0x17ef21<0x3?_0x31fb64:_0x138122===null?_0x138122=Object[_0xedebc2(0x132)](_0x31fb64,_0x30fa26):_0x138122,_0x51676d;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x18c298=Reflect['decorate'](_0x4a7cb5,_0x31fb64,_0x30fa26,_0x138122);else{for(var _0x365e55=_0x4a7cb5['length']-0x1;_0x365e55>=0x0;_0x365e55--)if(_0x51676d=_0x4a7cb5[_0x365e55])_0x18c298=(_0x17ef21<0x3?_0x51676d(_0x18c298):_0x17ef21>0x3?_0x51676d(_0x31fb64,_0x30fa26,_0x18c298):_0x51676d(_0x31fb64,_0x30fa26))||_0x18c298;}return _0x17ef21>0x3&&_0x18c298&&Object[_0xedebc2(0x113)](_0x31fb64,_0x30fa26,_0x18c298),_0x18c298;},__metadata=this&&this[_0x41af3f(0x130)]||function(_0x1fac8e,_0x39a105){const _0x20b966=_0x41af3f;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x20b966(0xd6))return Reflect[_0x20b966(0x128)](_0x1fac8e,_0x39a105);};Object[_0x41af3f(0x113)](exports,_0x41af3f(0x11d),{'value':!![]}),exports[_0x41af3f(0x13b)]=void 0x0;const chatgpt_service_1=require('../chatgpt/chatgpt.service'),globalConfig_service_1=require(_0x41af3f(0x118)),auth_service_1=require(_0x41af3f(0xea)),user_service_1=require(_0x41af3f(0x125)),autoreply_service_1=require(_0x41af3f(0xf3)),common_1=require(_0x41af3f(0x126)),crypto=require(_0x41af3f(0x117)),axios_1=require(_0x41af3f(0xfc)),utils_1=require('../../common/utils');function _0x4016(){const _0x5cc133=['&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','join','sort','axios','&noncestr=','str:\x20','getJsapiTicket','sceneStrMap','genXmlMsg',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','&timestamp=','loginBySceneStr','9qAbUMI','QR_STR_SCENE','jiangly','fromusername','非法参数','onModuleInit','&grant_type=authorization_code','officialAutoReplyText','default','tousername','353883oCVEVc','authService','1043715lpaqBY','getUserFromOpenId','defineProperty','createRandomNonceStr','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','GlobalConfigService','crypto','../globalConfig/globalConfig.service','aotoPlay','verify','get','autoreplyService','__esModule','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','race','loginByCode','58838wRndnh','checkAutoReply','chatgptService','user','../user/user.service','@nestjs/common','HttpStatus','metadata','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','1509444HfkIIN','userService',']]></Content>\x0a\x20\x20\x20\x20</xml>','design:paramtypes','4076950dBlkMy','length','__metadata','BAD_REQUEST','getOwnPropertyDescriptor','UserService','genXmlMsgByConfig','&redirect_uri=','scanedSceneStrMap','scan','sha1','now','globalConfigService','OfficialService','AuthService','getUserById','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','wechatAccessToken','3HPCvbB','jsapiTicket:\x20','function','split','log','wechatOfficialToken','getQRSceneStrByBind','getQRCodeTicket','loginByOpenId','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','chatSyncFree','&code=','digest','Injectable','fetchQRCodeTicket','来自公众号的询问问题\x20=======>\x20','&secret=','scanBindWx','getRedirectUrl',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','wechatOfficialAppSecret','jsapi_ticket=','../auth/auth.service','回跳跳转地址:\x20','424914OlfIOv','&url=','getUserOpenId','getConfigs','toFixed','1862192JFXbAP','AutoreplyService','../autoreply/autoreply.service','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','HttpException','4iyhWcX','wechatJsapiTicket','wechatOfficialAppId'];_0x4016=function(){return _0x5cc133;};return _0x4016();}let OfficialService=class OfficialService{constructor(_0x38ef43,_0x3e9d06,_0x2190bf,_0xcffacd,_0x69687b){const _0x54ace4=_0x41af3f;this[_0x54ace4(0x11c)]=_0x38ef43,this[_0x54ace4(0x12b)]=_0x3e9d06,this[_0x54ace4(0x110)]=_0x2190bf,this[_0x54ace4(0x13a)]=_0xcffacd,this[_0x54ace4(0x123)]=_0x69687b,this['sceneStrMap']={},this[_0x54ace4(0x136)]={};}async[_0x41af3f(0x10a)](){await this['globalConfigService']['getWechatAccessToken'](!![]);}async['getQRSceneStr'](_0x1b8f9d){const _0x27970e=_0x41af3f,{invitedBy:_0x29e836}=_0x1b8f9d;let _0x2cd6b5=(0x0,utils_1[_0x27970e(0x114)])(0x20);return _0x29e836&&(_0x2cd6b5+=':'+_0x29e836),this[_0x27970e(0x100)][_0x2cd6b5]=!![],_0x2cd6b5;}async[_0x41af3f(0xda)](_0x51bc01){const _0x3d5706=_0x41af3f,{id:_0x5e874c}=_0x51bc01['user'],_0x42dc67=(0x0,utils_1[_0x3d5706(0x114)])(0x20)+'/'+_0x5e874c;return this['sceneStrMap'][_0x42dc67]=!![],_0x42dc67;}async[_0x41af3f(0xdb)](_0x51caee){const _0xc8a5e7=_0x41af3f;return this[_0xc8a5e7(0xe2)](_0x51caee);}async[_0x41af3f(0xe6)](_0x4e1803){const _0x4ecf61=_0x41af3f,_0x496e06=await this[_0x4ecf61(0x13a)][_0x4ecf61(0xef)]([_0x4ecf61(0xf8)]),_0x131adb=_0x4ecf61(0x129)+_0x496e06+_0x4ecf61(0x135)+encodeURIComponent(_0x4e1803)+_0x4ecf61(0xf9);return console[_0x4ecf61(0xd8)](_0x4ecf61(0xeb),_0x131adb),_0x131adb;}async[_0x41af3f(0xff)](_0x557c49){const _0x495f91=_0x41af3f,_0x1b1d11=(0x0,utils_1[_0x495f91(0x114)])(0x20),_0x41dd43=(Date[_0x495f91(0x139)]()/0x3e8)[_0x495f91(0xf0)](0x0),_0x3b930e=await this[_0x495f91(0x13a)][_0x495f91(0xef)]([_0x495f91(0xf7)]);console[_0x495f91(0xd8)](_0x495f91(0xd5),_0x3b930e);const _0x5e66d1=await this[_0x495f91(0x13a)][_0x495f91(0xef)](['wechatOfficialAppId']);console[_0x495f91(0xd8)]('appId:\x20',_0x5e66d1);const _0x2d3aa8=_0x495f91(0xe9)+_0x3b930e+_0x495f91(0xfd)+_0x1b1d11+_0x495f91(0x103)+_0x41dd43+_0x495f91(0xed)+_0x557c49;console['log'](_0x495f91(0xfe),_0x2d3aa8);const _0x499fa8=this[_0x495f91(0x138)](_0x2d3aa8);return{'appId':_0x5e66d1,'nonceStr':_0x1b1d11,'timestamp':_0x41dd43,'signature':_0x499fa8};}async[_0x41af3f(0xe2)](_0x60d10f){const _0x3254f7=_0x41af3f,_0x292a98=await this['globalConfigService'][_0x3254f7(0xef)]([_0x3254f7(0x13f)]),_0x345f5e={'action_name':_0x3254f7(0x106),'action_info':{'scene':{'scene_str':_0x60d10f}}},_0x4695c3=await axios_1[_0x3254f7(0x10d)]['post'](_0x3254f7(0x115)+_0x292a98,_0x345f5e),{data:{errmsg:_0xc3dd9f,ticket:_0x2cf5b6}}=_0x4695c3;if(_0xc3dd9f)throw new common_1['HttpException'](_0xc3dd9f,common_1[_0x3254f7(0x127)][_0x3254f7(0x131)]);return _0x2cf5b6;}async[_0x41af3f(0x120)](_0x2756f5,_0x5b6b30){const _0x1bd198=_0x41af3f,_0x2a8356=await this[_0x1bd198(0x13a)]['getConfigs']([_0x1bd198(0xf8)]),_0x5f513a=await this['globalConfigService'][_0x1bd198(0xef)]([_0x1bd198(0xe8)]),_0x1cbef3=await axios_1[_0x1bd198(0x10d)][_0x1bd198(0x11b)](_0x1bd198(0xf4)+_0x2a8356+_0x1bd198(0xe4)+_0x5f513a+_0x1bd198(0xdf)+_0x5b6b30+_0x1bd198(0x10b)),{data:{errmsg:_0x17ed2a,openid:_0x21ab8e}}=_0x1cbef3;if(_0x17ed2a)throw new common_1['HttpException'](_0x17ed2a,common_1[_0x1bd198(0x127)][_0x1bd198(0x131)]);let _0x57074b;return _0x57074b=await this['userService'][_0x1bd198(0xee)](_0x21ab8e),!_0x57074b&&(_0x57074b=await this[_0x1bd198(0x12b)]['getUserFromOpenId'](_0x21ab8e)),this['authService'][_0x1bd198(0xdc)](_0x57074b,_0x2756f5);}async[_0x41af3f(0x137)](_0x490970,_0x5e1a72){const _0x58a88c=_0x41af3f;if(!this[_0x58a88c(0x100)][_0x5e1a72])throw new common_1[(_0x58a88c(0xf5))](_0x58a88c(0x109),common_1[_0x58a88c(0x127)]['BAD_REQUEST']);const _0x5041c4=await this[_0x58a88c(0x12b)][_0x58a88c(0x112)](_0x490970,_0x5e1a72);this[_0x58a88c(0x136)][_0x5e1a72]=_0x5041c4['id'];}async[_0x41af3f(0x104)](_0x4aac0f,_0x380fcf){const _0x560d90=_0x41af3f;if(!this['sceneStrMap'][_0x380fcf])return;const _0x1bbf11=this['scanedSceneStrMap'][_0x380fcf];if(!_0x1bbf11)return'';const _0x598652=await this[_0x560d90(0x12b)][_0x560d90(0x13d)](_0x1bbf11);return delete this[_0x560d90(0x136)][_0x380fcf],this[_0x560d90(0x110)]['loginByOpenId'](_0x598652,_0x4aac0f);}async[_0x41af3f(0xe5)](_0x22b739,_0x592ac9){const _0x32b33f=_0x41af3f;if(!this[_0x32b33f(0x100)][_0x592ac9])throw new common_1['HttpException']('非法参数',common_1[_0x32b33f(0x127)][_0x32b33f(0x131)]);const _0x20d1f6=_0x592ac9[_0x32b33f(0xd7)]('/')[0x1],_0x3b408e=await this[_0x32b33f(0x12b)]['bindWx'](_0x22b739,_0x20d1f6);this[_0x32b33f(0x136)][_0x592ac9]=_0x3b408e;}async['bindWxBySceneStr'](_0x3a4998,_0x3fb0e8){const _0x173939=_0x41af3f;if(!this[_0x173939(0x100)][_0x3fb0e8])throw new common_1[(_0x173939(0xf5))]('非法参数',common_1[_0x173939(0x127)][_0x173939(0x131)]);const {id:_0xdbc4a}=_0x3a4998[_0x173939(0x124)],_0x160c99=this[_0x173939(0x136)][_0x3fb0e8];if(!_0x160c99)return'';return delete this['scanedSceneStrMap'][_0x3fb0e8],_0x160c99;}async[_0x41af3f(0x11a)](_0x5ecf2b,_0x12967a,_0x4b9fe3){const _0x4698d5=_0x41af3f,_0xb361b5=await this['globalConfigService']['getConfigs']([_0x4698d5(0xd9)])||_0x4698d5(0x107);return await this[_0x4698d5(0x138)]([_0xb361b5,_0x12967a,_0x4b9fe3][_0x4698d5(0xfb)]()[_0x4698d5(0xfa)](''))==_0x5ecf2b;}['sha1'](_0x6ed0c8){const _0x2d0dbc=_0x41af3f;return crypto['createHash'](_0x2d0dbc(0x138))['update'](_0x6ed0c8)[_0x2d0dbc(0xe0)]('hex');}async[_0x41af3f(0x134)](_0x3b50d0,_0x58ee76){const _0x66c75e=_0x41af3f,_0x584c36=await this[_0x66c75e(0x13a)][_0x66c75e(0xef)]([_0x58ee76]);return this['genXmlMsg'](_0x3b50d0,_0x584c36);}async[_0x41af3f(0x101)](_0x2166cc,_0x41357d){const _0x57f8f3=_0x41af3f;return _0x57f8f3(0x13e)+_0x2166cc[_0x57f8f3(0x108)][0x0]+_0x57f8f3(0xe7)+_0x2166cc[_0x57f8f3(0x10e)][0x0]+_0x57f8f3(0x102)+new Date()['getTime']()+_0x57f8f3(0x11e)+_0x41357d+_0x57f8f3(0x12c);}async[_0x41af3f(0x119)](_0x2ef5df){const _0x62c423=_0x41af3f,_0x20aa89=new Promise((_0x262997,_0x586833)=>{setTimeout(()=>{_0x586833(new Error('请求超时'));},0x12c0);});let _0x3ff4c1='';try{console['log'](_0x62c423(0xe3),_0x2ef5df);const _0x122f8d=await Promise[_0x62c423(0x11f)]([this['chatgptService'][_0x62c423(0xde)](_0x2ef5df),_0x20aa89]);_0x3ff4c1=_0x122f8d||await this[_0x62c423(0x11c)][_0x62c423(0x122)](_0x2ef5df);}catch(_0x48b0ea){console[_0x62c423(0xd8)](_0x62c423(0xdd)),_0x3ff4c1=await this[_0x62c423(0x13a)][_0x62c423(0xef)]([_0x62c423(0x10c)])||'由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！';}return _0x3ff4c1;}};OfficialService=__decorate([(0x0,common_1[_0x41af3f(0xe1)])(),__metadata(_0x41af3f(0x12d),[autoreply_service_1[_0x41af3f(0xf2)],user_service_1[_0x41af3f(0x133)],auth_service_1[_0x41af3f(0x13c)],globalConfig_service_1[_0x41af3f(0x116)],chatgpt_service_1['ChatgptService']])],OfficialService),exports[_0x41af3f(0x13b)]=OfficialService;