'use strict';const _0x222f5f=_0x2495;(function(_0x3c38f8,_0x374b5c){const _0x49b459=_0x2495,_0x4eb381=_0x3c38f8();while(!![]){try{const _0x517706=parseInt(_0x49b459(0x22c))/0x1*(parseInt(_0x49b459(0x221))/0x2)+parseInt(_0x49b459(0x21c))/0x3+parseInt(_0x49b459(0x227))/0x4*(-parseInt(_0x49b459(0x21f))/0x5)+parseInt(_0x49b459(0x1d3))/0x6+parseInt(_0x49b459(0x1df))/0x7*(parseInt(_0x49b459(0x1ff))/0x8)+-parseInt(_0x49b459(0x21a))/0x9+-parseInt(_0x49b459(0x1d5))/0xa*(parseInt(_0x49b459(0x217))/0xb);if(_0x517706===_0x374b5c)break;else _0x4eb381['push'](_0x4eb381['shift']());}catch(_0x3332d2){_0x4eb381['push'](_0x4eb381['shift']());}}}(_0x5f43,0x24345));var __decorate=this&&this[_0x222f5f(0x1e9)]||function(_0x42c497,_0x40e664,_0x2bf35f,_0x453a8c){const _0x33157a=_0x222f5f;var _0x35d3ab=arguments[_0x33157a(0x1dc)],_0x34816e=_0x35d3ab<0x3?_0x40e664:_0x453a8c===null?_0x453a8c=Object[_0x33157a(0x1e7)](_0x40e664,_0x2bf35f):_0x453a8c,_0x11c8da;if(typeof Reflect===_0x33157a(0x206)&&typeof Reflect[_0x33157a(0x211)]===_0x33157a(0x1cd))_0x34816e=Reflect[_0x33157a(0x211)](_0x42c497,_0x40e664,_0x2bf35f,_0x453a8c);else{for(var _0x234b06=_0x42c497[_0x33157a(0x1dc)]-0x1;_0x234b06>=0x0;_0x234b06--)if(_0x11c8da=_0x42c497[_0x234b06])_0x34816e=(_0x35d3ab<0x3?_0x11c8da(_0x34816e):_0x35d3ab>0x3?_0x11c8da(_0x40e664,_0x2bf35f,_0x34816e):_0x11c8da(_0x40e664,_0x2bf35f))||_0x34816e;}return _0x35d3ab>0x3&&_0x34816e&&Object[_0x33157a(0x225)](_0x40e664,_0x2bf35f,_0x34816e),_0x34816e;},__metadata=this&&this[_0x222f5f(0x1ed)]||function(_0x22309e,_0x2b8ce7){const _0x5d3d3b=_0x222f5f;if(typeof Reflect==='object'&&typeof Reflect[_0x5d3d3b(0x1ce)]===_0x5d3d3b(0x1cd))return Reflect[_0x5d3d3b(0x1ce)](_0x22309e,_0x2b8ce7);},__param=this&&this[_0x222f5f(0x1d8)]||function(_0x1e6fdd,_0x1e7301){return function(_0x260d38,_0x94d52f){_0x1e7301(_0x260d38,_0x94d52f,_0x1e6fdd);};};Object[_0x222f5f(0x225)](exports,_0x222f5f(0x1ea),{'value':!![]}),exports[_0x222f5f(0x21b)]=void 0x0;function _0x2495(_0x3aa25a,_0x33cc47){const _0x5f43a6=_0x5f43();return _0x2495=function(_0x2495f9,_0x1e5b91){_0x2495f9=_0x2495f9-0x1cc;let _0x3ae4aa=_0x5f43a6[_0x2495f9];return _0x3ae4aa;},_0x2495(_0x3aa25a,_0x33cc47);}const common_1=require(_0x222f5f(0x1e2)),typeorm_1=require(_0x222f5f(0x1fc)),typeorm_2=require(_0x222f5f(0x1d4)),models_entity_1=require('./models.entity'),status_constant_1=require(_0x222f5f(0x1fb)),utils_1=require(_0x222f5f(0x216)),modelType_entity_1=require(_0x222f5f(0x218));let ModelsService=class ModelsService{constructor(_0x562a07,_0x1dc5fe){const _0x36b941=_0x222f5f;this[_0x36b941(0x22b)]=_0x562a07,this['modelsTypeEntity']=_0x1dc5fe,this[_0x36b941(0x1f7)]=[],this['modelMaps']={},this[_0x36b941(0x20b)]={},this[_0x36b941(0x210)]={},this[_0x36b941(0x1d6)]={};}async['onModuleInit'](){const _0x98e824=_0x222f5f;await this[_0x98e824(0x1dd)]();}async[_0x222f5f(0x1dd)](){const _0x555dd6=_0x222f5f;this[_0x555dd6(0x210)]={},this[_0x555dd6(0x1d6)]={},this[_0x555dd6(0x20b)]={},this[_0x555dd6(0x1eb)]={},this[_0x555dd6(0x1f7)]=[];const _0x287599=await this[_0x555dd6(0x22b)][_0x555dd6(0x223)]({'where':{'status':!![]}}),_0x513017=_0x287599['reduce']((_0x3205f0,_0xba566a)=>{const _0x1037f6=_0x555dd6;return!_0x3205f0[_0xba566a[_0x1037f6(0x205)]]?_0x3205f0[_0xba566a[_0x1037f6(0x205)]]=[_0xba566a]:_0x3205f0[_0xba566a[_0x1037f6(0x205)]][_0x1037f6(0x207)](_0xba566a),_0x3205f0;},{});this[_0x555dd6(0x1f7)]=Object['keys'](_0x513017)[_0x555dd6(0x222)](_0x1cddd8=>{const _0x41026b=_0x555dd6;return{'label':status_constant_1[_0x41026b(0x20e)][_0x1cddd8],'val':_0x1cddd8};}),this['modelMaps']=_0x513017,this['keyList']={},_0x287599['forEach'](_0x2ed161=>{const _0xfd7cfb=_0x555dd6,{keyType:_0x5853d6,model:_0x48b576,keyWeight:_0x44080b}=_0x2ed161;if(!this[_0xfd7cfb(0x210)][_0x48b576])this['keyPoolMap'][_0x48b576]=[];for(let _0x3f7a2e=0x0;_0x3f7a2e<_0x44080b;_0x3f7a2e++){this['keyPoolMap'][_0x48b576][_0xfd7cfb(0x207)](_0x2ed161);}if(!this['keyPoolIndexMap'][_0x48b576])this[_0xfd7cfb(0x1d6)][_0x48b576]=0x0;if(!this[_0xfd7cfb(0x20b)][_0x5853d6])this[_0xfd7cfb(0x20b)][_0x5853d6]={};if(!this[_0xfd7cfb(0x20b)][_0x5853d6][_0x48b576])this[_0xfd7cfb(0x20b)][_0x5853d6][_0x48b576]=[];this[_0xfd7cfb(0x20b)][_0x5853d6][_0x48b576]['push'](_0x2ed161);});}async[_0x222f5f(0x1e0)](_0x2cdab0,_0x794985,_0xd923dc=-0x1){const _0x4a0fa2=_0x222f5f,_0x36c59d=await this[_0x4a0fa2(0x22b)][_0x4a0fa2(0x1db)]({'id':_0x2cdab0},{'status':![],'keyStatus':_0xd923dc,'remark':_0x794985});common_1[_0x4a0fa2(0x1f2)][_0x4a0fa2(0x1ee)](_0x4a0fa2(0x1fe)+_0x2cdab0+_0x4a0fa2(0x1d7)),this[_0x4a0fa2(0x1dd)]();}async['getCurrentModelKeyInfo'](_0x3fff36){const _0x2c90c3=_0x222f5f;if(!this[_0x2c90c3(0x210)][_0x3fff36])throw new common_1[(_0x2c90c3(0x208))](_0x2c90c3(0x1e1),common_1['HttpStatus'][_0x2c90c3(0x1f9)]);this[_0x2c90c3(0x1d6)][_0x3fff36]++;const _0xd999fa=this[_0x2c90c3(0x1d6)][_0x3fff36];if(_0xd999fa>=this[_0x2c90c3(0x210)][_0x3fff36]['length'])this[_0x2c90c3(0x1d6)][_0x3fff36]=0x0;const _0x220124=this[_0x2c90c3(0x210)][_0x3fff36][this[_0x2c90c3(0x1d6)][_0x3fff36]];return _0x220124;}async[_0x222f5f(0x1f4)](_0x55abcc){const _0x2528b1=_0x222f5f;if(!this[_0x2528b1(0x1f7)]['length']||!Object[_0x2528b1(0x22a)](this[_0x2528b1(0x1eb)])[_0x2528b1(0x1dc)])return;const _0x4299d5=_0x55abcc?this[_0x2528b1(0x1f7)]['find'](_0x4b6970=>Number(_0x4b6970[_0x2528b1(0x20d)])===0x1):this['modelTypes'][0x0];if(!_0x4299d5)return;const {keyType:_0x4f5f3e,modelName:_0xb9accd,model:_0x15b92c,maxModelTokens:_0x4c2c30,maxResponseTokens:_0x14c683,deductType:_0x3eb65a,deduct:_0x1961dc,maxRounds:_0x5062ca}=this['modelMaps'][_0x4299d5['val']][0x0];return{'modelTypeInfo':_0x4299d5,'modelInfo':{'keyType':_0x4f5f3e,'modelName':_0xb9accd,'model':_0x15b92c,'maxModelTokens':_0x4c2c30,'maxResponseTokens':_0x14c683,'topN':0.8,'systemMessage':'','deductType':_0x3eb65a,'deduct':_0x1961dc,'maxRounds':_0x5062ca,'rounds':0x8}};}async['setModel'](_0x544ae0){const _0x31b138=_0x222f5f;try{const {id:_0x5c5aae}=_0x544ae0;_0x544ae0[_0x31b138(0x1f3)]&&(_0x544ae0[_0x31b138(0x202)]=0x1);if(_0x5c5aae){const _0x2b7034=await this[_0x31b138(0x22b)][_0x31b138(0x1db)]({'id':_0x5c5aae},_0x544ae0);return await this[_0x31b138(0x1dd)](),_0x2b7034[_0x31b138(0x1e5)]>0x0;}else{const {keyType:_0x75a5b2,key:_0x168bb6}=_0x544ae0;if(Number(_0x75a5b2!==0x1)){const _0x87cc9e=await this['modelsEntity'][_0x31b138(0x1f8)](_0x544ae0);return await this[_0x31b138(0x1dd)](),_0x87cc9e;}else{const _0xaa0b67=_0x168bb6[_0x31b138(0x222)](_0x50ed45=>{const _0x1d3877=_0x31b138;try{const _0x3ce403=JSON['parse'](JSON[_0x1d3877(0x229)](_0x544ae0));return _0x3ce403[_0x1d3877(0x1e3)]=_0x50ed45,_0x3ce403;}catch(_0x27730e){console[_0x1d3877(0x212)]('parse\x20error:\x20',_0x27730e);}}),_0x359f8d=await this[_0x31b138(0x22b)][_0x31b138(0x1f8)](_0xaa0b67);return await this[_0x31b138(0x1dd)](),_0x359f8d;}}}catch(_0x514c9d){console[_0x31b138(0x212)]('error:\x20',_0x514c9d);}}async['delModel']({id:_0x2fa41b}){const _0x5697ac=_0x222f5f;if(!_0x2fa41b)throw new common_1['HttpException']('缺失必要参数！',common_1[_0x5697ac(0x201)][_0x5697ac(0x1f9)]);const _0x20ec96=await this[_0x5697ac(0x22b)][_0x5697ac(0x1f5)]({'where':{'id':_0x2fa41b}});if(!_0x20ec96)throw new common_1[(_0x5697ac(0x208))](_0x5697ac(0x215),common_1['HttpStatus'][_0x5697ac(0x1f9)]);const _0x3a8922=await this[_0x5697ac(0x22b)][_0x5697ac(0x20c)]({'id':_0x2fa41b});return await this['initCalcKey'](),_0x3a8922;}async[_0x222f5f(0x1ef)](_0x54d8ea,_0x5e7043){const _0x1c8c5b=_0x222f5f,{role:_0x493345}=_0x54d8ea[_0x1c8c5b(0x1de)],{keyType:_0x4d66a3,key:_0xd8c94,status:_0x11ef5e,model:_0xca2f55,page:page=0x1,size:size=0xa}=_0x5e7043;let _0x31cb4c={};_0x4d66a3&&(_0x31cb4c[_0x1c8c5b(0x205)]=_0x4d66a3),_0xca2f55&&(_0x31cb4c[_0x1c8c5b(0x1d0)]=_0xca2f55),_0x11ef5e&&(_0x31cb4c[_0x1c8c5b(0x1f3)]=Number(_0x11ef5e)===0x1?!![]:![]),_0xd8c94&&(_0x31cb4c['key']=(0x0,typeorm_2[_0x1c8c5b(0x1d1)])('%'+_0xd8c94+'%'));const [_0x54c9fb,_0x3dd702]=await this[_0x1c8c5b(0x22b)][_0x1c8c5b(0x20a)]({'where':_0x31cb4c,'order':{'modelOrder':'ASC'},'skip':(page-0x1)*size,'take':size});return _0x493345!==_0x1c8c5b(0x1cc)&&_0x54c9fb[_0x1c8c5b(0x224)](_0xd603e4=>{const _0x395cc1=_0x1c8c5b;_0xd603e4['key']&&(_0xd603e4[_0x395cc1(0x1e3)]=(0x0,utils_1[_0x395cc1(0x21e)])(_0xd603e4['key'])),_0xd603e4['secret']&&(_0xd603e4[_0x395cc1(0x1f0)]=(0x0,utils_1[_0x395cc1(0x21e)])(_0xd603e4[_0x395cc1(0x1f0)]));}),{'rows':_0x54c9fb,'count':_0x3dd702};}async['modelsList'](){const _0x5f0001=_0x222f5f,_0x1e50f3=JSON[_0x5f0001(0x1cf)](JSON['stringify'](this[_0x5f0001(0x1eb)]));return Object[_0x5f0001(0x22a)](_0x1e50f3)[_0x5f0001(0x224)](_0x440258=>{const _0x304a06=_0x5f0001;_0x1e50f3[_0x440258]=_0x1e50f3[_0x440258][_0x304a06(0x213)]((_0xfd843c,_0x41c592)=>_0xfd843c[_0x304a06(0x1f6)]-_0x41c592[_0x304a06(0x1f6)]),_0x1e50f3[_0x440258]=Array['from'](_0x1e50f3[_0x440258][_0x304a06(0x222)](_0x4bb90d=>{const {modelName:_0x47a722,model:_0xbb907b,deduct:_0x354d38,deductType:_0x44fec4,maxRounds:_0x1b5f1a}=_0x4bb90d;return{'modelName':_0x47a722,'model':_0xbb907b,'deduct':_0x354d38,'deductType':_0x44fec4,'maxRounds':_0x1b5f1a};})[_0x304a06(0x1d2)]((_0x49ca15,_0x3cd263)=>_0x49ca15[_0x304a06(0x226)](_0x3cd263[_0x304a06(0x1e8)],_0x3cd263),new Map())[_0x304a06(0x204)]());}),{'modelTypeList':this[_0x5f0001(0x1f7)],'modelMaps':_0x1e50f3};}async[_0x222f5f(0x1e6)](_0x8a844b,_0x133afb){const _0x1c95b2=_0x222f5f;await this[_0x1c95b2(0x22b)]['createQueryBuilder']()[_0x1c95b2(0x1db)](models_entity_1[_0x1c95b2(0x1f1)])['set']({'useCount':()=>_0x1c95b2(0x1fd),'useToken':()=>_0x1c95b2(0x1fa)+_0x133afb})[_0x1c95b2(0x20f)](_0x1c95b2(0x1d9),{'id':_0x8a844b})[_0x1c95b2(0x21d)]();}async[_0x222f5f(0x219)](){const _0x1fa55c=_0x222f5f,_0x4912bd=await this[_0x1fa55c(0x22b)][_0x1fa55c(0x223)]({'where':{'isDraw':!![],'status':!![]}});if(!_0x4912bd[_0x1fa55c(0x1dc)])throw new common_1[(_0x1fa55c(0x208))](_0x1fa55c(0x228),common_1[_0x1fa55c(0x201)][_0x1fa55c(0x1f9)]);return(0x0,utils_1[_0x1fa55c(0x1e4)])(_0x4912bd);}async[_0x222f5f(0x1ec)](){const _0x11fd14=_0x222f5f;return await this[_0x11fd14(0x22b)][_0x11fd14(0x223)]();}async[_0x222f5f(0x214)](_0x4a91bc){return 0x1;}async['setModelType'](_0x58a11d){return 0x1;}async[_0x222f5f(0x200)](_0x1883ee){return 0x1;}};function _0x5f43(){const _0x2e792d=['findOne','modelOrder','modelTypes','save','BAD_REQUEST','useToken\x20+\x20','../../common/constants/status.constant','@nestjs/typeorm','useCount\x20+\x201','key:\x20','16wJNOfc','delModelType','HttpStatus','keyStatus','Repository','values','keyType','object','push','HttpException','Injectable','findAndCount','keyList','delete','val','ModelsMapCn','where','keyPoolMap','decorate','log','sort','queryModelType','当前账号不存在！','../../common/utils','11WlxCMT','./modelType.entity','getRandomDrawKey','1813527hMkOMW','ModelsService','795537FjbbLz','execute','hideString','825395CorHTV','design:paramtypes','235240GnXhwc','map','find','forEach','defineProperty','set','4YLpZcE','当前未指定特殊模型KEY、前往后台模型池设置吧！','stringify','keys','modelsEntity','2ghHqMV','super','function','metadata','parse','model','Like','reduce','1454478iKOEhU','typeorm','3361870tMJqID','keyPoolIndexMap','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','__param','id\x20=\x20:id','InjectRepository','update','length','initCalcKey','user','378805GmLMjN','lockKey','当前调用模型已经被移除、请重新选择模型！','@nestjs/common','key','getRandomItemFromArray','affected','saveUseLog','getOwnPropertyDescriptor','modelName','__decorate','__esModule','modelMaps','getAllKey','__metadata','error','queryModels','secret','ModelsEntity','Logger','status','getBaseConfig'];_0x5f43=function(){return _0x2e792d;};return _0x5f43();}ModelsService=__decorate([(0x0,common_1[_0x222f5f(0x209)])(),__param(0x0,(0x0,typeorm_1[_0x222f5f(0x1da)])(models_entity_1['ModelsEntity'])),__param(0x1,(0x0,typeorm_1[_0x222f5f(0x1da)])(modelType_entity_1['ModelsTypeEntity'])),__metadata(_0x222f5f(0x220),[typeorm_2[_0x222f5f(0x203)],typeorm_2[_0x222f5f(0x203)]])],ModelsService),exports[_0x222f5f(0x21b)]=ModelsService;