
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as re}from"./index-ffb2bbfd.js";import{d as ue,r as c,O as U,z as B,q as de,h as s,P as ie,o as b,c as z,e as l,f as a,j as pe,l as me,Q as ce,R as fe,b as r,k as i,w as ge,G as P,t as S,a as _e,S as ve,U as C,V as be,E as V,n as M}from"./index-6b0fe787.js";import{u as ye}from"./utcformatTime-e76e5157.js";import{E as we,Q as Ve}from"./index-39bad72e.js";const ke=["src"],Ce={class:"flex justify-end mr-5"},Ie=ue({__name:"classify",setup(Ue){const T=c(),x=c(0),f=c(!1),k=c(!1),N=c("/api/upload/file"),d=U({name:"",status:"",page:1,size:10}),I=c(),v=c(0),n=U({name:"",des:"",coverImg:"",order:100,status:0}),R=U({name:[{required:!0,message:"请填写分类名称",trigger:"blur"}],des:[{required:!0,message:"请填写分类描述",trigger:"blur"}],coverImg:[{required:!1,message:"请填写分类封面图片地址",trigger:"blur"}],order:[{required:!1,message:"请填写排序ID",trigger:"blur"}],status:[{required:!0,message:"请选择分类状态",trigger:"change"}]}),D=c([]),j=B(()=>v.value?"更新套餐":"新增套餐"),O=B(()=>v.value?"确认更新":"确认新增");async function p(){try{k.value=!0;const o=await C.queryCats(d),{rows:e,count:y}=o.data;k.value=!1,x.value=y,D.value=e}catch{k.value=!1}}function h(o){v.value=o.id;const{name:e,status:y,des:w,order:g,coverImg:u}=o;be(()=>{Object.assign(n,{name:e,status:y,des:w,order:g,coverImg:u})}),f.value=!0}function F(o){v.value=0,o==null||o.resetFields()}async function G(o){await C.deleteCats({id:o.id}),V.success("删除分类成功"),p()}function K(o){o==null||o.resetFields(),p()}const Y=(o,e)=>{n.coverImg=o.data},L=o=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(o.type)){if(o.size/1024>300)return V.error("当前限制文件最大不超过 300KB!"),!1}else return V.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1;return!0};function Q(o){o==null||o.validate(async e=>{e&&(v.value?(await C.updateCats({id:v.value,...n}),V({type:"success",message:"更新套餐成功！"})):(await C.createCats(n),V({type:"success",message:"创建新的套餐成功！"})),f.value=!1,p())})}return de(()=>{p()}),(o,e)=>{const y=s("el-alert"),w=re,g=s("el-input"),u=s("el-form-item"),J=s("el-option"),W=s("el-select"),_=s("el-button"),A=s("Plus"),q=s("el-icon"),$=s("el-form"),H=s("el-image"),m=s("el-table-column"),X=s("el-tag"),Z=s("el-popconfirm"),E=s("el-table"),ee=s("el-pagination"),le=s("el-row"),te=s("el-switch"),ae=s("el-upload"),oe=s("el-dialog"),se=ie("loading");return b(),z("div",null,[l(w,null,{default:a(()=>[l(y,{closable:!1,"show-icon":"",title:"应用分类说明",description:"你创建的为系统内置分类、可能会被多个用户收藏、一旦创建、不建议删除、系统或限制已经创建的应用、请合理规范应用以免造成不必要的迷惑。",type:"success"})]),_:1}),l(w,null,{default:a(()=>[l($,{ref_key:"formRef",ref:T,inline:!0,model:d},{default:a(()=>[l(u,{label:"分类名称",prop:"name"},{default:a(()=>[l(g,{modelValue:d.name,"onUpdate:modelValue":e[0]||(e[0]=t=>d.name=t),placeholder:"分类名称[模糊搜索]",onKeydown:pe(me(p,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),l(u,{label:"分类状态",prop:"status"},{default:a(()=>[l(W,{modelValue:d.status,"onUpdate:modelValue":e[1]||(e[1]=t=>d.status=t),placeholder:"请选择分类状态",clearable:""},{default:a(()=>[(b(!0),z(ce,null,fe(r(we),t=>(b(),P(J,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(_,{type:"primary",onClick:p},{default:a(()=>e[15]||(e[15]=[i(" 查询 ")])),_:1}),l(_,{onClick:e[2]||(e[2]=t=>K(r(T)))},{default:a(()=>e[16]||(e[16]=[i(" 重置 ")])),_:1})]),_:1}),l(_,{type:"success",style:{float:"right"},onClick:e[3]||(e[3]=t=>f.value=!0)},{default:a(()=>[e[17]||(e[17]=i(" 创建分类 ")),l(q,{class:"ml-3"},{default:a(()=>[l(A)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(w,{style:{width:"100%"}},{default:a(()=>[ge((b(),P(E,{border:"",data:r(D),style:{width:"100%"},size:"large"},{default:a(()=>[l(m,{prop:"coverImg",label:"套餐封面",width:"120"},{default:a(t=>[l(H,{style:{height:"50px"},src:t.row.coverImg,fit:"fill"},null,8,["src"])]),_:1}),l(m,{prop:"name",label:"分类名称"}),l(m,{prop:"appCount",label:"app数量"}),l(m,{prop:"order",label:"排序ID"}),l(m,{prop:"status",label:"分类状态"},{default:a(t=>[l(X,{type:t.row.status===1?"success":"danger"},{default:a(()=>[i(S(r(Ve)[t.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"des",label:"描述信息",width:"300"}),l(m,{prop:"createdAt",label:"创建时间",width:"200"},{default:a(t=>[i(S(r(ye)(t.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),l(m,{label:"操作",width:"200"},{default:a(t=>[l(_,{link:"",type:"primary",size:"small",onClick:ne=>h(t.row)},{default:a(()=>e[18]||(e[18]=[i(" 编辑 ")])),_:2},1032,["onClick"]),l(Z,{title:"确认删除此分类么?",width:"200","icon-color":"red",onConfirm:ne=>G(t.row)},{reference:a(()=>[l(_,{link:"",type:"danger",size:"small"},{default:a(()=>e[19]||(e[19]=[i(" 删除分类 ")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[se,r(k)]]),l(le,{class:"flex justify-end mt-5"},{default:a(()=>[l(ee,{"current-page":d.page,"onUpdate:currentPage":e[4]||(e[4]=t=>d.page=t),"page-size":d.size,"onUpdate:pageSize":e[5]||(e[5]=t=>d.size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:r(x),onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(oe,{modelValue:r(f),"onUpdate:modelValue":e[13]||(e[13]=t=>ve(f)?f.value=t:null),"close-on-click-modal":!1,title:r(j),width:"570",onClose:e[14]||(e[14]=t=>F(r(I)))},{footer:a(()=>[_e("span",Ce,[l(_,{onClick:e[11]||(e[11]=t=>f.value=!1)},{default:a(()=>e[20]||(e[20]=[i("取消")])),_:1}),l(_,{type:"primary",onClick:e[12]||(e[12]=t=>Q(r(I)))},{default:a(()=>[i(S(r(O)),1)]),_:1})])]),default:a(()=>[l($,{ref_key:"formPackageRef",ref:I,"label-position":"right","label-width":"100px",model:n,rules:R},{default:a(()=>[l(u,{label:"分类名称",prop:"name"},{default:a(()=>[l(g,{modelValue:n.name,"onUpdate:modelValue":e[6]||(e[6]=t=>n.name=t),placeholder:"请填写分类名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"分类状态",prop:"status"},{default:a(()=>[l(te,{modelValue:n.status,"onUpdate:modelValue":e[7]||(e[7]=t=>n.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),l(u,{label:"背景地址",prop:"coverImg"},{default:a(()=>[l(g,{modelValue:n.coverImg,"onUpdate:modelValue":e[8]||(e[8]=t=>n.coverImg=t),placeholder:"请填写封面图地址"},null,8,["modelValue"])]),_:1}),l(u,{label:"封面",prop:"coverImg"},{default:a(()=>[l(ae,{class:"avatar-uploader",action:r(N),"show-file-list":!1,"on-success":Y,"before-upload":L},{default:a(()=>[n.coverImg?(b(),z("img",{key:0,src:n.coverImg,style:{width:"100px"},class:"avatar"},null,8,ke)):(b(),P(q,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[l(A)]),_:1}))]),_:1},8,["action"])]),_:1}),l(u,{label:"排序ID",prop:"order"},{default:a(()=>[l(g,{modelValue:n.order,"onUpdate:modelValue":e[9]||(e[9]=t=>n.order=t),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])]),_:1}),l(u,{label:"套餐描述",prop:"des"},{default:a(()=>[l(g,{modelValue:n.des,"onUpdate:modelValue":e[10]||(e[10]=t=>n.des=t),type:"textarea",placeholder:"请填写分类介绍信息、用于对外展示...",rows:4},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof M=="function"&&M(Ie);export{Ie as default};
