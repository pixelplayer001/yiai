
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as W}from"./index-ffb2bbfd.js";import{W as A,d as H,r as p,O as J,q as K,h as n,P as X,o as d,c as v,e as t,f as a,Q as P,R as x,b as s,k as f,w as Z,G as h,t as k,N as E,E as I,n as M}from"./index-6b0fe787.js";import{P as ee,k as te,l as le,m as ae}from"./index-39bad72e.js";import{u as oe}from"./utcformatTime-e76e5157.js";const O={queryAllOrder:m=>A.get("order/queryAll",{params:m}),deleteOrder:m=>A.post("order/delete",m),deleteNotPay:()=>A.post("order/deleteNotPay")},re=H({__name:"index",setup(m){const g=p(!1),b=p(!1),z=p([]),C=p(),S=p(0),T=p(0),o=J({userId:"",platform:"",status:"",page:1,size:15}),V=p([]);async function i(){g.value=!0;try{const r=await O.queryAllOrder(o);g.value=!1;const{rows:l,count:c,total_price:_}=r.data;S.value=c,V.value=l,T.value=_}catch{g.value=!1}}async function N(r){const l=await E.queryAllUser({size:30,username:r});z.value=l.data.rows}function Y(r){r==null||r.resetFields(),i()}async function q(r){const{orderId:l}=r;await O.deleteOrder({orderId:l}),I.success("删除订单完成!"),i()}async function L(){b.value=!0;try{await O.deleteNotPay(),I.success("删除未支付订单完成!"),await i(),b.value=!1}catch{I.error("删除未支付订单失败!"),b.value=!1}}return K(()=>{i()}),(r,l)=>{const c=n("el-option"),_=n("el-select"),w=n("el-form-item"),y=n("el-button"),U=n("el-popconfirm"),R=n("el-form"),F=n("el-statistic"),D=W,u=n("el-table-column"),j=n("el-tag"),B=n("el-table"),$=n("el-pagination"),G=n("el-row"),Q=X("loading");return d(),v("div",null,[t(D,{class:"flex justify-between items-center"},{default:a(()=>[t(R,{ref_key:"formRef",ref:C,inline:!0,model:o},{default:a(()=>[t(w,{label:"用户名称",prop:"userId"},{default:a(()=>[t(_,{modelValue:o.userId,"onUpdate:modelValue":l[0]||(l[0]=e=>o.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":N},{default:a(()=>[(d(!0),v(P,null,x(s(z),e=>(d(),h(c,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"支付平台",prop:"platform"},{default:a(()=>[t(_,{modelValue:o.platform,"onUpdate:modelValue":l[1]||(l[1]=e=>o.platform=e),clearable:"",placeholder:"请选择支付平台","remote-show-suffix":""},{default:a(()=>[(d(!0),v(P,null,x(s(ee),e=>(d(),h(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"支付状态",prop:"status"},{default:a(()=>[t(_,{modelValue:o.status,"onUpdate:modelValue":l[2]||(l[2]=e=>o.status=e),clearable:"",placeholder:"请选择支付状态","remote-show-suffix":""},{default:a(()=>[(d(!0),v(P,null,x(s(te),e=>(d(),h(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,null,{default:a(()=>[t(y,{type:"primary",onClick:i},{default:a(()=>l[6]||(l[6]=[f(" 查询 ")])),_:1}),t(y,{onClick:l[3]||(l[3]=e=>Y(s(C)))},{default:a(()=>l[7]||(l[7]=[f(" 重置 ")])),_:1}),t(U,{title:"确认删除所有未支付订单么?",onConfirm:L},{reference:a(()=>[t(y,{type:"danger"},{default:a(()=>l[8]||(l[8]=[f("删除所有未支付订单")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),t(F,{title:"累计已支付订单金额",value:s(T)},null,8,["value"])]),_:1}),t(D,{style:{width:"100%"}},{default:a(()=>[Z((d(),h(B,{border:"",data:s(V),style:{width:"100%"},size:"large","tooltip-options":{}},{default:a(()=>[t(u,{fixed:"",prop:"orderId",label:"订单ID",width:"315"}),t(u,{prop:"userInfo.username",label:"用户名称",width:"180"}),t(u,{prop:"userInfo.email",label:"用户邮箱",width:"200"}),t(u,{prop:"goodsInfo.name",label:"套餐名称",width:"140"}),t(u,{prop:"price",label:"商品单价",width:"110"}),t(u,{prop:"count",label:"购买数量",width:"90",align:"center"}),t(u,{prop:"total",label:"订单总价",width:"90",align:"center"}),t(u,{prop:"total",label:"支付平台",width:"90",align:"center"},{default:a(e=>[f(k(s(le)[e.row.payPlatform]),1)]),_:1}),t(u,{prop:"status",label:"支付状态",width:"90",align:"center"},{default:a(e=>[t(j,{type:e.row.status===1?"success":"warning"},{default:a(()=>[f(k(s(ae)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"createdAt",label:"订单时间",width:"200",fixed:"right"},{default:a(e=>[f(k(s(oe)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(u,{fixed:"right",label:"操作"},{default:a(e=>[t(U,{title:"确认删除此订单么、删除订单不可恢复?",width:"400","icon-color":"red",onConfirm:ne=>q(e.row)},{reference:a(()=>[t(y,{link:"",type:"danger",size:"small",loading:s(b)},{default:a(()=>l[9]||(l[9]=[f(" 删除订单 ")])),_:1},8,["loading"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Q,s(g)]]),t(G,{class:"flex justify-end mt-5"},{default:a(()=>[t($,{"current-page":o.page,"onUpdate:currentPage":l[4]||(l[4]=e=>o.page=e),"page-size":o.size,"onUpdate:pageSize":l[5]||(l[5]=e=>o.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:s(S),onSizeChange:i,onCurrentChange:i},null,8,["current-page","page-size","total"])]),_:1})]),_:1})])}}});typeof M=="function"&&M(re);export{re as default};
