
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as ye}from"./index-ffb2bbfd.js";import{A as C}from"./chatgpt-97f50f25.js";import{u as ke}from"./utcformatTime-e76e5157.js";import{M as ge,b as _e,c as be,Q as ce}from"./index-39bad72e.js";import{d as ve,r as k,O as R,z as W,q as we,h as d,P as Ve,o as g,c as S,e as t,f as o,Q as $,R as K,b as i,k as n,a as N,w as O,G as V,t as f,S as X,E as x,V as xe,n as Z}from"./index-6b0fe787.js";const Te={style:{float:"right"}},Ue={class:"flex justify-end mr-5"},Ce={class:"flex justify-end mr-5"},Me=ve({__name:"list",setup(De){const I=k(),j=k(),G=k(0),b=k(!1),M=k(!1),Y=k(!1),v=k(!1),E=k(["gpt-4","gpt-4-0613","gpt-4-32k","gpt-4-32k-0613","gpt-3.5-turbo","gpt-3.5-turbo-0613","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","code-davinci-002","ada","davinci"]),D=R({keyList:""}),y=R({key:"",model:"",status:"",page:1,size:10}),P=k(),w=k(0),s=R({key:"",model:"",maxModelTokens:null,maxResponseTokens:null,openaiProxyUrl:"",openaiTimeoutMs:null,weight:1,status:1}),ee=R({key:[{required:!0,message:"请填写您的chatgpt key",trigger:"blur"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],weight:[{required:!1,message:"请填写key的权重值",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],maxModelTokens:[{required:!1,message:"请填写模型最大token数",trigger:"blur"}],maxResponseTokens:[{required:!1,message:"请填写最大回复token数",trigger:"blur"}],openaiProxyUrl:[{required:!1,message:"请填写指定代理地址",trigger:"blur"}]});function h(a){w.value=0,a==null||a.resetFields()}const le=W(()=>w.value?"更新秘钥":"新增秘钥"),Q=W(()=>w.value?"确认更新":"确认新增"),F=k([]);async function H(){}async function _(){try{M.value=!0;const a=await C.queryKeyList(y);M.value=!1;const{rows:l,count:m}=a.data;G.value=m,F.value=l}catch{M.value=!1}}async function te(a){const{id:l}=a;await C.deleteGptKey({id:l}),x({type:"success",message:"删除秘钥成功！"}),_()}function oe(a){w.value=a.id;const{key:l,model:m,weight:r,status:c,type:T,maxModelTokens:u,maxResponseTokens:A,openaiProxyUrl:L,openaiTimeoutMs:U}=a;xe(()=>{Object.assign(s,{key:l,model:m,weight:r,status:c,type:T,maxModelTokens:u,maxResponseTokens:A,openaiProxyUrl:L,openaiTimeoutMs:U})}),b.value=!0}function ae(a){a==null||a.resetFields(),_()}async function ne(a){a==null||a.validate(async l=>{l&&(w.value?(await C.updateGptKey({id:w.value,...s}),x({type:"success",message:"更新秘钥成功！"})):(await C.addGptKey(s),x({type:"success",message:"添加秘钥成功！"})),b.value=!1,_())})}function se(a){a==null||a.validate(async l=>{if(l){const{keyList:m}=D,r=m.split(`
`);if(r.length>100)return x.error("批量添加key不能超过100个");if(!r.length)return x.error("请按要求填写您的key秘钥");const c=await C.builCreateGptKey({keyList:r});D.keyList="",x({type:"success",message:c.data}),v.value=!1,_()}})}return we(()=>{_()}),(a,l)=>{const m=d("el-input"),r=d("el-form-item"),c=d("el-option"),T=d("el-select"),u=d("el-button"),A=d("Plus"),L=d("el-icon"),U=d("el-form"),z=ye,ue=d("el-alert"),p=d("el-table-column"),q=d("el-tag"),re=d("el-popconfirm"),ie=d("el-table"),de=d("el-pagination"),pe=d("el-row"),me=d("el-switch"),J=d("el-dialog"),B=Ve("loading");return g(),S("div",null,[t(z,null,{default:o(()=>[t(U,{ref_key:"formRef",ref:j,inline:!0,model:y},{default:o(()=>[t(r,{label:"key",prop:"key"},{default:o(()=>[t(m,{modelValue:y.key,"onUpdate:modelValue":l[0]||(l[0]=e=>y.key=e),placeholder:"sk-*** [模糊搜索]"},null,8,["modelValue"])]),_:1}),t(r,{label:"使用模型",prop:"model"},{default:o(()=>[t(T,{modelValue:y.model,"onUpdate:modelValue":l[1]||(l[1]=e=>y.model=e),placeholder:"请选择绑定的模型",clearable:""},{default:o(()=>[(g(!0),S($,null,K(i(ge),e=>(g(),V(c,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"启用状态",prop:"status"},{default:o(()=>[t(T,{modelValue:y.status,"onUpdate:modelValue":l[2]||(l[2]=e=>y.status=e),placeholder:"请选择key启用状态",clearable:""},{default:o(()=>[(g(!0),S($,null,K(i(_e),e=>(g(),V(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:o(()=>[t(u,{type:"primary",onClick:_},{default:o(()=>l[25]||(l[25]=[n(" 查询 ")])),_:1}),t(u,{onClick:l[3]||(l[3]=e=>ae(i(j)))},{default:o(()=>l[26]||(l[26]=[n(" 重置 ")])),_:1})]),_:1}),N("span",Te,[t(u,{type:"success",onClick:l[4]||(l[4]=e=>v.value=!0)},{default:o(()=>[l[27]||(l[27]=n(" 批量添加Key ")),t(L,{class:"ml-3"},{default:o(()=>[t(A)]),_:1})]),_:1}),t(u,{type:"success",onClick:l[5]||(l[5]=e=>b.value=!0)},{default:o(()=>[l[28]||(l[28]=n(" 添加Key ")),t(L,{class:"ml-3"},{default:o(()=>[t(A)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),t(z,null,{default:o(()=>[t(ue,{"show-icon":"",title:"模块已废弃",description:"当前版本会在2.0之后废弃、本次保留是为了让你查询历史key、后续此模块会直接移除、新的key池在下方『模型池设置』中、详细配置可以查看提示或参考官方文档！",type:"error"})]),_:1}),t(z,{style:{width:"100%"}},{default:o(()=>[O((g(),V(ie,{border:"",data:i(F),style:{width:"100%"},size:"large"},{default:o(()=>[t(p,{prop:"key",label:"key秘钥",width:"470"}),t(p,{prop:"model",align:"center",label:"绑定模型",width:"160"},{default:o(e=>[t(q,{type:e.row.model.includes("gpt-4")?"success":""},{default:o(()=>[n(f(e.row.model),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:o(e=>[t(q,{type:i(be)[e.row.status]},{default:o(()=>[n(f(i(ce)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"keyDetail.totalAmount",align:"center",label:"账户总额",width:"90"},{default:o(e=>[t(u,{type:"info",text:""},{default:o(()=>[n(f(e.row.keyDetail.totalAmount||"-"),1)]),_:2},1024)]),_:1}),t(p,{prop:"keyDetail.useAmount",align:"center",label:"已用额度",width:"90"},{default:o(e=>[t(u,{type:"danger",text:""},{default:o(()=>[n(f(e.row.keyDetail.useAmount||"-"),1)]),_:2},1024)]),_:1}),t(p,{prop:"keyDetail.balance",align:"center",label:"剩余额度",width:"90"},{default:o(e=>[t(u,{type:"success",text:""},{default:o(()=>[n(f(e.row.keyDetail.balance||"-"),1)]),_:2},1024)]),_:1}),t(p,{prop:"keyDetail.expirDate",align:"center",label:"过期时间",width:"130"},{default:o(e=>[t(u,{type:"danger",text:""},{default:o(()=>[n(f(e.row.keyDetail.expirDate||"-"),1)]),_:2},1024)]),_:1}),t(p,{prop:"weight",align:"center",label:"秘钥权重",width:"90"}),t(p,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),t(p,{prop:"keyStatus",align:"center",label:"key状态",width:"90"},{default:o(e=>[t(q,{type:e.row.keyDetail.status===1?"success":"danger"},{default:o(()=>[n(f(e.row.keyDetail.status===1?"正常工作":e.row.keyDetail.status===-1?"查询失败":"已被封禁"),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"maxModelTokens",align:"center",label:"模型最大上下文",width:"140"},{default:o(e=>[t(u,{type:"info",text:""},{default:o(()=>[n(f(e.row.maxModelTokens||"-"),1)]),_:2},1024)]),_:1}),t(p,{prop:"maxResponseTokens",align:"center",label:"最大回复支持Token",width:"160"},{default:o(e=>[t(u,{type:"info",text:""},{default:o(()=>[n(f(e.row.maxResponseTokens||"-"),1)]),_:2},1024)]),_:1}),t(p,{prop:"openaiProxyUrl",align:"center",label:"绑定的代理地址",width:"230"},{default:o(e=>[t(u,{type:"info",text:""},{default:o(()=>[n(f(e.row.openaiProxyUrl||"-"),1)]),_:2},1024)]),_:1}),t(p,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:o(e=>[n(f(i(ke)(e.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),t(p,{fixed:"right",label:"操作",width:"200"},{default:o(e=>[t(u,{link:"",type:"primary",size:"small",onClick:fe=>oe(e.row)},{default:o(()=>l[29]||(l[29]=[n(" 变更 ")])),_:2},1032,["onClick"]),t(re,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:fe=>te(e.row)},{reference:o(()=>[t(u,{link:"",type:"danger",size:"small"},{default:o(()=>l[30]||(l[30]=[n(" 删除秘钥 ")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[B,i(M)]]),t(pe,{class:"flex justify-end mt-5"},{default:o(()=>[t(de,{"current-page":y.page,"onUpdate:currentPage":l[6]||(l[6]=e=>y.page=e),"page-size":y.size,"onUpdate:pageSize":l[7]||(l[7]=e=>y.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:i(G),onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(J,{modelValue:i(b),"onUpdate:modelValue":l[18]||(l[18]=e=>X(b)?b.value=e:null),"close-on-click-modal":!1,title:"批量添加秘钥",width:"670",onClose:l[19]||(l[19]=e=>h(i(P)))},{footer:o(()=>[N("span",Ue,[t(u,{onClick:l[16]||(l[16]=e=>b.value=!1)},{default:o(()=>l[32]||(l[32]=[n("取消")])),_:1}),t(u,{type:"primary",onClick:l[17]||(l[17]=e=>ne(i(P)))},{default:o(()=>[n(f(Q.value),1)]),_:1})])]),default:o(()=>[O((g(),V(U,{ref_key:"formPackageRef",ref:P,"label-position":"right","label-width":"120px",model:s,rules:ee},{default:o(()=>[t(r,{label:"key卡账号",prop:"key"},{default:o(()=>[t(m,{modelValue:s.key,"onUpdate:modelValue":l[8]||(l[8]=e=>s.key=e),placeholder:"请填写chatgpt key",onBlur:H},null,8,["modelValue"])]),_:1}),t(r,{label:"启用状态",prop:"status"},{default:o(()=>[t(me,{modelValue:s.status,"onUpdate:modelValue":l[9]||(l[9]=e=>s.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),t(r,{label:"绑定模型",prop:"model"},{default:o(()=>[t(T,{modelValue:s.model,"onUpdate:modelValue":l[10]||(l[10]=e=>s.model=e),filterable:"",clearable:"",placeholder:"请选用当前key绑定的模型"},{default:o(()=>[(g(!0),S($,null,K(i(E),e=>(g(),V(c,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(u,{type:"primary",class:"ml-5",onClick:H},{default:o(()=>l[31]||(l[31]=[n(" 请指定当前key调用的模型 ")])),_:1})]),_:1}),t(r,{label:"轮询权重",prop:"weight"},{default:o(()=>[t(m,{modelValue:s.weight,"onUpdate:modelValue":l[11]||(l[11]=e=>s.weight=e),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！"},null,8,["modelValue"])]),_:1}),t(r,{label:"模型最大Token",prop:"maxModelTokens"},{default:o(()=>[t(m,{modelValue:s.maxModelTokens,"onUpdate:modelValue":l[12]||(l[12]=e=>s.maxModelTokens=e),modelModifiers:{number:!0},placeholder:"请填写模型最大Token、不填写默认使用默认！"},null,8,["modelValue"])]),_:1}),t(r,{label:"最大回复Token",prop:"maxResponseTokens"},{default:o(()=>[t(m,{modelValue:s.maxResponseTokens,"onUpdate:modelValue":l[13]||(l[13]=e=>s.maxResponseTokens=e),modelModifiers:{number:!0},placeholder:"请填写最大回复Token、不填写使用默认！"},null,8,["modelValue"])]),_:1}),t(r,{label:"指定代理",prop:"openaiProxyUrl"},{default:o(()=>[t(m,{modelValue:s.openaiProxyUrl,"onUpdate:modelValue":l[14]||(l[14]=e=>s.openaiProxyUrl=e),modelModifiers:{number:!0},placeholder:"请填写key的指定代理、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1}),t(r,{label:"超时时间",prop:"openaiTimeoutMs"},{default:o(()=>[t(m,{modelValue:s.openaiTimeoutMs,"onUpdate:modelValue":l[15]||(l[15]=e=>s.openaiTimeoutMs=e),modelModifiers:{number:!0},placeholder:"请填写key的超时时间单位（ms）、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[B,i(Y)]])]),_:1},8,["modelValue"]),t(J,{modelValue:i(v),"onUpdate:modelValue":l[23]||(l[23]=e=>X(v)?v.value=e:null),"close-on-click-modal":!1,title:le.value,width:"670",onClose:l[24]||(l[24]=e=>h(i(P)))},{footer:o(()=>[N("span",Ce,[t(u,{onClick:l[21]||(l[21]=e=>v.value=!1)},{default:o(()=>l[33]||(l[33]=[n("取消")])),_:1}),t(u,{type:"primary",onClick:l[22]||(l[22]=e=>se(i(I)))},{default:o(()=>[n(f(Q.value),1)]),_:1})])]),default:o(()=>[O((g(),V(U,{ref_key:"formBlukRef",ref:I,"label-position":"right","label-width":"120px",model:s},{default:o(()=>[t(r,{label:"key卡账号列表",prop:"keyList"},{default:o(()=>[t(m,{modelValue:D.keyList,"onUpdate:modelValue":l[20]||(l[20]=e=>D.keyList=e),type:"textarea",rows:8,placeholder:"请粘贴您的key秘钥列表、一行一个、批量添加的情况下我们将默认为您使用gpt-3.5-turbo模型、并且不会检测秘钥的有效期、请您自行校验！"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[B,i(Y)]])]),_:1},8,["modelValue","title"])])}}});typeof Z=="function"&&Z(Me);export{Me as default};
