
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as J}from"./index-ffb2bbfd.js";import{d as X,r as d,O as k,z as x,q as Z,h as n,P as ee,o as v,c as I,e as l,f as a,k as m,w as te,G as U,b as o,t as V,a as le,Q as ae,R as oe,H as se,j as ne,l as re,N as ue,V as ie,E as M,n as P}from"./index-6b0fe787.js";import{A as C}from"./chatgpt-97f50f25.js";import{c as de,Q as pe}from"./index-39bad72e.js";import{u as ce}from"./utcformatTime-e76e5157.js";const me={class:"flex justify-end mr-5"},fe=X({__name:"whiteList",setup(_e){const g=d(),u=d(0),y=d(!1),p=d(!1),z=d([]),T=d(0),f=k({page:1,size:10}),q=x(()=>u.value?"更新用户":"新增用户"),D=x(()=>u.value?"确认更新":"确认新增"),A=d([]),r=k({userId:"",status:1,count:10}),L=k({userId:[{required:!0,message:"请选择白名单用户",trigger:"change"}],status:[{required:!0,message:"请选择当前用户状态",trigger:"change"}],count:[{required:!0,message:"请填写限制使用次数",trigger:"blur"}]});async function N(s){const e=await ue.queryAllUser({size:30,username:s});A.value=e.data.rows}async function b(){try{y.value=!0;const s=await C.queryWhiteUserList(f);y.value=!1;const{rows:e,count:_}=s.data;z.value=e,T.value=_}catch{y.value=!1}}function B(s){u.value=0,s==null||s.resetFields()}function Y(s){u.value=s.id;const{userId:e,count:_,status:c}=s;ie(()=>{Object.assign(r,{userId:e,count:_,status:c})}),p.value=!0}function S(s){s==null||s.validate(async e=>{e&&(u.value?(await C.updateWhiteUser({id:u.value,...r}),M.success("修改白名单用户成功")):(await C.addWhiteUser(r),M.success("添加白名单用户成功")),p.value=!1,b())})}return Z(()=>{b()}),(s,e)=>{const _=n("el-alert"),c=n("el-button"),h=J,i=n("el-table-column"),$=n("el-tag"),j=n("el-table"),W=n("el-pagination"),K=n("el-row"),O=n("el-option"),Q=n("el-select"),w=n("el-form-item"),R=n("el-input"),F=n("el-switch"),G=n("el-form"),E=n("el-dialog"),H=ee("loading");return v(),I("div",null,[l(h,null,{default:a(()=>[l(_,{closable:!1,"show-icon":"",title:"KEY池说明",description:"所有key会按key绑定的模型自动划分为卡池3模型与卡池4模型、key余额耗尽将会自动锁定、每张key支持单独绑定模型与代理、已经上下文长度设置、如果不设置默认以全局配置为准！",type:"success"}),l(c,{class:"mt-5",type:"primary",onClick:e[0]||(e[0]=t=>p.value=!0)},{default:a(()=>e[11]||(e[11]=[m(" 添加白名单用户[添加用户可以使用GPT4模型] ")])),_:1})]),_:1}),l(h,null,{default:a(()=>[te((v(),U(j,{border:"",data:z.value,style:{width:"100%"},size:"large"},{default:a(()=>[l(i,{prop:"username",label:"用户昵称"}),l(i,{prop:"email",label:"用户邮箱"}),l(i,{prop:"useCount",label:"调用次数"}),l(i,{prop:"count",label:"剩余额度"}),l(i,{prop:"status",align:"center",label:"启用状态"},{default:a(t=>[l($,{type:o(de)[t.row.status]},{default:a(()=>[m(V(o(pe)[t.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"createdAt",align:"center",label:"添加时间"},{default:a(t=>[m(V(o(ce)(t.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),l(i,{label:"操作"},{default:a(t=>[l(c,{link:"",type:"primary",size:"small",onClick:ve=>Y(t.row)},{default:a(()=>e[12]||(e[12]=[m(" 变更 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,y.value]]),l(K,{class:"flex justify-end mt-5"},{default:a(()=>[l(W,{"current-page":o(f).page,"onUpdate:currentPage":e[1]||(e[1]=t=>o(f).page=t),"page-size":o(f).size,"onUpdate:pageSize":e[2]||(e[2]=t=>o(f).size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:T.value,onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(E,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=t=>p.value=t),"close-on-click-modal":!1,title:o(q),width:"400",onClose:e[10]||(e[10]=t=>B(g.value))},{footer:a(()=>[le("span",me,[l(c,{onClick:e[7]||(e[7]=t=>p.value=!1)},{default:a(()=>e[13]||(e[13]=[m("取消")])),_:1}),l(c,{type:"primary",onClick:e[8]||(e[8]=t=>S(g.value))},{default:a(()=>[m(V(o(D)),1)]),_:1})])]),default:a(()=>[l(G,{ref_key:"formPackageRef",ref:g,"label-position":"right","label-width":"100px",model:o(r),rules:o(L)},{default:a(()=>[u.value?se("",!0):(v(),U(w,{key:0,label:"用户昵称",prop:"userId"},{default:a(()=>[l(Q,{modelValue:o(r).userId,"onUpdate:modelValue":e[3]||(e[3]=t=>o(r).userId=t),filterable:"",clearable:"",style:{width:"100%"},remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":N},{default:a(()=>[(v(!0),I(ae,null,oe(A.value,t=>(v(),U(O,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),l(w,{label:"限制次数",prop:"count"},{default:a(()=>[l(R,{modelValue:o(r).count,"onUpdate:modelValue":e[4]||(e[4]=t=>o(r).count=t),modelModifiers:{number:!0},placeholder:"请填写限制用户的访问次数！",onKeydown:e[5]||(e[5]=ne(re(t=>S(g.value),["prevent"]),["enter"]))},null,8,["modelValue"])]),_:1}),l(w,{label:"启用状态",prop:"status"},{default:a(()=>[l(F,{modelValue:o(r).status,"onUpdate:modelValue":e[6]||(e[6]=t=>o(r).status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof P=="function"&&P(fe);export{fe as default};
