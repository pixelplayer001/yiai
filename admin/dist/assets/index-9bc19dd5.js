
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as ye}from"./index-ffb2bbfd.js";import{A as E}from"./models-2aeabe1c.js";import{u as fe}from"./utcformatTime-e76e5157.js";import{f as ce,g as ke,h as W,M as ge,b as be,i as we,j as _e}from"./index-39bad72e.js";import{d as Te,r as _,O as j,z as A,q as ve,h as d,P as Ve,o as u,c as M,e,f as a,Q as R,R as S,b as m,k as i,a as g,w as G,G as c,t as k,H as I,S as xe,E as H,V as Ue,n as X}from"./index-6b0fe787.js";const De={style:{float:"right"}},Ne={class:"flex justify-end mr-5"},Me=Te({__name:"index",setup(Re){_();const Y=_(),B=_(0),U=_(!1),L=_(!1),Z=_(!1);_(!1);const y=j({keyType:"",model:"",status:null,page:1,size:10}),P=_(),D=_(0),o=j({keyType:1,modelName:"",status:!0,model:"",temperature:"",deduct:1,deductType:1,order:100,maxTokens:4096,maxResponseTokens:2048,maxRounds:12,isDallE3:!1,isUseTool:!1}),ee=j({keyType:[{required:!0,message:"请填写您的调用模型类型",trigger:"blur"}],modelName:[{required:!0,message:"请填写您的模型名称",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],temperature:[{required:!0,message:"请设置模型默认温度",trigger:"change"}],maxTokens:[{required:!0,message:"请填写模型允许的最大token数",trigger:"blur"}],maxResponseTokens:[{required:!0,message:"请填写允许用户使用的最大回复token数",trigger:"blur"}],deductType:[{required:!0,message:"请选择当前模型扣费类型",trigger:"change"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],maxRounds:[{required:!0,message:"请填写允许用户选择的最大上下文轮次",trigger:"blur"}]});function le(n){D.value=0,n==null||n.resetFields()}const te=A(()=>ce[o.keyType]),ae=A(()=>D.value?"更新秘钥":"新增秘钥"),oe=A(()=>ke[o.keyType]),re=A(()=>D.value?"确认更新":"确认新增"),F=_([]);async function N(){try{L.value=!0;const n=await E.queryModels(y);L.value=!1;const{rows:t,count:p}=n.data;B.value=p,F.value=t}catch{L.value=!1}}async function ne(n){const{id:t}=n;await E.delModels({id:t}),H({type:"success",message:"操作完成！"}),N()}function de(n){D.value=n.id;const{keyType:t,modelName:p,key:T,secret:r,status:b,model:q,keyWeight:f,maxTokens:O,maxResponseTokens:C,proxyUrl:z,timeout:v,deductType:s,deduct:h,maxRounds:K,isDraw:$}=n;Ue(()=>{Object.assign(o,{keyType:t,modelName:p,key:T,secret:r,status:b,model:q,keyWeight:f,maxTokens:O,maxResponseTokens:C,proxyUrl:z,timeout:v,deductType:s,deduct:h,maxRounds:K,isDraw:$})}),U.value=!0}function ue(n){n==null||n.resetFields(),N()}async function se(n){n==null||n.validate(async t=>{if(t){const p=JSON.parse(JSON.stringify(o));if(delete p.id,D.value&&(p.id=D.value),Number(o.keyType)===1){const r=JSON.parse(JSON.stringify(o.key)).split(`
`);p.key=r}await E.setModels(p),H({type:"success",message:"操作成功！"}),D.value=0,U.value=!1,N()}})}return ve(()=>{N()}),(n,t)=>{const p=d("el-option"),T=d("el-select"),r=d("el-form-item"),b=d("el-button"),q=d("Plus"),f=d("el-icon"),O=d("el-form"),C=ye,z=d("el-alert"),v=d("el-tag"),s=d("el-table-column"),h=d("el-popconfirm"),K=d("el-table"),$=d("el-pagination"),ie=d("el-row"),J=d("el-switch"),V=d("QuestionFilled"),x=d("el-tooltip"),w=d("el-input"),pe=d("el-dialog"),Q=Ve("loading");return u(),M("div",null,[e(C,null,{default:a(()=>[e(O,{ref_key:"formRef",ref:Y,inline:!0,model:y},{default:a(()=>[e(r,{label:"模型类别",prop:"model"},{default:a(()=>[e(T,{modelValue:y.keyType,"onUpdate:modelValue":t[0]||(t[0]=l=>y.keyType=l),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:a(()=>[(u(!0),M(R,null,S(m(W),l=>(u(),c(p,{key:l,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"模型名称",prop:"model"},{default:a(()=>[e(T,{modelValue:y.model,"onUpdate:modelValue":t[1]||(t[1]=l=>y.model=l),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:a(()=>[(u(!0),M(R,null,S(m(ge),l=>(u(),c(p,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"启用状态",prop:"status"},{default:a(()=>[e(T,{modelValue:y.status,"onUpdate:modelValue":t[2]||(t[2]=l=>y.status=l),placeholder:"请选择模型启用状态",clearable:""},{default:a(()=>[(u(!0),M(R,null,S(m(be),l=>(u(),c(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:a(()=>[e(b,{type:"primary",onClick:N},{default:a(()=>t[26]||(t[26]=[i(" 查询 ")])),_:1}),e(b,{onClick:t[3]||(t[3]=l=>ue(m(Y)))},{default:a(()=>t[27]||(t[27]=[i(" 重置 ")])),_:1})]),_:1}),g("span",De,[e(b,{type:"success",onClick:t[4]||(t[4]=l=>U.value=!0)},{default:a(()=>[t[28]||(t[28]=i(" 添加模型 ")),e(f,{class:"ml-3"},{default:a(()=>[e(q)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),e(C,null,{default:a(()=>[e(z,{"show-icon":"",title:"模型说明",description:"所有开启的模型将会直接应用到客户端供用户选择使用、请注意在添加模型时候如果您需要使用DALL-E绘画你需要特别指定模型为绘画时候、同时例如思维导图、应用、翻译、联想等功能【目前绑定为OPENAI类目】请在添加模型的时候勾选上设置为工具Key、届时调用此类功能将使用我们指定的模型！",type:"success"})]),_:1}),e(C,{style:{width:"100%"}},{default:a(()=>[G((u(),c(K,{border:"",data:m(F),style:{width:"100%"},size:"large"},{default:a(()=>[e(s,{prop:"keyType",label:"模型类型",width:"120"},{default:a(l=>[e(v,{type:"success"},{default:a(()=>[i(k(m(we)[l.row.keyType]),1)]),_:2},1024)]),_:1}),e(s,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:a(l=>[e(v,{type:l.row.status?"success":"danger"},{default:a(()=>[i(k(l.row.status?"使用中":"已暂停"),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"modelName",label:"自定义模型名称"}),e(s,{prop:"model",align:"center",label:"指定模型"},{default:a(l=>[e(v,{type:l.row.model.includes("gpt-4")?"success":""},{default:a(()=>[i(k(l.row.model),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"isDraw",align:"center",label:"绑定DALL-E",width:"120"},{default:a(l=>[e(v,{type:l.row.isDraw?"success":"danger"},{default:a(()=>[i(k(l.row.isDraw?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"isDraw",align:"center",label:"绑定通用功能",width:"120"},{default:a(l=>[e(v,{type:l.row.isDraw?"success":"danger"},{default:a(()=>[i(k(l.row.isUseTool?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"deductType",align:"center",label:"扣费类型",width:"120"},{default:a(l=>[e(v,{type:l.row.deductType===1?"":"error"},{default:a(()=>[i(k(l.row.deductType===1?"普通余额":"高级余额"),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"deduct",align:"center",label:"单次扣除",width:"100"},{default:a(l=>[e(v,{type:l.row.deductType===1?"success":"warning"},{default:a(()=>[i(k(`${l.row.deduct} 积分`),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"temperature",align:"center",label:"默认温度",width:"100"},{default:a(l=>[i(k(l.row.temperature||"---"),1)]),_:1}),e(s,{prop:"order",align:"center",label:"排序ID",width:"90"}),e(s,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),e(s,{prop:"useToken",align:"center",label:"调用Token",width:"120"}),e(s,{prop:"maxResponseTokens",align:"center",label:"限制最大回复",width:"160"},{default:a(l=>[e(b,{type:"info",text:""},{default:a(()=>[i(k(l.row.maxResponseTokens||"-"),1)]),_:2},1024)]),_:1}),e(s,{prop:"maxRounds",align:"center",label:"限制上下文轮次",width:"160"},{default:a(l=>[i(k(l.row.maxRounds||"-"),1)]),_:1}),e(s,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:a(l=>[i(k(m(fe)(l.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),e(s,{fixed:"right",label:"操作",width:"200"},{default:a(l=>[e(b,{link:"",type:"primary",size:"small",onClick:me=>de(l.row)},{default:a(()=>t[29]||(t[29]=[i(" 变更 ")])),_:2},1032,["onClick"]),e(h,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:me=>ne(l.row)},{reference:a(()=>[e(b,{link:"",type:"danger",size:"small"},{default:a(()=>t[30]||(t[30]=[i(" 删除秘钥 ")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Q,m(L)]]),e(ie,{class:"flex justify-end mt-5"},{default:a(()=>[e($,{"current-page":y.page,"onUpdate:currentPage":t[5]||(t[5]=l=>y.page=l),"page-size":y.size,"onUpdate:pageSize":t[6]||(t[6]=l=>y.size=l),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:m(B),onSizeChange:N,onCurrentChange:N},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(pe,{modelValue:m(U),"onUpdate:modelValue":t[24]||(t[24]=l=>xe(U)?U.value=l:null),"close-on-click-modal":!1,title:ae.value,width:"770",onClose:t[25]||(t[25]=l=>le(m(P)))},{footer:a(()=>[g("span",Ne,[e(b,{onClick:t[22]||(t[22]=l=>U.value=!1)},{default:a(()=>t[40]||(t[40]=[i("取消")])),_:1}),e(b,{type:"primary",onClick:t[23]||(t[23]=l=>se(m(P)))},{default:a(()=>[i(k(re.value),1)]),_:1})])]),default:a(()=>[G((u(),c(O,{ref_key:"formPackageRef",ref:P,"label-position":"right","label-width":"120px",model:o,rules:ee},{default:a(()=>[e(r,{label:"模型类型选择",prop:"keyType"},{default:a(()=>[e(T,{modelValue:o.keyType,"onUpdate:modelValue":t[7]||(t[7]=l=>o.keyType=l),placeholder:"请选择模型类型",style:{width:"100%"}},{default:a(()=>[(u(!0),M(R,null,S(m(W),l=>(u(),c(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"模型启用状态",prop:"status"},{default:a(()=>[e(J,{modelValue:o.status,"onUpdate:modelValue":t[8]||(t[8]=l=>o.status=l)},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[31]||(t[31]=[g("div",{style:{width:"250px"}}," 账号启用状态、一旦锁定当前key将停止工作！ ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1}),e(r,{label:"模型中文名称",prop:"modelName"},{default:a(()=>[e(w,{modelValue:o.modelName,"onUpdate:modelValue":t[9]||(t[9]=l=>o.modelName=l),placeholder:"请填写模型中文名称（用户选择的）"},null,8,["modelValue"])]),_:1}),e(r,{label:oe.value,prop:"key"},{default:a(()=>[e(w,{modelValue:o.key,"onUpdate:modelValue":t[10]||(t[10]=l=>o.key=l),type:Number(o.keyType)===1?"textarea":"text",rows:5,placeholder:"请填写模型Key|clientId|AppId",style:{width:"95%"}},null,8,["modelValue","type"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[32]||(t[32]=[g("div",{style:{width:"250px"}}," 不同模型的设置不同、例如openai仅设置key即可、如果是百度大模型、则填写clientId以及同时需要填写secret。对于OPENAI模型、我们支持批量导入、如果您需要批量导入key、则一行一个key即可、多个key使用换行隔离、其余配置将共享、多个key可以重复选用默认模型。 ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1},8,["label"]),[2].includes(Number(o.keyType))?(u(),c(r,{key:0,label:"SecretKey",prop:"secret"},{default:a(()=>[e(w,{modelValue:o.secret,"onUpdate:modelValue":t[11]||(t[11]=l=>o.secret=l),placeholder:"请填写模型调用所需的Secret[部分类型模型需要]",style:{width:"80%"}},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[33]||(t[33]=[g("div",{style:{width:"250px"}}," 不同账号填写的内容不同、但是都代表的是Secret秘钥 ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1})):I("",!0),e(r,{label:"账号关联模型",prop:"model"},{default:a(()=>[e(T,{modelValue:o.model,"onUpdate:modelValue":t[12]||(t[12]=l=>o.model=l),filterable:"",clearable:"",placeholder:"请选用或填写绑定的模型","allow-create":Number(o.keyType)===1,style:{width:"80%"}},{default:a(()=>[(u(!0),M(R,null,S(te.value,l=>(u(),c(p,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[34]||(t[34]=[g("div",{style:{width:"250px"}}," 给定了部分可选的模型列表、你可以可以手动填写您需要调用的模型、请确保填写的模型是当前key支持的类型、否则可能会在调用中出现不可预知错误！ ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1}),e(r,{label:"模型扣费类型",prop:"deductType"},{default:a(()=>[e(T,{modelValue:o.deductType,"onUpdate:modelValue":t[13]||(t[13]=l=>o.deductType=l),filterable:"","allow-create":"",clearable:"",placeholder:"请选用模型扣费类型",style:{width:"80%"}},{default:a(()=>[(u(!0),M(R,null,S(m(_e),l=>(u(),c(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[35]||(t[35]=[g("div",{style:{width:"250px"}}," 设置当前key的扣费类型、扣除普通余额或是高级余额。 ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1}),e(r,{label:"单次扣除金额",prop:"deduct"},{default:a(()=>[e(w,{modelValue:o.deduct,"onUpdate:modelValue":t[14]||(t[14]=l=>o.deduct=l),modelModifiers:{number:!0},placeholder:"请填写单次调用此key的扣费金额！",style:{width:"80%"}},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[36]||(t[36]=[g("div",{style:{width:"250px"}}," 设置当前key的单次调用扣除余额、建议同模型或名称key设置相同的金额、避免扣费发生异常！ ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1}),e(r,{label:"上下文限制",prop:"maxRounds"},{default:a(()=>[e(w,{modelValue:o.maxRounds,"onUpdate:modelValue":t[15]||(t[15]=l=>o.maxRounds=l),modelModifiers:{number:!0},placeholder:"请填写允许用户选择的最高上下文轮次！",style:{width:"80%"}},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[37]||(t[37]=[g("div",{style:{width:"250px"}}," 填写此配置可以限制用户在选择模型时候的高级配置中的最大上下文轮次、可以通过限制此数量减少token的损耗、减低上下文的损耗量、 如果设置了模型的最大token和返回量、那么两个限制会同时生效！ ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1}),e(r,{label:"调用轮询权重",prop:"keyWeight"},{default:a(()=>[e(w,{modelValue:o.keyWeight,"onUpdate:modelValue":t[16]||(t[16]=l=>o.keyWeight=l),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！",style:{width:"80%"}},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[38]||(t[38]=[g("div",{style:{width:"250px"}}," 当前轮询是根据模型下的列表按顺序调用、如果权重为2则表示轮到此key的时候会调用两次之后再轮询下一个key 保证每个key的调用顺序以及限制每次调用的准确次数 ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1}),e(r,{label:"模型最大Token",prop:"maxTokens"},{default:a(()=>[e(w,{modelValue:o.maxTokens,"onUpdate:modelValue":t[17]||(t[17]=l=>o.maxTokens=l),modelModifiers:{number:!0},placeholder:"请填写模型最大Token、不填写默认使用默认！"},null,8,["modelValue"])]),_:1}),e(r,{label:"最大回复Token",prop:"maxResponseTokens"},{default:a(()=>[e(w,{modelValue:o.maxResponseTokens,"onUpdate:modelValue":t[18]||(t[18]=l=>o.maxResponseTokens=l),modelModifiers:{number:!0},placeholder:"请填写最大回复Token、不填写使用默认！"},null,8,["modelValue"])]),_:1}),[1].includes(Number(o.keyType))?(u(),c(r,{key:1,label:"调用超时时间",prop:"timeout"},{default:a(()=>[e(w,{modelValue:o.timeout,"onUpdate:modelValue":t[19]||(t[19]=l=>o.timeout=l),modelModifiers:{number:!0},placeholder:"请填写key的超时时间单位（秒）！"},null,8,["modelValue"])]),_:1})):I("",!0),[1].includes(Number(o.keyType))?(u(),c(r,{key:2,label:"设为特殊key",prop:"isDraw"},{default:a(()=>[e(J,{modelValue:o.isDraw,"onUpdate:modelValue":t[20]||(t[20]=l=>o.isDraw=l)},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:a(()=>t[39]||(t[39]=[g("div",{style:{width:"250px"}}," 基础绘画来自于OPENAI的DALL-E模型、所以需要为官方的apiKey、请确定至少设置一张key为基础绘画key即可使用绘画功能！同时当前版本的mind思维导图和mj联想绘图等功能都会走当前设置的key，会后后续版本解除此限制！ ",-1)])),default:a(()=>[e(f,{class:"ml-3 cursor-pointer"},{default:a(()=>[e(V)]),_:1})]),_:1})]),_:1})):I("",!0),[1].includes(Number(o.keyType))?(u(),c(r,{key:3,label:"指定代理地址",prop:"proxyUrl"},{default:a(()=>[e(w,{modelValue:o.proxyUrl,"onUpdate:modelValue":t[21]||(t[21]=l=>o.proxyUrl=l),modelModifiers:{number:!0},placeholder:"如需使用代理请填写、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1})):I("",!0)]),_:1},8,["model","rules"])),[[Q,m(Z)]])]),_:1},8,["modelValue","title"])])}}});typeof X=="function"&&X(Me);export{Me as default};
