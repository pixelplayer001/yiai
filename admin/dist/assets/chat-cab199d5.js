
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as Y}from"./index-ffb2bbfd.js";import{d as j,r as u,O as K,q as F,h as l,P as H,o as _,c as C,e as t,f as n,Q as O,R as P,b as i,j as G,l as Q,k as d,w as $,G as T,t as c,a as A,N as J,n as x}from"./index-6b0fe787.js";import{m as g}from"./marked.esm-76161808.js";import{A as W}from"./chat-d63f1410.js";import{u as X}from"./utcformatTime-e76e5157.js";const Z={class:"answer"},E=["innerHTML"],ee=j({__name:"chat",setup(te){const V=new g.Renderer;g.setOptions({renderer:V,gfm:!0,pedantic:!1,sanitize:!1});const m=u(!1),v=u([]),b=u(),h=u(0),a=K({userId:"",prompt:"",page:1,size:10}),y=u([]);async function p(){m.value=!0;try{const r=await W.queryChatAll(a);m.value=!1;const{rows:o,count:f}=r.data;h.value=f,y.value=o}catch{m.value=!1}}async function U(r){const o=await J.queryAllUser({size:30,username:r});v.value=o.data.rows}function D(r){r==null||r.resetFields(),p()}return F(()=>{p()}),(r,o)=>{const f=l("el-option"),I=l("el-select"),w=l("el-form-item"),M=l("el-input"),k=l("el-button"),L=l("el-form"),z=Y,s=l("el-table-column"),R=l("el-popover"),S=l("el-table"),q=l("el-pagination"),B=l("el-row"),N=H("loading");return _(),C("div",null,[t(z,null,{default:n(()=>[t(L,{ref_key:"formRef",ref:b,inline:!0,model:a},{default:n(()=>[t(w,{label:"用户名称",prop:"userId"},{default:n(()=>[t(I,{modelValue:a.userId,"onUpdate:modelValue":o[0]||(o[0]=e=>a.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":U},{default:n(()=>[(_(!0),C(O,null,P(i(v),e=>(_(),T(f,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"用户询问的问题",prop:"prompt"},{default:n(()=>[t(M,{modelValue:a.prompt,"onUpdate:modelValue":o[1]||(o[1]=e=>a.prompt=e),placeholder:"提问问题[模糊搜索]",onKeydown:G(Q(p,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),t(w,null,{default:n(()=>[t(k,{type:"primary",onClick:p},{default:n(()=>o[5]||(o[5]=[d(" 查询 ")])),_:1}),t(k,{onClick:o[2]||(o[2]=e=>D(i(b)))},{default:n(()=>o[6]||(o[6]=[d(" 重置 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{style:{width:"100%"}},{default:n(()=>[$((_(),T(S,{border:"",data:i(y),style:{width:"100%"},size:"large","tooltip-options":{}},{default:n(()=>[t(s,{fixed:"",prop:"username",label:"用户名称",width:"150"}),t(s,{prop:"createdAt",label:"角色",width:"80"},{default:n(e=>[d(c(e.row.role==="user"?"用户":"电脑"),1)]),_:1}),t(s,{prop:"email",label:"用户邮箱",width:"200"}),t(s,{prop:"answer",label:"用户询问/AI回复"},{default:n(e=>[t(R,{placement:"top",width:400,trigger:"click"},{reference:n(()=>[A("div",Z,c(e.row.role==="user"?e.row.prompt:e.row.answer),1)]),default:n(()=>[A("div",{class:"answer_container",innerHTML:i(g)(e.row.role==="user"?e.row.prompt:e.row.answer||"")},null,8,E)]),_:2},1024)]),_:1}),t(s,{prop:"completionTokens",label:"提问/回答Token",width:"140",align:"center"},{default:n(e=>[d(c(e.row.role==="user"?e.row.promptTokens:e.row.completionTokens),1)]),_:1}),t(s,{prop:"totalTokens",label:"总计Toekn",width:"110",align:"center"}),t(s,{prop:"model",label:"模型",width:"200"}),t(s,{prop:"createdAt",label:"提问时间",width:"200"},{default:n(e=>[d(c(i(X)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1})]),_:1},8,["data"])),[[N,i(m)]]),t(B,{class:"flex justify-end mt-5"},{default:n(()=>[t(q,{"current-page":a.page,"onUpdate:currentPage":o[3]||(o[3]=e=>a.page=e),"page-size":a.size,"onUpdate:pageSize":o[4]||(o[4]=e=>a.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:i(h),onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])]),_:1})]),_:1})])}}});typeof x=="function"&&x(ee);export{ee as default};
