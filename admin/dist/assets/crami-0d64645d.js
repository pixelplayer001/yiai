
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as ye}from"./index-ffb2bbfd.js";import{A as M}from"./package-ea738e3e.js";import{d as _e,r as c,O as S,z as Ce,q as ve,h as u,P as we,o as s,c as v,e as t,f as a,Q as h,R as q,b as n,k as d,a as A,G as g,H as k,w as ke,t as z,S as $,N as Ve,E as j,n as J}from"./index-6b0fe787.js";import{u as Ue}from"./utcformatTime-e76e5157.js";import{C as xe}from"./index-39bad72e.js";const Me={style:{float:"right"}},ze={key:1},Ie={class:"dialog-footer"},he={style:{"max-height":"200px",overflow:"scroll"}},qe={class:"dialog-footer"},Ae=_e({__name:"crami",setup(De){const N=c(),L=c(0),w=c(!1),V=c(!1),D=c(),U=c(0),T=c([]),P=c([]),y=c(!1),_=c([]),B=c([]),i=S({packageId:null,count:1,drawMjCount:0,model3Count:0,model4Count:0}),f=S({useId:"",status:"",page:1,size:15}),K=S({packageId:[{required:!0,message:"请选择套餐类型",trigger:"change"}],days:[{required:!0,message:"请填写有效期天数",trigger:"blur"}],count:[{required:!0,message:"请填写想要生成的数量",trigger:"blur"}],drawMjCount:[{required:!0,message:"卡密携带绘画数量",trigger:"blur"}],model3Count:[{required:!0,message:"卡密携带基础模型对话数量",trigger:"blur"}],model4Count:[{required:!0,message:"卡密携带高级模型金额",trigger:"blur"}]}),R=c([]);async function b(){try{y.value=!0;const o=await M.queryAllCrami(f),{rows:e,count:C}=o.data;y.value=!1,L.value=C,R.value=e}catch{y.value=!1}}async function W(o){const e=await Ve.queryAllUser({size:30,username:o});P.value=e.data.rows}async function X(){const o=await M.queryAllPackage({size:100});T.value=o.data.rows}function Z(){X(),w.value=!0}async function E(o){o==null||o.validate(async e=>{e&&(await M.createCrami(i),j({type:"success",message:"生成卡密成功！"}),w.value=!1,b())})}function ee(o){o==null||o.resetFields()}function le(o){o==null||o.resetFields(),b()}async function te(o){await M.delCrami({id:o.id}),j({type:"success",message:"删除卡密成功！"}),b()}async function ae(o){_.value=o}async function oe(){try{y.value=!0,await M.batchDelCrami({ids:_.value.map(o=>o.id)}),y.value=!1,j({type:"success",message:"删除卡密成功！"}),b()}catch{y.value=!1}}function ne(){V.value=!0;const o=_.value.map(e=>`${e.code}<---->${e.packageName||"自定义套餐"}`);B.value=o}function re(o){return o.join(`
`)}function ue(o,e){const C=re(o),x=new Blob([C],{type:"text/plain"}),m=URL.createObjectURL(x),r=document.createElement("a");r.href=m,r.download=`${e}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(m),0)}function se(){const o=_.value.map(e=>`${e.code}<---->${e.packageName||"自定义套餐"}`);ue(o,"卡密信息")}const de=Ce(()=>R.value.some(o=>o.email));return ve(()=>{b()}),(o,e)=>{const C=u("el-option"),x=u("el-select"),m=u("el-form-item"),r=u("el-button"),ie=u("Plus"),me=u("el-icon"),O=u("el-form"),F=ye,p=u("el-table-column"),Y=u("el-tag"),pe=u("el-popconfirm"),ce=u("el-table"),fe=u("el-pagination"),G=u("el-row"),ge=u("el-switch"),I=u("el-input"),H=u("el-dialog"),be=we("loading");return s(),v("div",null,[t(F,null,{default:a(()=>[t(O,{ref_key:"formRef",ref:N,inline:!0,model:f},{default:a(()=>[t(m,{label:"用户名称",prop:"useId"},{default:a(()=>[t(x,{modelValue:f.useId,"onUpdate:modelValue":e[0]||(e[0]=l=>f.useId=l),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":W},{default:a(()=>[(s(!0),v(h,null,q(n(P),l=>(s(),g(C,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"卡密状态",prop:"status"},{default:a(()=>[t(x,{modelValue:f.status,"onUpdate:modelValue":e[1]||(e[1]=l=>f.status=l),placeholder:"请选择卡密状态",clearable:""},{default:a(()=>[(s(!0),v(h,null,q(n(xe),l=>(s(),g(C,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(r,{type:"primary",onClick:b},{default:a(()=>e[17]||(e[17]=[d(" 查询 ")])),_:1}),t(r,{onClick:e[2]||(e[2]=l=>le(n(N)))},{default:a(()=>e[18]||(e[18]=[d(" 重置 ")])),_:1})]),_:1}),A("div",Me,[n(_).length?(s(),g(r,{key:0,type:"danger",onClick:ne},{default:a(()=>e[19]||(e[19]=[d(" 显示选中卡密 ")])),_:1})):k("",!0),n(_).length?(s(),g(r,{key:1,type:"danger",onClick:oe},{default:a(()=>e[20]||(e[20]=[d(" 批量删除卡密 ")])),_:1})):k("",!0),n(_).length?(s(),g(r,{key:2,type:"primary",onClick:se},{default:a(()=>e[21]||(e[21]=[d(" 批量导出卡密 ")])),_:1})):k("",!0),t(r,{type:"success",onClick:Z},{default:a(()=>[e[22]||(e[22]=d(" 批量生成卡密 ")),t(me,{class:"ml-3"},{default:a(()=>[t(ie)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),t(F,{style:{width:"100%"}},{default:a(()=>[ke((s(),g(ce,{border:"",data:n(R),style:{width:"100%"},size:"large",onSelectionChange:ae},{default:a(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"code",label:"卡密账号",width:"180"}),t(p,{prop:"packageName",label:"套餐类型",width:"180"},{default:a(l=>[t(Y,{type:l.row.packageName?"success":"danger"},{default:a(()=>[d(z(l.row.packageName||"自定义卡密"),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"code",label:"卡密状态",width:"180"},{default:a(l=>[t(Y,{type:l.row.status?"danger":"success"},{default:a(()=>[d(z(l.row.status?"已使用":"未使用"),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"useId",label:"使用人ID",width:"90"}),n(de)?(s(),g(p,{key:0,prop:"email",label:"使用人邮箱",width:"180"})):k("",!0),t(p,{prop:"model3Count",label:"基础模型额度"}),t(p,{prop:"model4Count",label:"高级模型额度"}),t(p,{prop:"drawMjCount",label:"绘画模型额度"}),t(p,{prop:"days",label:"有效天数"},{default:a(l=>[d(z(l.row.days>0?`${l.row.days}天`:"永久"),1)]),_:1}),t(p,{prop:"createdAt",label:"注册时间",width:"200"},{default:a(l=>[d(z(n(Ue)(l.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(p,{label:"操作"},{default:a(l=>[t(pe,{title:"确认删除此卡密么?",width:"200","icon-color":"red",onConfirm:Q=>te(l.row)},{reference:a(()=>[t(r,{link:"",type:"danger",size:"small"},{default:a(()=>e[23]||(e[23]=[d(" 删除卡密 ")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[be,n(y)]]),t(G,{class:"flex justify-end mt-5"},{default:a(()=>[t(fe,{"current-page":f.page,"onUpdate:currentPage":e[3]||(e[3]=l=>f.page=l),"page-size":f.size,"onUpdate:pageSize":e[4]||(e[4]=l=>f.size=l),class:"mr-5","page-sizes":[15,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:n(L),onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(H,{modelValue:n(w),"onUpdate:modelValue":e[13]||(e[13]=l=>$(w)?w.value=l:null),title:"生成卡密",width:"450",onClose:e[14]||(e[14]=l=>ee(n(D)))},{footer:a(()=>[A("span",Ie,[t(r,{onClick:e[11]||(e[11]=l=>w.value=!1)},{default:a(()=>e[24]||(e[24]=[d("放弃生成")])),_:1}),t(r,{type:"primary",onClick:e[12]||(e[12]=l=>E(n(D)))},{default:a(()=>e[25]||(e[25]=[d(" 确定生成 ")])),_:1})])]),default:a(()=>[t(O,{ref_key:"formCramiRef",ref:D,"label-position":"right","label-width":"100px",model:i,rules:K},{default:a(()=>[t(G,null,{default:a(()=>[t(m,{label:"是否生成自定义卡密","label-width":"170px"},{default:a(()=>[t(ge,{modelValue:n(U),"onUpdate:modelValue":e[5]||(e[5]=l=>$(U)?U.value=l:null),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1}),n(U)?k("",!0):(s(),g(m,{key:0,label:"套餐类型",prop:"packageId"},{default:a(()=>[t(x,{modelValue:i.packageId,"onUpdate:modelValue":e[6]||(e[6]=l=>i.packageId=l),modelModifiers:{number:!0},placeholder:"请选择套餐类型",clearable:"",style:{width:"100%"}},{default:a(()=>[(s(!0),v(h,null,q(n(T),l=>(s(),g(C,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),n(U)?(s(),v("div",ze,[t(m,{label:"基础模型额度",prop:"model3Count"},{default:a(()=>[t(I,{modelValue:i.model3Count,"onUpdate:modelValue":e[7]||(e[7]=l=>i.model3Count=l),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带基础模型额度"},null,8,["modelValue"])]),_:1}),t(m,{label:"高级模型额度",prop:"model4Count"},{default:a(()=>[t(I,{modelValue:i.model4Count,"onUpdate:modelValue":e[8]||(e[8]=l=>i.model4Count=l),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带高级模型额度"},null,8,["modelValue"])]),_:1}),t(m,{label:"绘画模型额度",prop:"drawMjCount"},{default:a(()=>[t(I,{modelValue:i.drawMjCount,"onUpdate:modelValue":e[9]||(e[9]=l=>i.drawMjCount=l),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带绘画积分额度"},null,8,["modelValue"])]),_:1})])):k("",!0),t(m,{label:"生成数量",prop:"count"},{default:a(()=>[t(I,{modelValue:i.count,"onUpdate:modelValue":e[10]||(e[10]=l=>i.count=l),modelModifiers:{number:!0},type:"number",placeholder:"本次生成的张数"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(H,{modelValue:n(V),"onUpdate:modelValue":e[16]||(e[16]=l=>$(V)?V.value=l:null),title:"卡密列表"},{footer:a(()=>[A("span",qe,[t(r,{onClick:e[15]||(e[15]=l=>V.value=!1)},{default:a(()=>e[26]||(e[26]=[d("关闭弹窗")])),_:1})])]),default:a(()=>[A("div",he,[(s(!0),v(h,null,q(n(B),(l,Q)=>(s(),v("div",{key:Q},z(l),1))),128))])]),_:1},8,["modelValue"])])}}});typeof J=="function"&&J(Ae);export{Ae as default};
