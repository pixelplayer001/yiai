
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as W}from"./index-ffb2bbfd.js";import{m as I}from"./marked.esm-76161808.js";import{A as K}from"./badWords-0a8698d1.js";import{d as X,r as c,O as P,q as Z,h as o,P as ee,o as _,c as h,e as t,f as l,Q as T,R as V,b as s,k as d,w as te,G as C,a as x,t as m,S as le,N as D,E as ae,n as L}from"./index-6b0fe787.js";import{u as ne}from"./utcformatTime-e76e5157.js";import{T as oe,U as se,q as re,r as ue}from"./index-39bad72e.js";const ie=["src"],de={class:"answer"},pe=["innerHTML"],_e=X({__name:"violation",setup(fe){const Y=new I.Renderer;I.setOptions({renderer:Y,gfm:!0,pedantic:!1,sanitize:!1});const b=c(!1),z=c([]),O=c(),A=c(0),u=P({userId:"",typeOriginCn:"",page:1,size:10}),R=c([]),g=c(!1),f=P({status:0,id:0});function q(n){g.value=!0,f.status=n.status,f.id=n.userId}async function B(){(await D.updateUserStatus(f)).success&&ae({type:"success",message:"变更用户状态成功！"}),g.value=!1}async function v(){b.value=!0;try{const n=await K.queryViolation(u);b.value=!1;const{rows:a,count:w}=n.data;A.value=w,R.value=a}catch{b.value=!1}}async function j(n){const a=await D.queryAllUser({size:30,username:n});z.value=a.data.rows}function E(n){n==null||n.resetFields(),v()}return Z(()=>{v()}),(n,a)=>{const w=o("el-option"),U=o("el-select"),y=o("el-form-item"),S=o("el-button"),M=o("el-form"),N=W,r=o("el-table-column"),k=o("el-tag"),F=o("el-popover"),G=o("el-table"),H=o("el-pagination"),J=o("el-row"),$=o("el-dialog"),Q=ee("loading");return _(),h("div",null,[t(N,null,{default:l(()=>[t(M,{ref_key:"formRef",ref:O,inline:!0,model:u},{default:l(()=>[t(y,{label:"用户名称",prop:"userId"},{default:l(()=>[t(U,{modelValue:u.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>u.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":j},{default:l(()=>[(_(!0),h(T,null,V(s(z),e=>(_(),C(w,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"检测平台",prop:"typeOriginCn"},{default:l(()=>[t(U,{modelValue:u.typeOriginCn,"onUpdate:modelValue":a[1]||(a[1]=e=>u.typeOriginCn=e),placeholder:"请选择检测平台",clearable:""},{default:l(()=>[(_(!0),h(T,null,V(s(oe),e=>(_(),C(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:l(()=>[t(S,{type:"primary",onClick:v},{default:l(()=>a[7]||(a[7]=[d(" 查询 ")])),_:1}),t(S,{onClick:a[2]||(a[2]=e=>E(s(O)))},{default:l(()=>a[8]||(a[8]=[d(" 重置 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(N,{style:{width:"100%"}},{default:l(()=>[te((_(),C(G,{border:"",data:s(R),style:{width:"100%"},size:"large","tooltip-options":{}},{default:l(()=>[t(r,{fixed:"",prop:"userInfo.username",label:"用户名称",width:"150"}),t(r,{prop:"userInfo.avatar",label:"头像",width:"120"},{default:l(e=>{var i,p;return[x("img",{src:(p=(i=e.row)==null?void 0:i.userInfo)==null?void 0:p.avatar,style:{height:"50px"}},null,8,ie)]}),_:1}),t(r,{prop:"userInfo.email",label:"邮箱",width:"200"}),t(r,{prop:"status",label:"用户状态",width:"120",align:"center"},{default:l(({row:e})=>[t(k,{type:s(se)[e.userInfo.status]},{default:l(()=>[d(m(s(re)[e.userInfo.status]),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"userInfo.violationCount",label:"累计次数",width:"90",align:"center"}),t(r,{label:"违规类型"},{default:l(e=>[t(k,{type:"danger"},{default:l(()=>{var i,p;return[d(m((i=e.row)!=null&&i.typeCn?JSON.parse((p=e.row)==null?void 0:p.typeCn).join("  |  "):""),1)]}),_:2},1024)]),_:1}),t(r,{label:"违规关键词"},{default:l(e=>{var i,p;return[d(m((i=e.row)!=null&&i.words?JSON.parse((p=e.row)==null?void 0:p.words).join("  |  "):""),1)]}),_:1}),t(r,{prop:"typeOriginCn",label:"违规检测来源",width:"120"},{default:l(e=>[t(k,{type:"success"},{default:l(()=>[d(m(e.row.typeOriginCn),1)]),_:2},1024)]),_:1}),t(r,{prop:"answer",label:"违规内容",width:"200"},{default:l(e=>[t(F,{placement:"top",width:400,trigger:"click"},{reference:l(()=>[x("div",de,m(e.row.content),1)]),default:l(()=>[x("div",{class:"answer_container",innerHTML:s(I)(e.row.content||"")},null,8,pe)]),_:2},1024)]),_:1}),t(r,{prop:"createdAt",label:"违规时间",width:"200"},{default:l(e=>[d(m(s(ne)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(r,{fixed:"right",label:"操作",width:"120",align:"center"},{default:l(e=>[t(S,{link:"",type:"primary",size:"small",onClick:i=>q(e.row)},{default:l(()=>a[9]||(a[9]=[d(" 变更用户状态 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,s(b)]]),t(J,{class:"flex justify-end mt-5"},{default:l(()=>[t(H,{"current-page":u.page,"onUpdate:currentPage":a[3]||(a[3]=e=>u.page=e),"page-size":u.size,"onUpdate:pageSize":a[4]||(a[4]=e=>u.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:s(A),onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t($,{modelValue:s(g),"onUpdate:modelValue":a[6]||(a[6]=e=>le(g)?g.value=e:null),title:"变更用户状态",width:"500px"},{default:l(()=>[t(M,{model:f,inline:!0},{default:l(()=>[t(y,{label:"用户状态","label-width":"90px"},{default:l(()=>[t(U,{modelValue:f.status,"onUpdate:modelValue":a[5]||(a[5]=e=>f.status=e),placeholder:"请选择用户状态",clearable:""},{default:l(()=>[(_(!0),h(T,null,V(s(ue),e=>(_(),C(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:l(()=>[t(S,{type:"primary",onClick:B},{default:l(()=>a[10]||(a[10]=[d(" 确认变更 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});typeof L=="function"&&L(_e);export{_e as default};
