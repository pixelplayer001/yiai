
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as ye}from"./index-ffb2bbfd.js";import{d as be,r as f,O as R,z as Q,q as we,h as r,P as Ae,o as n,c as U,e as t,f as a,Q as S,R as T,b as u,j as Ve,l as ke,k as i,w as Ie,G as g,t as v,a as D,H as P,S as Ce,U as k,V as xe,E as I,n as W}from"./index-6b0fe787.js";import{u as Ue}from"./utcformatTime-e76e5157.js";import{E as De,A as Pe,Q as ze}from"./index-39bad72e.js";const Se={style:{maxWidth:"350px"}},Te={style:{maxHeight:"50px",cursor:"pointer"}},qe={style:{maxWidth:"350px"}},he={style:{maxHeight:"50px",cursor:"pointer"}},$e=["src"],Ne={class:"flex justify-end mr-5"},Le=be({__name:"application",setup(Oe){const j=f(),B=f(0),A=f(!1),z=f(!1),p=R({catId:"",name:"",status:"",role:"",page:1,size:10}),J=f("/api/upload/file"),q=f(),C=f(0),h=f(!1),M=f(0),s=R({catId:"",name:"",preset:"",des:"",coverImg:"",demoData:"",order:100,status:0}),X=R({catId:[{required:!0,message:"请选择App分类",trigger:"change"}],name:[{required:!0,message:"请填写App名称",trigger:"blur"}],preset:[{required:!0,message:"请填写App预设信息",trigger:"blur"}],des:[{required:!0,message:"请填写App描述",trigger:"blur"}],coverImg:[{required:!1,message:"请填写App封面图片地址",trigger:"blur"}],demoData:[{required:!1,message:"请填写App演示数据",trigger:"blur"}],order:[{required:!1,message:"请填写排序ID",trigger:"blur"}],status:[{required:!0,message:"请选择App状态",trigger:"change"}]}),F=f([]),$=f([]),Z=Q(()=>C.value?"更新套餐":"新增套餐"),E=Q(()=>C.value?"确认更新":"确认新增");async function _(){try{z.value=!0;const o=await k.queryApp(p),{rows:l,count:y}=o.data;z.value=!1,B.value=y,F.value=l.sort((V,b)=>b.order-V.order)}catch{z.value=!1}}async function ee(){const o=await k.queryCats({size:100}),{rows:l}=o.data;$.value=l}function le(o){C.value=o.id,h.value=o.role==="user",M.value=o.status;const{name:l,status:y,des:V,order:b,coverImg:x,catId:d,preset:w,demoData:m}=o;xe(()=>{Object.assign(s,{name:l,status:y,des:V,order:b,coverImg:x,catId:d,preset:w,demoData:m})}),A.value=!0}function te(o){C.value=0,o==null||o.resetFields()}async function ae(o){await k.deleteApp({id:o.id}),I.success("删除分类成功"),_()}function oe(o){o==null||o.resetFields(),_()}const se=(o,l)=>{console.log("response: ",o.data),s.coverImg=o.data},re=o=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(o.type)){if(o.size/1024>300)return I.error("当前限制文件最大不超过 300KB!"),!1}else return I.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1};function ne(o){o==null||o.validate(async l=>{if(l){if(C.value){const y={id:C.value,...s};h.value&&Object.assign(y,{status:M.value}),await k.updateApp(y),I({type:"success",message:"更新套餐成功！"})}else await k.createApp(s),I({type:"success",message:"创建新的套餐成功！"});A.value=!1,_()}})}async function ue(o){const l=await k.auditPassApp({id:o.id});I({type:"success",message:l.data}),_()}async function de(o){const l=await k.auditFailApp({id:o.id});I({type:"success",message:l.data}),_()}return we(()=>{_(),ee()}),(o,l)=>{const y=r("el-alert"),V=ye,b=r("el-option"),x=r("el-select"),d=r("el-form-item"),w=r("el-input"),m=r("el-button"),G=r("Plus"),K=r("el-icon"),Y=r("el-form"),pe=r("el-image"),c=r("el-table-column"),N=r("el-tag"),H=r("el-tooltip"),L=r("el-popconfirm"),ie=r("el-table"),me=r("el-pagination"),ce=r("el-row"),fe=r("el-switch"),ge=r("el-upload"),_e=r("el-dialog"),ve=Ae("loading");return n(),U("div",null,[t(V,null,{default:a(()=>[t(y,{closable:!1,"show-icon":"",title:"应用说明",description:"[由于各模型的使用不同、暂时关闭其他模型的应用使用、仅仅支持使用OpenAi的key使用、请配置了openAi的key之后再进行使用、如果没有配置将不能使用此功能、但用户可以自定义选择模型]  ====     应用一旦创建、可能会被多处使用后续将限制删除、请保持良好习惯、规范命名分类、后续尽量变更而不是删除。用户创建的应用我们不允许删除、但是可以做一定的变更和修改、审核通过的应用也将限制用户更改、一旦通过或者拒绝、将不允许再次对其状态进行变更、请知悉！",type:"success"})]),_:1}),t(V,null,{default:a(()=>[t(Y,{ref_key:"formRef",ref:j,inline:!0,model:p},{default:a(()=>[t(d,{label:"App分类",prop:"catId"},{default:a(()=>[t(x,{modelValue:p.catId,"onUpdate:modelValue":l[0]||(l[0]=e=>p.catId=e),placeholder:"请选择App分类",clearable:""},{default:a(()=>[(n(!0),U(S,null,T(u($),e=>(n(),g(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"App状态",prop:"status"},{default:a(()=>[t(x,{modelValue:p.status,"onUpdate:modelValue":l[1]||(l[1]=e=>p.status=e),placeholder:"请选择App状态",clearable:""},{default:a(()=>[(n(!0),U(S,null,T(u(De),e=>(n(),g(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"App名称",prop:"name"},{default:a(()=>[t(w,{modelValue:p.name,"onUpdate:modelValue":l[2]||(l[2]=e=>p.name=e),placeholder:"App名称[模糊搜索]",clearable:"",onKeydown:Ve(ke(_,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),t(d,{label:"App角色",prop:"status"},{default:a(()=>[t(x,{modelValue:p.role,"onUpdate:modelValue":l[3]||(l[3]=e=>p.role=e),placeholder:"请选择App角色",clearable:""},{default:a(()=>[(n(!0),U(S,null,T(u(Pe),e=>(n(),g(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(m,{type:"primary",onClick:_},{default:a(()=>l[19]||(l[19]=[i(" 查询 ")])),_:1}),t(m,{onClick:l[4]||(l[4]=e=>oe(u(j)))},{default:a(()=>l[20]||(l[20]=[i(" 重置 ")])),_:1})]),_:1}),t(m,{type:"success",style:{float:"right"},onClick:l[5]||(l[5]=e=>A.value=!0)},{default:a(()=>[l[21]||(l[21]=i(" 创建应用 ")),t(K,{class:"ml-3"},{default:a(()=>[t(G)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{style:{width:"100%"}},{default:a(()=>[Ie((n(),g(ie,{border:"",data:u(F),style:{width:"100%"},size:"large"},{default:a(()=>[t(c,{prop:"coverImg",label:"应用封面",width:"100"},{default:a(e=>[t(pe,{style:{height:"50px"},src:e.row.coverImg,fit:"fill"},null,8,["src"])]),_:1}),t(c,{prop:"catName",label:"应用分类",width:"100"}),t(c,{prop:"name",label:"应用名称",width:"120"}),t(c,{prop:"status",label:"应用状态",width:"100"},{default:a(e=>[t(N,{type:e.row.status===1?"success":"danger"},{default:a(()=>[i(v(u(ze)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"public",label:"是否共享",width:"100"},{default:a(e=>[t(N,{type:e.row.public?"success":""},{default:a(()=>[i(v(e.row.public?"共享":"私有"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"public",label:"应用创建角色",width:"120"},{default:a(e=>[t(N,{type:e.row.role==="system"?"success":""},{default:a(()=>[i(v(e.row.role==="system"?"系统":"用户"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"order",label:"排序ID"}),l[26]||(l[26]=i(" /> ")),t(c,{prop:"preset",label:"预设信息",width:"400"},{default:a(e=>[t(H,{class:"box-item",effect:"dark",placement:"top-start"},{content:a(()=>[D("div",Se,v(e.row.preset),1)]),default:a(()=>[D("div",Te,v(e.row.preset),1)]),_:2},1024)]),_:1}),t(c,{prop:"des",label:"描述信息",width:"300"},{default:a(e=>[t(H,{class:"box-item",effect:"dark",placement:"top-start"},{content:a(()=>[D("div",qe,v(e.row.des),1)]),default:a(()=>[D("div",he,v(e.row.des),1)]),_:2},1024)]),_:1}),t(c,{prop:"createdAt",label:"创建时间",width:"120"},{default:a(e=>[i(v(u(Ue)(e.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),t(c,{label:"操作",width:"200"},{default:a(e=>[e.row.role==="system"||e.row.public?(n(),g(m,{key:0,link:"",type:"primary",size:"small",onClick:O=>le(e.row)},{default:a(()=>l[22]||(l[22]=[i(" 编辑 ")])),_:2},1032,["onClick"])):P("",!0),e.row.role==="system"?(n(),g(L,{key:1,title:"确认删除此应用么?",width:"200","icon-color":"red",onConfirm:O=>ae(e.row)},{reference:a(()=>[t(m,{link:"",type:"danger",size:"small"},{default:a(()=>l[23]||(l[23]=[i(" 删除应用 ")])),_:1})]),_:2},1032,["onConfirm"])):P("",!0),e.row.role==="user"&&e.row.status===3?(n(),g(L,{key:2,title:"确认通过审核此应用么?",width:"200","icon-color":"red",onConfirm:O=>ue(e.row)},{reference:a(()=>[t(m,{link:"",type:"success",size:"small"},{default:a(()=>l[24]||(l[24]=[i(" 通过审核 ")])),_:1})]),_:2},1032,["onConfirm"])):P("",!0),e.row.role==="user"&&e.row.status===3?(n(),g(L,{key:3,title:"确认拒绝通过此应用共享请求么?",width:"200","icon-color":"red",onConfirm:O=>de(e.row)},{reference:a(()=>[t(m,{link:"",type:"danger",size:"small"},{default:a(()=>l[25]||(l[25]=[i(" 拒绝审核 ")])),_:1})]),_:2},1032,["onConfirm"])):P("",!0)]),_:1})]),_:1},8,["data"])),[[ve,u(z)]]),t(ce,{class:"flex justify-end mt-5"},{default:a(()=>[t(me,{"current-page":p.page,"onUpdate:currentPage":l[6]||(l[6]=e=>p.page=e),"page-size":p.size,"onUpdate:pageSize":l[7]||(l[7]=e=>p.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:u(B),onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(_e,{modelValue:u(A),"onUpdate:modelValue":l[17]||(l[17]=e=>Ce(A)?A.value=e:null),"close-on-click-modal":!1,title:u(Z),width:"570",onClose:l[18]||(l[18]=e=>te(u(q)))},{footer:a(()=>[D("span",Ne,[t(m,{onClick:l[15]||(l[15]=e=>A.value=!1)},{default:a(()=>l[27]||(l[27]=[i("取消")])),_:1}),t(m,{type:"primary",onClick:l[16]||(l[16]=e=>ne(u(q)))},{default:a(()=>[i(v(u(E)),1)]),_:1})])]),default:a(()=>[t(Y,{ref_key:"formPackageRef",ref:q,"label-position":"right","label-width":"100px",model:s,rules:X},{default:a(()=>[t(d,{label:"App分类",prop:"catId"},{default:a(()=>[t(x,{modelValue:s.catId,"onUpdate:modelValue":l[8]||(l[8]=e=>s.catId=e),placeholder:"请选择App分类",clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),U(S,null,T(u($),e=>(n(),g(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"App名称",prop:"name"},{default:a(()=>[t(w,{modelValue:s.name,"onUpdate:modelValue":l[9]||(l[9]=e=>s.name=e),placeholder:"请填写App名称"},null,8,["modelValue"])]),_:1}),u(h)?P("",!0):(n(),g(d,{key:0,label:"App状态",prop:"status"},{default:a(()=>[t(fe,{modelValue:s.status,"onUpdate:modelValue":l[10]||(l[10]=e=>s.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})),t(d,{label:"App预设",prop:"preset"},{default:a(()=>[t(w,{modelValue:s.preset,"onUpdate:modelValue":l[11]||(l[11]=e=>s.preset=e),type:"textarea",placeholder:"请填写App预设信息、用于给AI预设身份...",rows:4},null,8,["modelValue"])]),_:1}),t(d,{label:"App描述",prop:"des"},{default:a(()=>[t(w,{modelValue:s.des,"onUpdate:modelValue":l[12]||(l[12]=e=>s.des=e),type:"textarea",placeholder:"请填写App介绍信息、用于对外展示...",rows:4},null,8,["modelValue"])]),_:1}),t(d,{label:"示例内容",prop:"demoData"},{default:a(()=>[t(w,{modelValue:s.demoData,"onUpdate:modelValue":l[13]||(l[13]=e=>s.demoData=e),type:"textarea",placeholder:"请填写App的demo示例数据、每换行一次表示一个新的示例...",rows:4},null,8,["modelValue"])]),_:1}),t(d,{label:"应用Logo",prop:"coverImg"},{default:a(()=>[t(ge,{class:"avatar-uploader",action:u(J),"show-file-list":!1,"on-success":se,"before-upload":re},{default:a(()=>[s.coverImg?(n(),U("img",{key:0,src:s.coverImg,style:{width:"100px"},class:"avatar"},null,8,$e)):(n(),g(K,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[t(G)]),_:1}))]),_:1},8,["action"])]),_:1}),t(d,{label:"排序ID",prop:"order"},{default:a(()=>[t(w,{modelValue:s.order,"onUpdate:modelValue":l[14]||(l[14]=e=>s.order=e),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof W=="function"&&W(Le);export{Le as default};
